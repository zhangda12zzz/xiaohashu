2025-03-04 09:09:23.500 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 09:09:23.500 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:12:03.228 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:12:03.232 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:12:03.242 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:12:03.243 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895792506252034080(Long)
2025-03-04 16:12:03.246 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:12:03.246 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 14ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:12:03.248 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:13:44.215 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:13:44.216 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:13:44.218 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:13:44.218 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:13:44.220 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:13:44.220 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:13:44.221 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:15:42.472 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:15:42.473 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:15:42.474 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:15:42.475 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:15:42.475 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:15:42.476 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:15:42.476 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:16:55.226 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:16:55.226 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:16:55.228 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:16:55.228 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:16:55.229 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:16:55.229 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:16:55.230 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:18:51.628 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:18:51.628 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:19:48.836 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:19:48.838 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:19:48.839 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:20:12.174 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:20:15.522 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 83894ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:20:15.523 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:25:25.666 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:25:25.667 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:25:25.669 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:25:25.670 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 16:25:25.671 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:25:25.671 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:25:25.672 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:25:32.387 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:25:32.390 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793656292442205,"content":"第一条评论~","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:25:32.391 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:25:32.418 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793656292442205,"commentId":40027,"content":"第一条评论~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:25:32","creatorId":2100}
2025-03-04 16:25:32.418 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 28ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:25:32.419 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:25:32.431 [NettyClientPublicExecutor_8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000018F0C63947C6B12F95E020006, offsetMsgId=AC1B600100002A9F000000000000927F, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=8]
2025-03-04 16:25:32.433 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:25:32.434 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793656292442205,"commentId":40027,"content":"第一条评论~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:25:32","creatorId":2100}
2025-03-04 16:25:32.434 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40027,"noteId":1895793656292442205,"userId":2100,"contentUuid":"de9a28e2-7bee-4534-9a32-b6de85d2cd64","content":"第一条评论~","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793656292442205,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 16:25:32","updateTime":"2025-03-04 16:25:32"}]
2025-03-04 16:25:32.436 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:25:32.437 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40027(Long), 1895793656292442205(Long), 2100(Long), de9a28e2-7bee-4534-9a32-b6de85d2cd64(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793656292442205(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T16:25:32(LocalDateTime), 2025-03-04T16:25:32(LocalDateTime)
2025-03-04 16:25:32.440 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:25:32.554 [NettyClientPublicExecutor_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000018F0C63947C6B12F95E890007, offsetMsgId=AC1B600100002A9F0000000000009437, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=9]
2025-03-04 16:25:32.897 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:25:32.897 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793656292442205,\"commentId\":40027,\"level\":1,\"parentId\":1895793656292442205}]"]
2025-03-04 16:28:07.854 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:28:07.854 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:28:07.856 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:28:07.856 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 16:28:07.857 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:28:07.857 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:28:07.858 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:28:25.396 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:28:25.397 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:28:25.399 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:28:25.400 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 16:28:25.401 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:28:25.401 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:28:25.401 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:29:49.955 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 16:29:49.955 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 16:29:49.956 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 16:29:49.956 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 16:29:49.961 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:49.961 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:49.964 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:49.964 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:49.967 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:49.967 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:49.969 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:49.969 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:50.001 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 16:29:50.001 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 16:29:50.057 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 16:29:50.057 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 16:29:50.057 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@77952372[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 16:29:50.058 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741009314361_172.17.0.1_54774
2025-03-04 16:29:50.062 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@48bc0895[Running, pool size = 3, active threads = 0, queued tasks = 0, completed tasks = 5957]
2025-03-04 16:29:50.062 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@6d7a6e28[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 9889]
2025-03-04 16:29:50.062 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 16:29:50.062 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 16:29:50.062 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 16:29:50.068 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:50.068 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:50.072 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:50.072 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:50.072 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:50.072 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:50.073 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:50.073 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:50.197 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 16:29:50.197 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 16:29:50.200 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 16:29:50.202 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 16:29:54.076 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 16:29:54.112 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 16:29:54.402 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 16:29:54.410 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 16:29:54.410 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 16:29:54.420 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 16:29:54.834 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 16:29:54.836 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 16:29:54.850 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 16:29:54.992 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 16:29:55.024 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.025 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.025 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.164 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.193 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.195 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.196 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.197 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x000001b821523590] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.199 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.202 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.203 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 16:29:55.339 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 16:29:55.346 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 16:29:55.346 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 16:29:55.429 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 16:29:55.429 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1006 ms
2025-03-04 16:29:55.487 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 16:29:55.692 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 16:29:55.940 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 16:29:55.988 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 16:29:56.403 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:56.403 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 16:29:56.429 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:56.429 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 16:29:56.465 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 16:29:56.475 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 16:29:56.506 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:56.507 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 16:29:56.531 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 16:29:56.531 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 16:29:57.060 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 16:29:57.063 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 16:29:57.063 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 16:29:57.064 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 16:29:57.064 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 16:29:57.078 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 16:29:57.078 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 16:29:57.078 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 16:29:57.080 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 16:29:57.081 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 16:29:57.083 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 16:29:57.089 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 18e92c75-6133-4292-84d8-3a10a3b2f753
2025-03-04 16:29:57.100 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 16:29:57.100 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 16:29:57.100 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 16:29:57.101 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 16:29:57.116 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 16:29:57.659 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741076997499_172.17.0.1_60072
2025-03-04 16:29:57.659 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Notify connected event to listeners.
2025-03-04 16:29:57.659 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 16:29:57.659 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 16:29:57.660 [main] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000001b8219b7928
2025-03-04 16:29:57.660 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 16:29:57.670 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 16:29:57.756 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 4.06 seconds (process running for 4.381)
2025-03-04 16:30:14.482 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 16:30:14.482 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 16:30:14.482 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-03-04 16:30:14.487 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:30:14.546 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:30:14.731 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:30:14.855 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 16:30:14.866 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:30:14.869 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 323ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:30:14.878 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:30:43.542 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:30:43.543 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:30:43.556 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:30:43.557 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:30:43.560 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895793656292442205(Long)
2025-03-04 16:30:43.560 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895793656292442205(Long), 0(Long), 7(Long)
2025-03-04 16:30:43.565 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 16:30:43.567 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 16:30:43.578 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:30:43.634 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 16:30:43.646 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:43.654 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:43.727 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:30:43.737 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 16:30:43.741 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:43.742 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:43.753 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 208ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40027,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论~","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 16:30:43.754 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:30:44.172 [nacos-grpc-client-executor-127.0.0.1-24] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Receive server push request, request = NotifySubscriberRequest, requestId = 446
2025-03-04 16:30:44.173 [nacos-grpc-client-executor-127.0.0.1-24] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Ack server push request, request = NotifySubscriberRequest, requestId = 446
2025-03-04 16:30:44.253 [nacos-grpc-client-executor-127.0.0.1-25] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Receive server push request, request = NotifySubscriberRequest, requestId = 447
2025-03-04 16:30:44.253 [nacos-grpc-client-executor-127.0.0.1-25] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Ack server push request, request = NotifySubscriberRequest, requestId = 447
2025-03-04 16:30:50.847 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:30:50.849 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:30:50.850 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:30:50.851 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895791464059764794(Long)
2025-03-04 16:30:50.852 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:30:50.852 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:30:50.853 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:30:58.047 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:30:58.051 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895791464059764794,"content":"这次没问题了把~","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:30:58.052 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:30:58.063 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 16:30:58.068 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:58.068 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 16:30:58.077 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895791464059764794,"commentId":40028,"content":"这次没问题了把~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:30:58","creatorId":2100}
2025-03-04 16:30:58.083 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 31ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:30:58.084 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:30:58.098 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B12FE562E0000, offsetMsgId=AC1B600100002A9F00000000000095A7, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=3]
2025-03-04 16:30:58.101 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:30:58.102 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895791464059764794,"commentId":40028,"content":"这次没问题了把~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:30:58","creatorId":2100}
2025-03-04 16:30:58.107 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40028,"noteId":1895791464059764794,"userId":2100,"contentUuid":"e5c00430-84a6-453b-a872-e7d7c3841c2b","content":"这次没问题了把~","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895791464059764794,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 16:30:58","updateTime":"2025-03-04 16:30:58"}]
2025-03-04 16:30:58.125 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:30:58.241 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40028(Long), 1895791464059764794(Long), 2100(Long), e5c00430-84a6-453b-a872-e7d7c3841c2b(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895791464059764794(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T16:30:58(LocalDateTime), 2025-03-04T16:30:58(LocalDateTime)
2025-03-04 16:30:58.247 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:30:58.287 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B12FE56EF0001, offsetMsgId=AC1B600100002A9F0000000000009765, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=10]
2025-03-04 16:30:58.599 [nacos-grpc-client-executor-127.0.0.1-29] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Receive server push request, request = NotifySubscriberRequest, requestId = 448
2025-03-04 16:30:58.599 [nacos-grpc-client-executor-127.0.0.1-29] INFO  com.alibaba.nacos.common.remote.client - [18e92c75-6133-4292-84d8-3a10a3b2f753] Ack server push request, request = NotifySubscriberRequest, requestId = 448
2025-03-04 16:30:59.306 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:30:59.306 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895791464059764794,\"commentId\":40028,\"level\":1,\"parentId\":1895791464059764794}]"]
2025-03-04 16:31:23.491 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:31:23.492 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:31:23.494 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:31:23.494 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:31:23.495 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791464059764794(Long)
2025-03-04 16:31:23.496 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791464059764794(Long), 0(Long), 7(Long)
2025-03-04 16:31:23.496 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 16:31:23.497 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 16:31:23.498 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:23.525 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:23.537 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 45ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 16:31:23.538 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:31:28.098 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:31:28.099 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:31:28.101 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:31:28.101 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895795185766367284(Long)
2025-03-04 16:31:28.103 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 16:31:28.105 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:31:28.105 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:31:28.105 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895795185766367284(Long)
2025-03-04 16:31:28.106 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895795185766367284(Long), 0(Long), 7(Long)
2025-03-04 16:31:28.110 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 18
2025-03-04 16:31:28.111 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 16:31:28.111 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 16:31:28.112 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40023(Long)
2025-03-04 16:31:28.114 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 16:31:28.115 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:28.136 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:28.148 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 48ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:31:28.149 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:31:35.087 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:31:35.089 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:31:35.115 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 16:31:35.115 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40010(Long), 40009(Long)
2025-03-04 16:31:35.117 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 16:31:35.118 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? , ? , ? )
2025-03-04 16:31:35.120 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40015(Long), 40014(Long), 40013(Long), 40012(Long), 40011(Long)
2025-03-04 16:31:35.124 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 5
2025-03-04 16:31:35.125 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:35.144 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:31:35.155 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 66ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:31:35.156 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:31:38.121 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:31:38.123 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:31:38.132 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? )
2025-03-04 16:31:38.132 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40008(Long), 40007(Long), 40006(Long), 40005(Long)
2025-03-04 16:31:38.134 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 4
2025-03-04 16:31:38.134 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":3,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:31:38.135 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:32:13.340 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:32:13.341 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:32:13.354 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 16:32:13.354 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40022(Long), 40023(Long)
2025-03-04 16:32:13.356 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 16:32:13.357 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? , ? , ? , ? )
2025-03-04 16:32:13.358 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long), 40020(Long), 40019(Long), 40018(Long), 40017(Long), 40016(Long)
2025-03-04 16:32:13.363 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 6
2025-03-04 16:32:13.364 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:32:13.382 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:32:13.392 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 51ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:32:13.394 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:32:16.660 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:32:16.661 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895755651829727273,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:32:16.662 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:32:16.663 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895755651829727273(Long)
2025-03-04 16:32:16.664 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:32:16.665 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:32:16.666 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:32:29.972 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:32:29.973 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:32:29.974 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:32:29.974 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895753768780169280(Long)
2025-03-04 16:32:29.976 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:32:29.976 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:32:29.976 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:43:29.328 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:43:29.329 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:43:29.331 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:43:29.331 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793960295596052(Long)
2025-03-04 16:43:29.332 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:43:29.333 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:43:29.333 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:43:38.622 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:43:38.623 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"嘿嘿~","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:43:38.623 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:43:38.627 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40029,"content":"嘿嘿~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:43:38","creatorId":2100}
2025-03-04 16:43:38.628 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:43:38.628 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:43:38.629 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1309F1040002, offsetMsgId=AC1B600100002A9F00000000000098D5, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=4]
2025-03-04 16:43:38.630 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:43:38.631 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40029,"content":"嘿嘿~","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:43:38","creatorId":2100}
2025-03-04 16:43:38.631 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40029,"noteId":1895793960295596052,"userId":2100,"contentUuid":"5def250d-c942-49b3-90b0-dea914821ea8","content":"嘿嘿~","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 16:43:38","updateTime":"2025-03-04 16:43:38"}]
2025-03-04 16:43:38.632 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:43:38.634 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40029(Long), 1895793960295596052(Long), 2100(Long), 5def250d-c942-49b3-90b0-dea914821ea8(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T16:43:38(LocalDateTime), 2025-03-04T16:43:38(LocalDateTime)
2025-03-04 16:43:38.636 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:43:38.657 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1309F11F0003, offsetMsgId=AC1B600100002A9F0000000000009A84, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=3]
2025-03-04 16:43:39.246 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:43:39.246 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40029,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 16:45:58.838 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:45:58.838 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:45:58.841 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:45:58.841 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:45:58.842 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895793960295596052(Long)
2025-03-04 16:45:58.842 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895793960295596052(Long), 0(Long), 7(Long)
2025-03-04 16:45:58.844 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 16:45:58.844 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 16:45:58.844 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:45:58.855 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:45:58.859 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 21ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 16:45:58.860 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:46:06.278 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:46:06.279 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:46:06.280 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:46:06.280 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:46:06.285 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:46:06.286 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:46:06.286 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:46:17.264 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:46:17.265 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"来咯来咯","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:46:17.265 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:46:17.268 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40030,"content":"来咯来咯","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:46:17","creatorId":2100}
2025-03-04 16:46:17.269 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:46:17.269 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:46:17.270 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B130C5CB50004, offsetMsgId=AC1B600100002A9F0000000000009BF4, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=5]
2025-03-04 16:46:17.270 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:46:17.270 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40030,"content":"来咯来咯","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:46:17","creatorId":2100}
2025-03-04 16:46:17.271 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40030,"noteId":1895794402190688291,"userId":2100,"contentUuid":"8cd20a97-4391-4042-8e1c-0f87ab0fa8bb","content":"来咯来咯","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895794402190688291,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 16:46:17","updateTime":"2025-03-04 16:46:17"}]
2025-03-04 16:46:17.272 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:46:17.273 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40030(Long), 1895794402190688291(Long), 2100(Long), 8cd20a97-4391-4042-8e1c-0f87ab0fa8bb(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895794402190688291(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T16:46:17(LocalDateTime), 2025-03-04T16:46:17(LocalDateTime)
2025-03-04 16:46:17.278 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:46:17.302 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B130C5CD50005, offsetMsgId=AC1B600100002A9F0000000000009DA8, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=10]
2025-03-04 16:46:17.813 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:46:17.813 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40030,\"level\":1,\"parentId\":1895794402190688291}]"]
2025-03-04 16:48:10.760 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:10.761 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:48:10.764 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:48:10.764 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:48:10.765 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895794402190688291(Long)
2025-03-04 16:48:10.765 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895794402190688291(Long), 0(Long), 7(Long)
2025-03-04 16:48:10.766 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 16:48:10.766 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 16:48:10.767 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:48:10.777 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:48:10.783 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 22ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 16:48:10.783 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:48:21.026 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:21.027 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791181581779002,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:48:21.028 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:48:21.028 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895791181581779002(Long)
2025-03-04 16:48:21.029 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:48:21.030 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:48:21.030 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:48:30.357 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:30.358 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895791181581779002,"content":"这是在干啥子呢？","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:48:30.358 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:48:30.361 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895791181581779002,"commentId":40031,"content":"这是在干啥子呢？","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:48:30","creatorId":2100}
2025-03-04 16:48:30.361 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:48:30.362 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:48:30.362 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B130E64990006, offsetMsgId=AC1B600100002A9F0000000000009F18, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=4]
2025-03-04 16:48:30.368 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:48:30.368 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895791181581779002,"commentId":40031,"content":"这是在干啥子呢？","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 16:48:30","creatorId":2100}
2025-03-04 16:48:30.369 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40031,"noteId":1895791181581779002,"userId":2100,"contentUuid":"e8d04703-3705-46c2-971a-226cfcfe4df2","content":"这是在干啥子呢？","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895791181581779002,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 16:48:30","updateTime":"2025-03-04 16:48:30"}]
2025-03-04 16:48:30.370 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:48:30.370 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40031(Long), 1895791181581779002(Long), 2100(Long), e8d04703-3705-46c2-971a-226cfcfe4df2(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895791181581779002(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T16:48:30(LocalDateTime), 2025-03-04T16:48:30(LocalDateTime)
2025-03-04 16:48:30.372 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:48:30.393 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B130E64B80007, offsetMsgId=AC1B600100002A9F000000000000A0D8, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=11]
2025-03-04 16:48:31.258 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:48:31.258 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895791181581779002,\"commentId\":40031,\"level\":1,\"parentId\":1895791181581779002}]"]
2025-03-04 16:48:35.487 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:35.489 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791181581779002,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:48:35.491 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 16:48:35.491 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 16:48:35.491 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791181581779002(Long)
2025-03-04 16:48:35.491 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791181581779002(Long), 0(Long), 7(Long)
2025-03-04 16:48:35.493 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 16:48:35.493 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 16:48:35.494 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:48:35.509 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:48:35.521 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 33ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40031,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这是在干啥子呢？","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 16:48:35.523 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:48:40.164 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:40.165 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795420446064640,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:48:40.167 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 16:48:40.168 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895795420446064640(Long)
2025-03-04 16:48:40.169 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 16:48:40.169 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 16:48:40.170 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:48:44.741 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:48:44.741 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:48:44.754 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? )
2025-03-04 16:48:44.755 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40021(Long), 40020(Long), 40019(Long), 40018(Long), 40017(Long), 40016(Long)
2025-03-04 16:48:44.756 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 6
2025-03-04 16:48:44.757 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 16ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:48:44.758 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:50:57.907 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:50:57.909 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:50:57.916 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":20,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:50:57.916 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:15.550 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:15.551 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"呀呀呀~","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:51:15.551 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:51:15.555 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40032,"content":"呀呀呀~","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 16:51:15","creatorId":2100}
2025-03-04 16:51:15.555 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:51:15.556 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:15.556 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1310E9E30008, offsetMsgId=AC1B600100002A9F000000000000A248, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=5]
2025-03-04 16:51:15.557 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:51:15.557 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40032,"content":"呀呀呀~","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 16:51:15","creatorId":2100}
2025-03-04 16:51:15.559 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:15.560 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 16:51:15.561 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:15.562 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40032,"noteId":1895795185766367284,"userId":2100,"contentUuid":"3240420c-7337-4519-ab1b-270a7e0e0b05","content":"呀呀呀~","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 16:51:15","updateTime":"2025-03-04 16:51:15"}]
2025-03-04 16:51:15.563 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:51:15.564 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40032(Long), 1895795185766367284(Long), 2100(Long), 3240420c-7337-4519-ab1b-270a7e0e0b05(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T16:51:15(LocalDateTime), 2025-03-04T16:51:15(LocalDateTime)
2025-03-04 16:51:15.566 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:51:15.582 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1310E9FD0009, offsetMsgId=AC1B600100002A9F000000000000A3FB, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=12]
2025-03-04 16:51:15.943 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:51:15.943 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40032,\"level\":2,\"parentId\":40022}]"]
2025-03-04 16:51:15.945 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:15.946 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 16:51:15.947 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:18.049 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 16:51:18.049 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 16:51:18.055 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 16:51:18.055 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:18.056 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 16:51:18.057 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:18.060 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 16:51:18.062 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 0.9(Double), 40022(Long)
2025-03-04 16:51:18.071 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 16:51:22.881 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:22.883 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:22.889 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? )
2025-03-04 16:51:22.890 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40015(Long), 40014(Long), 40013(Long), 40012(Long), 40011(Long)
2025-03-04 16:51:22.891 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 5
2025-03-04 16:51:22.891 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 16:51:22.892 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:28.616 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:28.617 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"嘿嘿","imageUrl":"","replyCommentId":40019}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:51:28.617 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:51:28.619 [http-nio-8093-exec-9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40033,"content":"嘿嘿","imageUrl":"","replyCommentId":40019,"createTime":"2025-03-04 16:51:28","creatorId":2100}
2025-03-04 16:51:28.619 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:51:28.620 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:28.621 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B13111CEC000A, offsetMsgId=AC1B600100002A9F000000000000A67A, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=9]
2025-03-04 16:51:28.621 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:51:28.622 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40033,"content":"嘿嘿","imageUrl":"","replyCommentId":40019,"createTime":"2025-03-04 16:51:28","creatorId":2100}
2025-03-04 16:51:28.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:28.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40019(Long)
2025-03-04 16:51:28.625 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:28.625 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40033,"noteId":1895795185766367284,"userId":2100,"contentUuid":"9fab3f7d-9586-4036-ac95-69ea9b519b1c","content":"嘿嘿","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40019,"replyCommentId":40019,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 16:51:28","updateTime":"2025-03-04 16:51:28"}]
2025-03-04 16:51:28.626 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:51:28.627 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40033(Long), 1895795185766367284(Long), 2100(Long), 9fab3f7d-9586-4036-ac95-69ea9b519b1c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40019(Long), 40019(Long), 2100(Long), false(Boolean), 2025-03-04T16:51:28(LocalDateTime), 2025-03-04T16:51:28(LocalDateTime)
2025-03-04 16:51:28.628 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:51:28.649 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B13111D08000B, offsetMsgId=AC1B600100002A9F000000000000A829, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=4]
2025-03-04 16:51:29.084 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:51:29.084 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40033,\"level\":2,\"parentId\":40019}]"]
2025-03-04 16:51:29.086 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:29.087 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40019(Long)
2025-03-04 16:51:29.088 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:29.089 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 16:51:29.089 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40019(Long)
2025-03-04 16:51:29.091 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 16:51:29.091 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 16:51:29.091 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40033(Long), 40019(Long)
2025-03-04 16:51:29.101 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 16:51:30.112 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 16:51:30.112 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40019]"]
2025-03-04 16:51:30.112 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40019]
2025-03-04 16:51:30.113 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:51:30.114 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40019(Long)
2025-03-04 16:51:30.116 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:51:30.116 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 16:51:30.117 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40019(Long), 0.3(Double), 40019(Long)
2025-03-04 16:51:30.123 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 16:51:33.769 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:33.770 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:33.777 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":3,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:33.778 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:34.334 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:34.335 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:34.339 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:34.339 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:48.987 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:48.988 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:48.995 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:48.996 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:50.835 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:50.836 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:50.844 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:50.845 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:53.196 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:53.197 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:53.204 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":3,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:53.205 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:51:54.167 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:51:54.168 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:51:54.171 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:51:54.172 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:52:06.141 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 16:52:06.142 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"嘿嘿","imageUrl":"","replyCommentId":40005}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 16:52:06.142 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 16:52:06.145 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40034,"content":"嘿嘿","imageUrl":"","replyCommentId":40005,"createTime":"2025-03-04 16:52:06","creatorId":2100}
2025-03-04 16:52:06.145 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 16:52:06.146 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 16:52:06.146 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1311AF81000C, offsetMsgId=AC1B600100002A9F000000000000AAA8, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=6]
2025-03-04 16:52:06.150 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 16:52:06.150 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40034,"content":"嘿嘿","imageUrl":"","replyCommentId":40005,"createTime":"2025-03-04 16:52:06","creatorId":2100}
2025-03-04 16:52:06.151 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:52:06.151 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 16:52:06.153 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:52:06.153 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40034,"noteId":1895795185766367284,"userId":2100,"contentUuid":"bad76a73-3e12-4530-8932-f098874b119b","content":"嘿嘿","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40005,"replyCommentId":40005,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 16:52:06","updateTime":"2025-03-04 16:52:06"}]
2025-03-04 16:52:06.154 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 16:52:06.155 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40034(Long), 1895795185766367284(Long), 2100(Long), bad76a73-3e12-4530-8932-f098874b119b(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40005(Long), 40005(Long), 2100(Long), false(Boolean), 2025-03-04T16:52:06(LocalDateTime), 2025-03-04T16:52:06(LocalDateTime)
2025-03-04 16:52:06.157 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 16:52:06.186 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B1311AFA8000D, offsetMsgId=AC1B600100002A9F000000000000AC57, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=4]
2025-03-04 16:52:06.514 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 16:52:06.514 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40034,\"level\":2,\"parentId\":40005}]"]
2025-03-04 16:52:06.515 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:52:06.515 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 16:52:06.517 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:52:06.518 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 16:52:06.518 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40005(Long)
2025-03-04 16:52:06.519 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 16:52:06.520 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 16:52:06.520 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40034(Long), 40005(Long)
2025-03-04 16:52:06.529 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 16:52:08.255 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 16:52:08.255 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40005]"]
2025-03-04 16:52:08.255 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40005]
2025-03-04 16:52:08.255 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 16:52:08.256 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 16:52:08.258 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 16:52:08.258 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 16:52:08.259 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40005(Long), 0.3(Double), 40005(Long)
2025-03-04 16:52:08.269 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 16:53:09.812 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:53:09.813 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:53:09.820 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:53:09.820 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:55:31.002 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:55:31.003 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:55:31.010 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:55:31.011 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:55:43.975 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:55:43.975 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:55:43.984 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":3,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:55:43.985 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:55:52.069 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:55:52.071 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:55:52.074 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:55:52.075 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:55:56.338 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:55:56.339 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:55:56.345 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":3,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:55:56.346 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:56:15.641 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:56:15.642 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:56:15.649 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 16:56:15.649 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40016(Long)
2025-03-04 16:56:15.651 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 16:56:15.651 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:56:15.651 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 16:56:23.485 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 16:56:23.486 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 16:56:23.492 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 16:56:23.493 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 17:03:08.093 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:03:08.094 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"1111","imageUrl":"","replyCommentId":40013}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:03:08.094 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:03:08.098 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40035,"content":"1111","imageUrl":"","replyCommentId":40013,"createTime":"2025-03-04 17:03:08","creatorId":2100}
2025-03-04 17:03:08.098 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:03:08.098 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:03:08.099 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B131BC942000E, offsetMsgId=AC1B600100002A9F000000000000AED6, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=6]
2025-03-04 17:03:08.103 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:03:08.103 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40035,"content":"1111","imageUrl":"","replyCommentId":40013,"createTime":"2025-03-04 17:03:08","creatorId":2100}
2025-03-04 17:03:08.104 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:03:08.104 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40013(Long)
2025-03-04 17:03:08.106 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:03:08.106 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40035,"noteId":1895795185766367284,"userId":2100,"contentUuid":"14f38f2d-f789-4e60-88c8-e1ffcef1a1bd","content":"1111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40013,"replyCommentId":40013,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:03:08","updateTime":"2025-03-04 17:03:08"}]
2025-03-04 17:03:08.107 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:03:08.109 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40035(Long), 1895795185766367284(Long), 2100(Long), 14f38f2d-f789-4e60-88c8-e1ffcef1a1bd(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40013(Long), 40013(Long), 2100(Long), false(Boolean), 2025-03-04T17:03:08(LocalDateTime), 2025-03-04T17:03:08(LocalDateTime)
2025-03-04 17:03:08.111 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:03:08.127 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B131BC95E000F, offsetMsgId=AC1B600100002A9F000000000000B083, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=5]
2025-03-04 17:03:08.235 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:03:08.235 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40035,\"level\":2,\"parentId\":40013}]"]
2025-03-04 17:03:08.236 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:03:08.237 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40013(Long)
2025-03-04 17:03:08.238 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:03:08.238 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:03:08.239 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40013(Long)
2025-03-04 17:03:08.240 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:03:08.240 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:03:08.240 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40035(Long), 40013(Long)
2025-03-04 17:03:08.252 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:03:08.919 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:03:08.919 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40013]"]
2025-03-04 17:03:08.919 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40013]
2025-03-04 17:03:08.920 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:03:08.920 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40013(Long)
2025-03-04 17:03:08.922 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:03:08.923 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:03:08.923 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40013(Long), 0.3(Double), 40013(Long)
2025-03-04 17:03:08.930 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:05:42.497 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:05:42.498 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:05:42.505 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"firstReplyComment":{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"18 小时前","likeTotal":0,"childCommentTotal":null,"firstReplyComment":null,"heat":0.0},"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"firstReplyComment":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":1,"totalCount":24,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:05:42.505 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:05:52.599 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:05:52.600 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"测试了","imageUrl":"","replyCommentId":40005}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:05:52.600 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:05:52.603 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40036,"content":"测试了","imageUrl":"","replyCommentId":40005,"createTime":"2025-03-04 17:05:52","creatorId":2100}
2025-03-04 17:05:52.603 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:05:52.604 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:05:52.604 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B131E4BDC0010, offsetMsgId=AC1B600100002A9F000000000000B302, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=10]
2025-03-04 17:05:52.615 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:05:52.615 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40036,"content":"测试了","imageUrl":"","replyCommentId":40005,"createTime":"2025-03-04 17:05:52","creatorId":2100}
2025-03-04 17:05:52.616 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:05:52.617 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 17:05:52.618 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:05:52.619 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40036,"noteId":1895795185766367284,"userId":2100,"contentUuid":"318c6a96-1d35-4045-9f68-03ce7f732284","content":"测试了","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40005,"replyCommentId":40005,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:05:52","updateTime":"2025-03-04 17:05:52"}]
2025-03-04 17:05:52.620 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:05:52.620 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40036(Long), 1895795185766367284(Long), 2100(Long), 318c6a96-1d35-4045-9f68-03ce7f732284(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40005(Long), 40005(Long), 2100(Long), false(Boolean), 2025-03-04T17:05:52(LocalDateTime), 2025-03-04T17:05:52(LocalDateTime)
2025-03-04 17:05:52.622 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:05:52.637 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001174463947C6B131E4BFC0011, offsetMsgId=AC1B600100002A9F000000000000B4B4, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=6]
2025-03-04 17:05:52.907 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:05:52.907 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40036,\"level\":2,\"parentId\":40005}]"]
2025-03-04 17:05:53.548 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:05:53.548 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40005]"]
2025-03-04 17:05:53.548 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40005]
2025-03-04 17:05:53.548 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:05:53.549 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 17:05:53.551 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:05:53.551 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:05:53.551 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40005(Long), 0.6(Double), 40005(Long)
2025-03-04 17:05:53.558 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:05:57.480 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:05:57.480 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:05:57.486 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"firstReplyComment":null,"heat":0.0}],"pageNo":2,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:05:57.487 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:21:54.500 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 17:21:54.500 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 17:21:54.500 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 17:21:54.500 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 17:21:54.505 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.505 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.507 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.507 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.510 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.510 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.512 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.512 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.544 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 17:21:54.544 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@523e0fb[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 17:21:54.547 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741076997499_172.17.0.1_60072
2025-03-04 17:21:54.549 [nacos-grpc-client-executor-127.0.0.1-657] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741076997499_172.17.0.1_60072]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 17:21:54.550 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@893649d[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 658]
2025-03-04 17:21:54.550 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@415264f4[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 1037]
2025-03-04 17:21:54.550 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 17:21:54.550 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 17:21:54.550 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 17:21:54.554 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.554 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.556 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.556 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.556 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:21:54.556 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:21:54.557 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:21:54.557 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:21:54.681 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:21:54.681 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:21:54.683 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 17:21:54.683 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 17:21:58.484 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:21:58.530 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:21:58.781 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:21:58.790 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:21:58.790 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 17:21:58.800 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 17:21:59.142 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 17:21:59.143 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 17:21:59.156 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 17:21:59.293 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 17:21:59.321 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.322 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.323 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.472 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.503 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.505 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.510 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.510 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x000002d5aa5242d8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.511 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.517 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.517 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:21:59.635 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 17:21:59.640 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 17:21:59.640 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 17:21:59.689 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 17:21:59.689 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 886 ms
2025-03-04 17:21:59.742 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 17:21:59.925 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 17:22:00.104 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:22:00.141 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 17:22:00.451 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:22:00.451 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 17:22:00.477 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:22:00.477 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 17:22:00.511 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:22:00.523 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:22:00.554 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:22:00.555 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 17:22:00.577 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:22:00.577 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 17:22:01.107 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 17:22:01.111 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:22:01.111 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 17:22:01.111 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 17:22:01.111 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 17:22:01.126 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 17:22:01.126 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 17:22:01.127 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 17:22:01.129 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 17:22:01.131 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 17:22:01.132 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 17:22:01.139 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8
2025-03-04 17:22:01.151 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 17:22:01.151 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 17:22:01.151 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 17:22:01.152 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 17:22:01.168 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 17:22:01.718 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741080121560_172.17.0.1_48266
2025-03-04 17:22:01.718 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Notify connected event to listeners.
2025-03-04 17:22:01.718 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 17:22:01.718 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 17:22:01.719 [main] INFO  com.alibaba.nacos.common.remote.client - [a628dae2-c4fe-463f-a9e4-fd7cd8e5dcb8] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000002d5aa9b4150
2025-03-04 17:22:01.719 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 17:22:01.727 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 17:22:01.813 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 3.8 seconds (process running for 4.111)
2025-03-04 17:22:07.811 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 17:22:07.811 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 17:22:07.811 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-03-04 17:22:07.815 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 17:22:07.867 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:22:08.069 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 202ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":null,"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:22:08.077 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 17:23:09.453 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 17:23:09.453 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 17:23:09.454 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 17:23:09.454 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 17:23:09.458 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.458 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.459 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.459 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.463 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.463 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.464 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.464 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.486 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 17:23:09.486 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@30d81661[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 17:23:09.490 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741080121560_172.17.0.1_48266
2025-03-04 17:23:09.492 [nacos-grpc-client-executor-127.0.0.1-27] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741080121560_172.17.0.1_48266]Ignore error event,isRunning:false,isAbandon=false
2025-03-04 17:23:09.493 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@7ab81655[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 28]
2025-03-04 17:23:09.494 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@63b182e0[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 22]
2025-03-04 17:23:09.494 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 17:23:09.494 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 17:23:09.494 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 17:23:09.498 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.498 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.500 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.500 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.500 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:09.500 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:09.500 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:09.500 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:09.623 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 17:23:09.624 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 17:23:09.626 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 17:23:09.631 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 17:23:11.595 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:23:11.632 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:23:11.890 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:23:11.898 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:23:11.898 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 17:23:11.907 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 17:23:12.277 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 17:23:12.279 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 17:23:12.294 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 17:23:12.428 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 17:23:12.458 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.458 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.459 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.618 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.646 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.651 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.653 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.654 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x000001ff4f526be8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.655 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.660 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.660 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 17:23:12.776 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 17:23:12.781 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 17:23:12.781 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 17:23:12.831 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 17:23:12.831 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 922 ms
2025-03-04 17:23:12.891 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 17:23:13.089 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 17:23:13.259 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:23:13.299 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 17:23:13.596 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:13.596 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 17:23:13.621 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:13.621 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 17:23:13.661 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:23:13.672 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 17:23:13.702 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:13.703 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 17:23:13.727 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 17:23:13.727 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 17:23:14.259 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 17:23:14.263 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 17:23:14.263 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 17:23:14.263 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 17:23:14.263 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 17:23:14.277 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 17:23:14.277 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 17:23:14.278 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 17:23:14.280 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 17:23:14.280 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 17:23:14.282 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 17:23:14.287 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 29b08a22-5906-4f51-9f83-e6a23011cb4d
2025-03-04 17:23:14.298 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 17:23:14.298 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 17:23:14.298 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 17:23:14.299 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 17:23:14.314 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 17:23:14.955 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741080194768_172.17.0.1_41936
2025-03-04 17:23:14.955 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Notify connected event to listeners.
2025-03-04 17:23:14.955 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 17:23:14.956 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 17:23:14.956 [main] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000001ff4f9b4810
2025-03-04 17:23:14.956 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 17:23:14.965 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 17:23:15.055 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 3.877 seconds (process running for 4.286)
2025-03-04 17:23:17.613 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 17:23:17.614 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 17:23:17.614 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-03-04 17:23:17.618 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 17:23:17.672 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:23:17.841 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:23:17.956 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895795185766367284(Long)
2025-03-04 17:23:17.972 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 17:23:17.981 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 17:23:17.981 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 17:23:17.985 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895795185766367284(Long)
2025-03-04 17:23:17.985 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895795185766367284(Long), 0(Long), 7(Long)
2025-03-04 17:23:17.990 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 18
2025-03-04 17:23:17.991 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 17:23:18.005 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? , ? , ? )
2025-03-04 17:23:18.006 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40023(Long), 40034(Long), 40033(Long), 40035(Long)
2025-03-04 17:23:18.009 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 4
2025-03-04 17:23:18.019 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 101
2025-03-04 17:23:18.053 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 17:23:18.063 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:23:18.069 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:23:18.115 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 101
2025-03-04 17:23:18.122 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 17:23:18.126 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:23:18.127 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:23:18.139 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 466ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:23:18.148 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 17:23:18.591 [nacos-grpc-client-executor-127.0.0.1-12] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Receive server push request, request = NotifySubscriberRequest, requestId = 453
2025-03-04 17:23:18.591 [nacos-grpc-client-executor-127.0.0.1-12] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Ack server push request, request = NotifySubscriberRequest, requestId = 453
2025-03-04 17:23:18.684 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Receive server push request, request = NotifySubscriberRequest, requestId = 454
2025-03-04 17:23:18.684 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Ack server push request, request = NotifySubscriberRequest, requestId = 454
2025-03-04 17:25:57.721 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:25:57.722 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:25:57.749 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? , ? )
2025-03-04 17:25:57.750 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40022(Long), 40023(Long), 40005(Long), 40034(Long), 40019(Long), 40033(Long), 40013(Long), 40035(Long)
2025-03-04 17:25:57.753 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 8
2025-03-04 17:25:57.754 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? )
2025-03-04 17:25:57.755 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long), 40020(Long), 40018(Long)
2025-03-04 17:25:57.758 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 3
2025-03-04 17:25:57.759 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:25:57.769 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:25:57.776 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 53ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:25:57.778 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:26:41.066 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:26:41.067 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:26:41.072 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 17:26:41.073 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long), 40016(Long), 40015(Long), 40014(Long), 40012(Long), 40011(Long), 40010(Long)
2025-03-04 17:26:41.078 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 7
2025-03-04 17:26:41.079 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:26:41.098 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:26:41.107 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 40ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:26:41.109 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:26:44.876 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:26:44.877 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:26:44.889 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 17:26:44.889 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40009(Long), 40007(Long), 40006(Long)
2025-03-04 17:26:44.891 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 17:26:44.892 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:26:44.893 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40008(Long)
2025-03-04 17:26:44.896 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:26:44.896 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:26:44.911 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:26:44.923 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 46ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":3,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:26:44.924 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:26:45.670 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:26:45.672 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:26:45.676 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:26:45.677 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:27:34.195 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:27:34.196 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:27:34.207 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 17:27:34.208 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40021(Long), 40020(Long), 40018(Long)
2025-03-04 17:27:34.209 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 17:27:34.210 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 14ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:27:34.211 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:22.137 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:22.138 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:22.148 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:22.149 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:27.290 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:27.290 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:27.302 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:27.304 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:38.412 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:38.414 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:38.427 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 17:28:38.428 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40017(Long), 40016(Long), 40015(Long), 40014(Long), 40012(Long), 40011(Long), 40010(Long)
2025-03-04 17:28:38.430 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 7
2025-03-04 17:28:38.430 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 17ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":25,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:38.431 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:43.295 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:43.300 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"丫丫","imageUrl":"","replyCommentId":40017}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:28:43.300 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:28:43.312 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 17:28:43.315 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:28:43.315 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 17:28:43.323 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40037,"content":"丫丫","imageUrl":"","replyCommentId":40017,"createTime":"2025-03-04 17:28:43","creatorId":2100}
2025-03-04 17:28:43.328 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 28ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:28:43.330 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:43.347 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B1333364C0000, offsetMsgId=AC1B600100002A9F000000000000B733, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=11]
2025-03-04 17:28:43.350 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:28:43.351 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40037,"content":"丫丫","imageUrl":"","replyCommentId":40017,"createTime":"2025-03-04 17:28:43","creatorId":2100}
2025-03-04 17:28:43.353 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:28:43.354 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long)
2025-03-04 17:28:43.356 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:28:43.359 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40037,"noteId":1895795185766367284,"userId":2100,"contentUuid":"15814779-07a8-467c-8a2d-13347f2ad36e","content":"丫丫","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40017,"replyCommentId":40017,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:28:43","updateTime":"2025-03-04 17:28:43"}]
2025-03-04 17:28:43.365 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:28:43.472 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40037(Long), 1895795185766367284(Long), 2100(Long), 15814779-07a8-467c-8a2d-13347f2ad36e(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40017(Long), 40017(Long), 2100(Long), false(Boolean), 2025-03-04T17:28:43(LocalDateTime), 2025-03-04T17:28:43(LocalDateTime)
2025-03-04 17:28:43.477 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:28:43.501 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133336EC0001, offsetMsgId=AC1B600100002A9F000000000000B8E2, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=7]
2025-03-04 17:28:43.884 [nacos-grpc-client-executor-127.0.0.1-88] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Receive server push request, request = NotifySubscriberRequest, requestId = 455
2025-03-04 17:28:43.884 [nacos-grpc-client-executor-127.0.0.1-88] INFO  com.alibaba.nacos.common.remote.client - [29b08a22-5906-4f51-9f83-e6a23011cb4d] Ack server push request, request = NotifySubscriberRequest, requestId = 455
2025-03-04 17:28:44.517 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:28:44.517 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40037,\"level\":2,\"parentId\":40017}]"]
2025-03-04 17:28:44.523 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:28:44.524 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long)
2025-03-04 17:28:44.527 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:28:44.529 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:28:44.530 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40017(Long)
2025-03-04 17:28:44.532 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:28:44.532 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:28:44.534 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40037(Long), 40017(Long)
2025-03-04 17:28:44.544 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:28:45.808 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:28:45.808 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40017]"]
2025-03-04 17:28:45.812 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40017]
2025-03-04 17:28:45.813 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:28:45.813 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long)
2025-03-04 17:28:45.816 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:28:45.818 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:28:45.819 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40017(Long), 0.3(Double), 40017(Long)
2025-03-04 17:28:45.830 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:28:51.299 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:51.300 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:51.309 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":26,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:51.310 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:53.570 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:53.571 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:53.581 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":26,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:53.582 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:55.073 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:55.075 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:55.085 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 17:28:55.085 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40008(Long)
2025-03-04 17:28:55.087 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 17:28:55.088 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 13ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":3,"totalCount":26,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:55.089 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:28:55.984 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:28:55.985 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:28:55.987 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":26,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:28:55.988 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:29:51.418 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:29:51.419 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:29:51.428 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":26,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:29:51.429 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:30:00.045 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:30:00.046 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40021}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:30:00.047 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:30:00.050 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40038,"content":"111","imageUrl":"","replyCommentId":40021,"createTime":"2025-03-04 17:30:00","creatorId":2100}
2025-03-04 17:30:00.051 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:30:00.051 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:30:00.052 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133461F30002, offsetMsgId=AC1B600100002A9F000000000000BB61, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=12]
2025-03-04 17:30:00.062 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:30:00.062 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40038,"content":"111","imageUrl":"","replyCommentId":40021,"createTime":"2025-03-04 17:30:00","creatorId":2100}
2025-03-04 17:30:00.064 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:30:00.064 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 17:30:00.067 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:30:00.067 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40038,"noteId":1895795185766367284,"userId":2100,"contentUuid":"6be2515a-cbdf-4ba5-bec6-4d0a33b2304c","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40021,"replyCommentId":40021,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:30:00","updateTime":"2025-03-04 17:30:00"}]
2025-03-04 17:30:00.068 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:30:00.069 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40038(Long), 1895795185766367284(Long), 2100(Long), 6be2515a-cbdf-4ba5-bec6-4d0a33b2304c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40021(Long), 40021(Long), 2100(Long), false(Boolean), 2025-03-04T17:30(LocalDateTime), 2025-03-04T17:30(LocalDateTime)
2025-03-04 17:30:00.071 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:30:00.086 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133462150003, offsetMsgId=AC1B600100002A9F000000000000BD0D, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=8]
2025-03-04 17:30:00.325 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:30:00.325 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40038,\"level\":2,\"parentId\":40021}]"]
2025-03-04 17:30:00.327 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:30:00.328 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 17:30:00.331 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:30:00.331 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:30:00.332 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40021(Long)
2025-03-04 17:30:00.333 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:30:00.333 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:30:00.334 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40038(Long), 40021(Long)
2025-03-04 17:30:00.341 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:30:02.079 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:30:02.080 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40021]"]
2025-03-04 17:30:02.081 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40021]
2025-03-04 17:30:02.081 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:30:02.083 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 17:30:02.085 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:30:02.087 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:30:02.087 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40021(Long), 0.3(Double), 40021(Long)
2025-03-04 17:30:02.106 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:31:04.147 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:31:04.148 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:31:04.156 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":27,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:31:04.157 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:31:08.012 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:31:08.014 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:31:08.022 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":27,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:31:08.022 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:31:09.139 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:31:09.140 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:31:09.146 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":3,"totalCount":27,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:31:09.147 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:31:14.679 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:31:14.680 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40012}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:31:14.680 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:31:14.683 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40039,"content":"111","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 17:31:14","creatorId":2100}
2025-03-04 17:31:14.684 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:31:14.684 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:31:14.686 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B1335857C0004, offsetMsgId=AC1B600100002A9F000000000000BF8C, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=7]
2025-03-04 17:31:14.695 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:31:14.695 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40039,"content":"111","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 17:31:14","creatorId":2100}
2025-03-04 17:31:14.697 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:31:14.697 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 17:31:14.699 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:31:14.699 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40039,"noteId":1895795185766367284,"userId":2100,"contentUuid":"9b5ec4a5-33c7-47bc-8581-f436e08c0be3","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40012,"replyCommentId":40012,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:31:14","updateTime":"2025-03-04 17:31:14"}]
2025-03-04 17:31:14.700 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:31:14.701 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40039(Long), 1895795185766367284(Long), 2100(Long), 9b5ec4a5-33c7-47bc-8581-f436e08c0be3(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40012(Long), 40012(Long), 2100(Long), false(Boolean), 2025-03-04T17:31:14(LocalDateTime), 2025-03-04T17:31:14(LocalDateTime)
2025-03-04 17:31:14.702 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:31:14.719 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B1335859E0005, offsetMsgId=AC1B600100002A9F000000000000C138, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=13]
2025-03-04 17:31:15.069 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:31:15.069 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40039,\"level\":2,\"parentId\":40012}]"]
2025-03-04 17:31:15.072 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:31:15.072 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 17:31:15.074 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:31:15.074 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:31:15.074 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40012(Long)
2025-03-04 17:31:15.075 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:31:15.076 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:31:15.076 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40039(Long), 40012(Long)
2025-03-04 17:31:15.083 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:31:16.358 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:31:16.358 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40012]"]
2025-03-04 17:31:16.358 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40012]
2025-03-04 17:31:16.359 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:31:16.359 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 17:31:16.361 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:31:16.362 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:31:16.362 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40012(Long), 0.3(Double), 40012(Long)
2025-03-04 17:31:16.368 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:34:33.701 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:34:33.702 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:34:33.710 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":28,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 17:34:33.711 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:34:52.329 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:34:52.330 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"222","imageUrl":"","replyCommentId":40017}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:34:52.330 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:34:52.334 [http-nio-8093-exec-5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40040,"content":"222","imageUrl":"","replyCommentId":40017,"createTime":"2025-03-04 17:34:52","creatorId":2100}
2025-03-04 17:34:52.334 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:34:52.334 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:34:52.335 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B1338D7AE0006, offsetMsgId=AC1B600100002A9F000000000000C3B7, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=13]
2025-03-04 17:34:52.336 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:34:52.336 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40040,"content":"222","imageUrl":"","replyCommentId":40017,"createTime":"2025-03-04 17:34:52","creatorId":2100}
2025-03-04 17:34:52.337 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:34:52.338 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long)
2025-03-04 17:34:52.340 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:34:52.340 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40040,"noteId":1895795185766367284,"userId":2100,"contentUuid":"0244a4d0-7089-4065-b094-21f8bd1b3802","content":"222","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40017,"replyCommentId":40017,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:34:52","updateTime":"2025-03-04 17:34:52"}]
2025-03-04 17:34:52.341 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:34:52.341 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40040(Long), 1895795185766367284(Long), 2100(Long), 0244a4d0-7089-4065-b094-21f8bd1b3802(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40017(Long), 40017(Long), 2100(Long), false(Boolean), 2025-03-04T17:34:52(LocalDateTime), 2025-03-04T17:34:52(LocalDateTime)
2025-03-04 17:34:52.343 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:34:52.360 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B1338D7C70007, offsetMsgId=AC1B600100002A9F000000000000C563, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=14]
2025-03-04 17:34:53.115 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:34:53.115 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40017]"]
2025-03-04 17:34:53.115 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40017]
2025-03-04 17:34:53.116 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:34:53.116 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40017(Long)
2025-03-04 17:34:53.119 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:34:53.119 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:34:53.120 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40017(Long), 0.6(Double), 40017(Long)
2025-03-04 17:34:53.127 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:34:53.222 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:34:53.222 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40040,\"level\":2,\"parentId\":40017}]"]
2025-03-04 17:35:02.193 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:35:02.195 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:35:02.203 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":29,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 17:35:02.204 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:35:04.648 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:35:04.649 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:35:04.656 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":29,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 17:35:04.656 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:35:24.628 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:35:24.629 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"是大佛看电视就废了","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:35:24.629 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:35:24.631 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40041,"content":"是大佛看电视就废了","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 17:35:24","creatorId":2100}
2025-03-04 17:35:24.632 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:35:24.632 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:35:24.633 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133955D80008, offsetMsgId=AC1B600100002A9F000000000000C7E2, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=7]
2025-03-04 17:35:24.635 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:35:24.635 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40041,"content":"是大佛看电视就废了","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 17:35:24","creatorId":2100}
2025-03-04 17:35:24.636 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40041,"noteId":1895795185766367284,"userId":2100,"contentUuid":"acdd7410-2f07-4821-826d-0cb86ad924aa","content":"是大佛看电视就废了","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 17:35:24","updateTime":"2025-03-04 17:35:24"}]
2025-03-04 17:35:24.637 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:35:24.638 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40041(Long), 1895795185766367284(Long), 2100(Long), acdd7410-2f07-4821-826d-0cb86ad924aa(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T17:35:24(LocalDateTime), 2025-03-04T17:35:24(LocalDateTime)
2025-03-04 17:35:24.640 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:35:24.661 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133955F40009, offsetMsgId=AC1B600100002A9F000000000000C9A5, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=11]
2025-03-04 17:35:25.577 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:35:25.577 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40041,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 17:38:41.019 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:38:41.020 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:38:41.027 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":30,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 17:38:41.028 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:38:43.953 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:38:43.953 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:38:43.960 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:38:43.961 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40041(Long)
2025-03-04 17:38:43.962 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:38:43.963 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:38:43.971 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:38:43.974 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 21ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40041,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"是大佛看电视就废了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":30,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 17:38:43.975 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:38:48.829 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:38:48.830 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40015}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:38:48.830 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:38:48.833 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40042,"content":"111","imageUrl":"","replyCommentId":40015,"createTime":"2025-03-04 17:38:48","creatorId":2100}
2025-03-04 17:38:48.834 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:38:48.834 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:38:48.835 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133C7382000A, offsetMsgId=AC1B600100002A9F000000000000CB15, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=14]
2025-03-04 17:38:48.835 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:38:48.835 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40042,"content":"111","imageUrl":"","replyCommentId":40015,"createTime":"2025-03-04 17:38:48","creatorId":2100}
2025-03-04 17:38:48.835 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:38:48.836 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40015(Long)
2025-03-04 17:38:48.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:38:48.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40042,"noteId":1895795185766367284,"userId":2100,"contentUuid":"e7f4f544-ce60-4c55-830a-ee28514d11b6","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40015,"replyCommentId":40015,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:38:48","updateTime":"2025-03-04 17:38:48"}]
2025-03-04 17:38:48.839 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:38:48.840 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40042(Long), 1895795185766367284(Long), 2100(Long), e7f4f544-ce60-4c55-830a-ee28514d11b6(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40015(Long), 40015(Long), 2100(Long), false(Boolean), 2025-03-04T17:38:48(LocalDateTime), 2025-03-04T17:38:48(LocalDateTime)
2025-03-04 17:38:48.841 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:38:48.874 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133C73A9000B, offsetMsgId=AC1B600100002A9F000000000000CCC1, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=9]
2025-03-04 17:38:49.649 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:38:49.649 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40042,\"level\":2,\"parentId\":40015}]"]
2025-03-04 17:38:49.652 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:38:49.652 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40015(Long)
2025-03-04 17:38:49.655 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:38:49.655 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:38:49.656 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40015(Long)
2025-03-04 17:38:49.657 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:38:49.657 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:38:49.657 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40042(Long), 40015(Long)
2025-03-04 17:38:49.666 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:38:50.055 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:38:50.055 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40015]"]
2025-03-04 17:38:50.055 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40015]
2025-03-04 17:38:50.055 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:38:50.056 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40015(Long)
2025-03-04 17:38:50.058 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:38:50.058 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:38:50.059 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40015(Long), 0.3(Double), 40015(Long)
2025-03-04 17:38:50.068 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:40:35.262 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:35.263 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:40:35.268 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"20 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 17:40:35.269 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:48.357 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:48.358 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895756189493362701,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:40:48.360 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:40:48.361 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895756189493362701(Long)
2025-03-04 17:40:48.362 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 17:40:48.363 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 17:40:48.363 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:50.673 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:50.675 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:40:50.677 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:40:50.677 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 17:40:50.680 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 17:40:50.680 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 17:40:50.681 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:53.461 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:53.462 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794954152706064,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:40:53.463 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:40:53.463 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794954152706064(Long)
2025-03-04 17:40:53.464 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 17:40:53.464 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 17:40:53.465 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:56.364 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:56.365 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:40:56.366 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:40:56.367 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895791464059764794(Long)
2025-03-04 17:40:56.368 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 17:40:56.369 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 17:40:56.369 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791464059764794(Long), 0(Long), 7(Long)
2025-03-04 17:40:56.371 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 17:40:56.371 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 17:40:56.372 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:40:56.372 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791464059764794(Long)
2025-03-04 17:40:56.373 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 17:40:56.380 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:40:56.384 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 19ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 17:40:56.385 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:59.717 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:40:59.718 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895791464059764794,"content":"111","imageUrl":"","replyCommentId":40028}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:40:59.718 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:40:59.721 [http-nio-8093-exec-9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895791464059764794,"commentId":40043,"content":"111","imageUrl":"","replyCommentId":40028,"createTime":"2025-03-04 17:40:59","creatorId":2100}
2025-03-04 17:40:59.721 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:40:59.722 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:40:59.722 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133E72C9000C, offsetMsgId=AC1B600100002A9F000000000000CF40, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=8]
2025-03-04 17:40:59.723 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:40:59.723 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895791464059764794,"commentId":40043,"content":"111","imageUrl":"","replyCommentId":40028,"createTime":"2025-03-04 17:40:59","creatorId":2100}
2025-03-04 17:40:59.724 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:40:59.724 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40028(Long)
2025-03-04 17:40:59.726 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:40:59.727 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40043,"noteId":1895791464059764794,"userId":2100,"contentUuid":"204c07e1-70d5-4763-8a48-7bd0b00d8884","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40028,"replyCommentId":40028,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:40:59","updateTime":"2025-03-04 17:40:59"}]
2025-03-04 17:40:59.728 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:40:59.728 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40043(Long), 1895791464059764794(Long), 2100(Long), 204c07e1-70d5-4763-8a48-7bd0b00d8884(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40028(Long), 40028(Long), 2100(Long), false(Boolean), 2025-03-04T17:40:59(LocalDateTime), 2025-03-04T17:40:59(LocalDateTime)
2025-03-04 17:40:59.731 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:40:59.749 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133E72E5000D, offsetMsgId=AC1B600100002A9F000000000000D0EC, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=10]
2025-03-04 17:41:00.048 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:41:00.048 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895791464059764794,\"commentId\":40043,\"level\":2,\"parentId\":40028}]"]
2025-03-04 17:41:00.050 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:00.050 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40028(Long)
2025-03-04 17:41:00.052 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:00.052 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:41:00.052 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40028(Long)
2025-03-04 17:41:00.054 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:41:00.054 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:41:00.054 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40043(Long), 40028(Long)
2025-03-04 17:41:00.071 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:41:00.559 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:41:00.559 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40028]"]
2025-03-04 17:41:00.559 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40028]
2025-03-04 17:41:00.559 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:00.560 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40028(Long)
2025-03-04 17:41:00.562 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:00.562 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:41:00.563 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40028(Long), 0.3(Double), 40028(Long)
2025-03-04 17:41:00.570 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:41:11.290 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:41:11.291 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895791464059764794,"content":"111","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:41:11.291 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:11.294 [http-nio-8093-exec-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895791464059764794,"commentId":40044,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 17:41:11","creatorId":2100}
2025-03-04 17:41:11.294 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:41:11.295 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:41:11.295 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133E9FFE000E, offsetMsgId=AC1B600100002A9F000000000000D36B, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=15]
2025-03-04 17:41:11.296 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:41:11.296 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895791464059764794,"commentId":40044,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 17:41:11","creatorId":2100}
2025-03-04 17:41:11.297 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40044,"noteId":1895791464059764794,"userId":2100,"contentUuid":"d6af0380-423c-4f90-977a-0c89dbf82ed4","content":"111","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895791464059764794,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 17:41:11","updateTime":"2025-03-04 17:41:11"}]
2025-03-04 17:41:11.298 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:41:11.301 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40044(Long), 1895791464059764794(Long), 2100(Long), d6af0380-423c-4f90-977a-0c89dbf82ed4(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895791464059764794(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T17:41:11(LocalDateTime), 2025-03-04T17:41:11(LocalDateTime)
2025-03-04 17:41:11.303 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:41:11.335 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133EA026000F, offsetMsgId=AC1B600100002A9F000000000000D516, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=5]
2025-03-04 17:41:12.176 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:41:12.176 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895791464059764794,\"commentId\":40044,\"level\":1,\"parentId\":1895791464059764794}]"]
2025-03-04 17:41:32.807 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:41:32.808 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:41:32.816 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 17:41:32.816 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40028(Long)
2025-03-04 17:41:32.817 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 17:41:32.817 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:32.817 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40044(Long)
2025-03-04 17:41:32.818 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:32.819 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:32.840 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:32.852 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 44ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 17:41:32.853 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:41:46.024 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:41:46.024 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:41:46.026 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 17:41:46.027 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 17:41:46.028 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 17:41:46.030 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 17:41:46.030 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 17:41:46.030 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895794402190688291(Long), 0(Long), 7(Long)
2025-03-04 17:41:46.030 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895794402190688291(Long)
2025-03-04 17:41:46.033 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 17:41:46.033 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 17:41:46.034 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:46.042 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:46.055 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 31ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"55 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 17:41:46.056 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:41:50.803 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:41:50.803 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"111","imageUrl":"","replyCommentId":40026}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 17:41:50.803 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 17:41:50.806 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40045,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 17:41:50","creatorId":2100}
2025-03-04 17:41:50.806 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 17:41:50.806 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 17:41:50.807 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133F3A560010, offsetMsgId=AC1B600100002A9F000000000000D686, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=9]
2025-03-04 17:41:50.817 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 17:41:50.817 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40045,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 17:41:50","creatorId":2100}
2025-03-04 17:41:50.817 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:50.818 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 17:41:50.819 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:50.819 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40045,"noteId":1895794402190688291,"userId":2100,"contentUuid":"174f201c-a13f-4090-afc0-030093d53843","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40026,"replyCommentId":40026,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 17:41:50","updateTime":"2025-03-04 17:41:50"}]
2025-03-04 17:41:50.821 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 17:41:50.822 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40045(Long), 1895794402190688291(Long), 2100(Long), 174f201c-a13f-4090-afc0-030093d53843(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40026(Long), 40026(Long), 2100(Long), false(Boolean), 2025-03-04T17:41:50(LocalDateTime), 2025-03-04T17:41:50(LocalDateTime)
2025-03-04 17:41:50.824 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 17:41:50.847 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001F67863947C6B133F3A7E0011, offsetMsgId=AC1B600100002A9F000000000000D832, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=15]
2025-03-04 17:41:51.542 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 17:41:51.542 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40045,\"level\":2,\"parentId\":40026}]"]
2025-03-04 17:41:51.544 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:51.544 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 17:41:51.546 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:51.546 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 17:41:51.546 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40026(Long)
2025-03-04 17:41:51.547 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 17:41:51.548 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 17:41:51.548 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40045(Long), 40026(Long)
2025-03-04 17:41:51.555 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 17:41:52.718 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 17:41:52.718 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40026]"]
2025-03-04 17:41:52.718 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40026]
2025-03-04 17:41:52.719 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 17:41:52.719 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 17:41:52.721 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 17:41:52.721 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 17:41:52.721 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40026(Long), 0.3(Double), 40026(Long)
2025-03-04 17:41:52.740 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 17:41:52.884 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 17:41:52.885 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 17:41:52.898 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 17:41:52.898 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40026(Long), 40030(Long)
2025-03-04 17:41:52.900 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 17:41:52.900 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 15ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"55 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 17:41:52.900 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:11:53.059 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 18:11:53.059 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 18:11:53.059 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 18:11:53.059 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 18:11:53.064 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.064 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.066 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.066 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.069 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.069 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.071 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.071 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.102 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 18:11:53.102 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 18:11:53.104 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@a297417[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 18:11:53.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741080194768_172.17.0.1_41936
2025-03-04 18:11:53.106 [nacos-grpc-client-executor-127.0.0.1-609] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741080194768_172.17.0.1_41936]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 18:11:53.107 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4c94b601[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 610]
2025-03-04 18:11:53.107 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@1c0b4944[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 970]
2025-03-04 18:11:53.108 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 18:11:53.108 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 18:11:53.108 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 18:11:53.111 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.112 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.113 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.114 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.114 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:53.114 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:53.114 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:53.114 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:53.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:11:53.235 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:11:53.237 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 18:11:53.238 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 18:11:56.183 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:11:56.221 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:11:56.518 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:11:56.526 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:11:56.526 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 18:11:56.536 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 18:11:56.892 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 18:11:56.894 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 18:11:56.908 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 18:11:57.046 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 18:11:57.074 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.075 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.075 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.222 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.252 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.253 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.255 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.256 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x0000029e79522ac8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.257 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.260 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.260 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:11:57.390 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 18:11:57.397 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 18:11:57.397 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 18:11:57.456 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 18:11:57.456 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 918 ms
2025-03-04 18:11:57.511 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 18:11:57.706 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 18:11:57.885 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:11:57.929 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 18:11:58.226 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:58.226 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 18:11:58.250 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:58.251 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 18:11:58.286 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:11:58.296 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:11:58.327 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:58.327 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 18:11:58.355 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:11:58.355 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 18:11:58.880 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 18:11:58.884 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:11:58.885 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 18:11:58.885 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 18:11:58.885 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 18:11:58.899 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 18:11:58.899 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 18:11:58.899 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 18:11:58.902 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 18:11:58.902 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 18:11:58.904 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 18:11:58.909 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of cb72186d-2447-45db-9ea6-9f1e7f121fd2
2025-03-04 18:11:58.919 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 18:11:58.919 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 18:11:58.919 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 18:11:58.920 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 18:11:58.936 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 18:11:59.474 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741083119323_172.17.0.1_34808
2025-03-04 18:11:59.474 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Notify connected event to listeners.
2025-03-04 18:11:59.474 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 18:11:59.474 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 18:11:59.475 [main] INFO  com.alibaba.nacos.common.remote.client - [cb72186d-2447-45db-9ea6-9f1e7f121fd2] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x0000029e799b9228
2025-03-04 18:11:59.475 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 18:11:59.484 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 18:11:59.570 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 3.765 seconds (process running for 4.062)
2025-03-04 18:12:46.799 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 18:12:46.799 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 18:12:46.799 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 18:12:46.799 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 18:12:46.804 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.805 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.806 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.806 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.809 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.810 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.812 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.812 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.832 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 18:12:46.832 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 18:12:46.835 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@20c8fa84[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 18:12:46.836 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741083119323_172.17.0.1_34808
2025-03-04 18:12:46.838 [nacos-grpc-client-executor-127.0.0.1-21] WARN  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741083119323_172.17.0.1_34808]Ignore error event,isRunning:false,isAbandon=false
2025-03-04 18:12:46.840 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@1ddcf510[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 22]
2025-03-04 18:12:46.840 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2e190c56[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 15]
2025-03-04 18:12:46.840 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 18:12:46.840 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 18:12:46.840 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 18:12:46.845 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.845 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.846 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.846 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.846 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:46.847 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:46.847 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:46.847 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:46.855 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:12:46.856 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:12:46.858 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 18:12:46.862 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 18:12:50.292 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:12:50.333 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:12:50.607 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:12:50.616 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:12:50.616 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 18:12:50.628 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 18:12:51.041 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 18:12:51.043 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 18:12:51.058 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-04 18:12:51.200 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 18:12:51.232 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.233 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.233 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.389 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.422 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.424 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.426 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.427 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x0000017cdc524bf8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.428 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.432 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.433 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:12:51.557 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 18:12:51.563 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 18:12:51.563 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 18:12:51.613 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 18:12:51.613 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 983 ms
2025-03-04 18:12:51.669 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 18:12:51.862 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 18:12:52.046 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:12:52.086 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 18:12:52.410 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:52.410 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 18:12:52.440 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:52.440 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 18:12:52.486 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:12:52.501 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:12:52.534 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:52.534 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 18:12:52.558 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:12:52.558 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 18:12:53.145 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 18:12:53.149 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:12:53.149 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 18:12:53.149 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 18:12:53.149 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 18:12:53.163 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 18:12:53.163 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 18:12:53.164 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 18:12:53.166 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 18:12:53.166 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 18:12:53.168 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 18:12:53.172 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 7b1722e8-d2bc-4918-81b1-5a05b5594e64
2025-03-04 18:12:53.184 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 18:12:53.184 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 18:12:53.184 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 18:12:53.185 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 18:12:53.201 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 18:12:53.797 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741083173631_172.17.0.1_38522
2025-03-04 18:12:53.797 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Notify connected event to listeners.
2025-03-04 18:12:53.797 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 18:12:53.798 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 18:12:53.798 [main] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x0000017cdc9b98c0
2025-03-04 18:12:53.798 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 18:12:53.808 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 18:12:53.892 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 4.011 seconds (process running for 4.343)
2025-03-04 18:12:55.126 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 18:12:55.126 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 18:12:55.126 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-03-04 18:12:55.130 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:12:55.185 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:12:55.337 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:12:55.426 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895780661764030465(Long)
2025-03-04 18:12:55.437 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 18:12:55.440 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 256ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:12:55.447 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:12:58.282 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:12:58.283 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:12:58.295 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 18:12:58.296 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 18:12:58.298 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895795185766367284(Long), 0(Long), 7(Long)
2025-03-04 18:12:58.298 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895795185766367284(Long)
2025-03-04 18:12:58.305 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 19
2025-03-04 18:12:58.306 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 18:12:58.324 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 18:12:58.325 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40023(Long), 40034(Long), 40037(Long), 40038(Long), 40033(Long), 40035(Long), 40039(Long)
2025-03-04 18:12:58.327 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 7
2025-03-04 18:12:58.337 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:12:58.391 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:12:58.403 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:12:58.410 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:12:58.456 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:12:58.468 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:12:58.472 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:12:58.472 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:12:58.485 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 199ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"44 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"42 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"21 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 18:12:58.488 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:12:58.968 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Receive server push request, request = NotifySubscriberRequest, requestId = 460
2025-03-04 18:12:58.969 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Ack server push request, request = NotifySubscriberRequest, requestId = 460
2025-03-04 18:12:59.052 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Receive server push request, request = NotifySubscriberRequest, requestId = 461
2025-03-04 18:12:59.053 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Ack server push request, request = NotifySubscriberRequest, requestId = 461
2025-03-04 18:12:59.825 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:12:59.827 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:12:59.828 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:12:59.828 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895792506252034080(Long)
2025-03-04 18:12:59.830 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 18:12:59.830 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:12:59.832 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:13:14.007 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:13:14.013 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"马爸爸👻","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:13:14.013 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:13:14.025 [http-nio-8093-exec-7] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:13:14.030 [http-nio-8093-exec-7] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:13:14.030 [http-nio-8093-exec-7] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:13:14.039 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40046,"content":"马爸爸👻","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:13:14","creatorId":2100}
2025-03-04 18:13:14.045 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 33ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:13:14.047 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:13:14.061 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001863863947C6B135BF6C90000, offsetMsgId=AC1B600100002A9F000000000000DAB1, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=10]
2025-03-04 18:13:14.073 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:13:14.075 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40046,"content":"马爸爸👻","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:13:14","creatorId":2100}
2025-03-04 18:13:14.078 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40046,"noteId":1895792506252034080,"userId":2100,"contentUuid":"c6c03e64-5b67-41aa-a039-6ca51735340a","content":"马爸爸👻","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895792506252034080,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 18:13:14","updateTime":"2025-03-04 18:13:14"}]
2025-03-04 18:13:14.085 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:13:14.197 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40046(Long), 1895792506252034080(Long), 2100(Long), c6c03e64-5b67-41aa-a039-6ca51735340a(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895792506252034080(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T18:13:14(LocalDateTime), 2025-03-04T18:13:14(LocalDateTime)
2025-03-04 18:13:14.205 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:13:14.259 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001863863947C6B135BF7920001, offsetMsgId=AC1B600100002A9F000000000000DC66, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=6]
2025-03-04 18:13:14.536 [nacos-grpc-client-executor-127.0.0.1-18] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Receive server push request, request = NotifySubscriberRequest, requestId = 462
2025-03-04 18:13:14.536 [nacos-grpc-client-executor-127.0.0.1-18] INFO  com.alibaba.nacos.common.remote.client - [7b1722e8-d2bc-4918-81b1-5a05b5594e64] Ack server push request, request = NotifySubscriberRequest, requestId = 462
2025-03-04 18:13:15.285 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:13:15.286 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40046,\"level\":1,\"parentId\":1895792506252034080}]"]
2025-03-04 18:13:17.161 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:13:17.162 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:13:17.164 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 18:13:17.164 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 18:13:17.164 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895792506252034080(Long)
2025-03-04 18:13:17.165 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895792506252034080(Long), 0(Long), 7(Long)
2025-03-04 18:13:17.166 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 18:13:17.166 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 18:13:17.167 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:13:17.188 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:13:17.200 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 38ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:13:17.201 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:14:07.641 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:14:07.642 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","replyCommentId":40046}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:14:07.643 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:14:07.647 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40047,"content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 18:14:07","creatorId":2100}
2025-03-04 18:14:07.648 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:14:07.649 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:14:07.649 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001863863947C6B135CC8200002, offsetMsgId=AC1B600100002A9F000000000000DDD6, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=11]
2025-03-04 18:14:07.650 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:14:07.650 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40047,"content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 18:14:07","creatorId":2100}
2025-03-04 18:14:07.651 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:14:07.652 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 18:14:07.654 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:14:07.655 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40047,"noteId":1895792506252034080,"userId":2100,"contentUuid":"0934581a-d8ed-42b8-8e29-eec892f0e627","content":"这个时候的马云，浑身都散发着迷人的魅力😂","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40046,"replyCommentId":40046,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:14:07","updateTime":"2025-03-04 18:14:07"}]
2025-03-04 18:14:07.656 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:14:07.657 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40047(Long), 1895792506252034080(Long), 2100(Long), 0934581a-d8ed-42b8-8e29-eec892f0e627(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40046(Long), 40046(Long), 2100(Long), false(Boolean), 2025-03-04T18:14:07(LocalDateTime), 2025-03-04T18:14:07(LocalDateTime)
2025-03-04 18:14:07.659 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:14:07.687 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001863863947C6B135CC8460003, offsetMsgId=AC1B600100002A9F000000000000DFBC, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=7]
2025-03-04 18:14:07.788 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:14:07.788 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40047,\"level\":2,\"parentId\":40046}]"]
2025-03-04 18:14:07.794 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:14:07.795 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 18:14:07.797 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:14:07.798 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:14:07.799 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40046(Long)
2025-03-04 18:14:07.800 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:14:07.801 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:14:07.802 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40047(Long), 40046(Long)
2025-03-04 18:14:07.810 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:14:10.557 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:14:10.557 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40046]"]
2025-03-04 18:14:10.560 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40046]
2025-03-04 18:14:10.561 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:14:10.562 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 18:14:10.564 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:14:10.566 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:14:10.569 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40046(Long), 0.3(Double), 40046(Long)
2025-03-04 18:14:10.588 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:14:11.483 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:14:11.484 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:14:11.501 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:14:11.502 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40046(Long)
2025-03-04 18:14:11.504 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:14:11.505 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 21ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:14:11.506 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:14:38.083 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:14:38.084 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:14:38.085 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:14:38.086 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895753768780169280(Long)
2025-03-04 18:14:38.087 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 18:14:38.087 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:14:38.089 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:14:41.235 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:14:41.237 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:14:41.246 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:14:41.247 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:15:59.018 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:15:59.019 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:15:59.028 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:15:59.029 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:17:27.903 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 18:17:27.903 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 18:17:27.903 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 18:17:27.904 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 18:17:27.909 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.909 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.910 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.910 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.912 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.912 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.914 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.914 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.938 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 18:17:27.938 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@20543b2b[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 18:17:27.942 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741083173631_172.17.0.1_38522
2025-03-04 18:17:27.944 [nacos-grpc-client-executor-127.0.0.1-76] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741083173631_172.17.0.1_38522]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 18:17:27.945 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@639133f6[Running, pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 77]
2025-03-04 18:17:27.945 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@16d8f5db[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 91]
2025-03-04 18:17:27.945 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 18:17:27.945 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 18:17:27.945 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 18:17:27.949 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.949 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.951 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:27.951 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:27.951 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:27.951 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:27.951 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:27.951 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:28.064 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:17:28.064 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:17:28.066 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 18:17:28.071 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 18:17:30.918 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:17:30.958 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:17:31.277 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:17:31.287 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:17:31.287 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 18:17:31.300 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 18:17:31.664 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 18:17:31.666 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 18:17:31.681 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-04 18:17:31.824 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 18:17:31.853 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:31.854 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:31.855 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.016 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.046 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.048 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.050 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.051 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$723/0x00000200b95523d0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.052 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.056 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.056 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:17:32.191 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 18:17:32.197 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 18:17:32.198 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 18:17:32.255 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 18:17:32.256 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 954 ms
2025-03-04 18:17:32.327 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 18:17:32.550 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 18:17:32.738 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:17:32.783 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 18:17:33.115 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:33.115 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 18:17:33.138 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:33.140 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 18:17:33.819 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:17:33.849 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:17:33.904 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:33.904 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 18:17:33.965 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:17:33.965 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 18:17:34.868 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 18:17:34.876 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:17:34.876 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 18:17:34.877 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 18:17:34.878 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 18:17:34.910 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 18:17:34.910 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 18:17:34.911 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 18:17:34.916 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 18:17:34.916 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 18:17:34.920 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 18:17:34.929 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 14478828-c135-4b3e-8721-74b49d13785e
2025-03-04 18:17:34.960 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 18:17:34.960 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 18:17:34.961 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 18:17:34.964 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 18:17:35.005 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 18:17:35.898 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741083455666_172.17.0.1_56726
2025-03-04 18:17:35.899 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Notify connected event to listeners.
2025-03-04 18:17:35.899 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 18:17:35.899 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 18:17:35.900 [main] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x00000200b99f3a90
2025-03-04 18:17:35.901 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 18:17:35.917 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 18:17:36.012 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 5.584 seconds (process running for 6.472)
2025-03-04 18:17:43.088 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 18:17:43.089 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 18:17:43.089 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-03-04 18:17:43.102 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 101
2025-03-04 18:17:43.235 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:17:47.113 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:17:47.227 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 18:17:47.244 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:17:47.247 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:17:47.248 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40047(Long)
2025-03-04 18:17:47.250 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:17:50.607 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 101
2025-03-04 18:17:50.683 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:17:50.693 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 18:17:50.705 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 18:17:50.761 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 101
2025-03-04 18:17:50.769 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:17:50.772 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 18:17:50.773 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 18:17:56.362 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 13126ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:17:56.368 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Receive server push request, request = NotifySubscriberRequest, requestId = 465
2025-03-04 18:17:56.369 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Ack server push request, request = NotifySubscriberRequest, requestId = 465
2025-03-04 18:17:56.371 [nacos-grpc-client-executor-127.0.0.1-15] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Receive server push request, request = NotifySubscriberRequest, requestId = 466
2025-03-04 18:17:56.372 [nacos-grpc-client-executor-127.0.0.1-15] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Ack server push request, request = NotifySubscriberRequest, requestId = 466
2025-03-04 18:17:56.377 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 101
2025-03-04 18:17:57.208 [nacos-grpc-client-executor-127.0.0.1-16] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Receive server push request, request = NotifySubscriberRequest, requestId = 467
2025-03-04 18:17:57.208 [nacos-grpc-client-executor-127.0.0.1-16] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Ack server push request, request = NotifySubscriberRequest, requestId = 467
2025-03-04 18:17:57.308 [nacos-grpc-client-executor-127.0.0.1-17] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Receive server push request, request = NotifySubscriberRequest, requestId = 468
2025-03-04 18:17:57.308 [nacos-grpc-client-executor-127.0.0.1-17] INFO  com.alibaba.nacos.common.remote.client - [14478828-c135-4b3e-8721-74b49d13785e] Ack server push request, request = NotifySubscriberRequest, requestId = 468
2025-03-04 18:18:06.611 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:18:06.613 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:18:06.633 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:18:06.633 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40047(Long)
2025-03-04 18:18:06.635 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:18:06.637 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 24ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:18:06.638 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:21:51.185 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 18:21:51.185 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 18:21:51.185 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 18:21:51.185 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 18:21:51.189 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.189 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.190 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.191 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.193 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.193 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.195 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.195 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.210 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 18:21:51.210 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 18:21:51.213 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@6960586c[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 18:21:51.214 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741083455666_172.17.0.1_56726
2025-03-04 18:21:51.216 [nacos-grpc-client-executor-127.0.0.1-66] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741083455666_172.17.0.1_56726]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 18:21:51.216 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4d6d1934[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 67]
2025-03-04 18:21:51.217 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@42406d2c[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 83]
2025-03-04 18:21:51.217 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 18:21:51.217 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 18:21:51.217 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 18:21:51.220 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.221 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.222 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.222 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.222 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:51.223 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:51.223 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:51.223 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:51.348 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:21:51.348 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:21:51.350 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 18:21:51.355 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 18:21:54.742 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:21:54.780 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:21:55.047 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:21:55.054 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:21:55.054 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 18:21:55.065 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 18:21:55.458 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 18:21:55.460 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 18:21:55.475 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-04 18:21:55.608 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 18:21:55.637 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.638 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.639 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.812 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.840 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.842 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.848 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.849 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x000001a3fb526038] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.850 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.856 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.856 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:21:55.989 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 18:21:55.994 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 18:21:55.994 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 18:21:56.053 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 18:21:56.053 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 986 ms
2025-03-04 18:21:56.113 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 18:21:56.298 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 18:21:56.478 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:21:56.520 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 18:21:56.821 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:56.821 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 18:21:56.853 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:56.853 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 18:21:56.892 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:21:56.903 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:21:56.934 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:56.934 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 18:21:56.958 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:21:56.958 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 18:21:57.494 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 18:21:57.497 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:21:57.497 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 18:21:57.498 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 18:21:57.498 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 18:21:57.511 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 18:21:57.512 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 18:21:57.512 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 18:21:57.514 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 18:21:57.514 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 18:21:57.516 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 18:21:57.522 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of f42dddb4-872d-4c41-94f5-fa97c995bcc9
2025-03-04 18:21:57.532 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 18:21:57.532 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 18:21:57.532 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 18:21:57.533 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 18:21:57.548 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 18:21:58.094 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741083717939_172.17.0.1_58772
2025-03-04 18:21:58.094 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Notify connected event to listeners.
2025-03-04 18:21:58.094 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 18:21:58.095 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 18:21:58.095 [main] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000001a3fb9b9228
2025-03-04 18:21:58.096 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 18:21:58.160 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 18:21:58.247 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 3.886 seconds (process running for 4.218)
2025-03-04 18:22:06.700 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 18:22:06.700 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 18:22:06.701 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-03-04 18:22:06.708 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:06.792 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:07.076 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 18:22:07.076 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 18:22:07.250 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791464059764794(Long), 0(Long), 7(Long)
2025-03-04 18:22:07.250 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791464059764794(Long)
2025-03-04 18:22:07.270 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 18:22:07.272 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 18:22:07.291 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:22:07.292 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40043(Long)
2025-03-04 18:22:07.295 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:22:07.307 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:07.371 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:22:07.386 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:07.394 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:07.437 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:07.450 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:22:07.455 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:07.455 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:07.468 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 674ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"40 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:07.479 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:07.899 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Receive server push request, request = NotifySubscriberRequest, requestId = 471
2025-03-04 18:22:07.899 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Ack server push request, request = NotifySubscriberRequest, requestId = 471
2025-03-04 18:22:07.985 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Receive server push request, request = NotifySubscriberRequest, requestId = 472
2025-03-04 18:22:07.985 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Ack server push request, request = NotifySubscriberRequest, requestId = 472
2025-03-04 18:22:11.931 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:11.932 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:11.958 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 18:22:11.958 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40043(Long), 40044(Long)
2025-03-04 18:22:11.961 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 18:22:11.962 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 30ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"40 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:11.964 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:19.656 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:19.661 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895791464059764794,"content":"好美呀","imageUrl":"","replyCommentId":40044}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:22:19.662 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:19.673 [http-nio-8093-exec-3] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:22:19.678 [http-nio-8093-exec-3] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:19.678 [http-nio-8093-exec-3] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:22:19.686 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895791464059764794,"commentId":40048,"content":"好美呀","imageUrl":"","replyCommentId":40044,"createTime":"2025-03-04 18:22:19","creatorId":2100}
2025-03-04 18:22:19.691 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 29ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:22:19.693 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:19.707 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B13644A370000, offsetMsgId=AC1B600100002A9F000000000000E23B, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=8]
2025-03-04 18:22:19.720 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:22:19.721 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895791464059764794,"commentId":40048,"content":"好美呀","imageUrl":"","replyCommentId":40044,"createTime":"2025-03-04 18:22:19","creatorId":2100}
2025-03-04 18:22:19.723 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:19.723 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40044(Long)
2025-03-04 18:22:19.726 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:19.728 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40048,"noteId":1895791464059764794,"userId":2100,"contentUuid":"6739852c-c102-4198-88fb-ddb0377c6d42","content":"好美呀","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40044,"replyCommentId":40044,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:22:19","updateTime":"2025-03-04 18:22:19"}]
2025-03-04 18:22:19.734 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:22:19.841 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40048(Long), 1895791464059764794(Long), 2100(Long), 6739852c-c102-4198-88fb-ddb0377c6d42(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40044(Long), 40044(Long), 2100(Long), false(Boolean), 2025-03-04T18:22:19(LocalDateTime), 2025-03-04T18:22:19(LocalDateTime)
2025-03-04 18:22:19.847 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:22:19.879 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B13644AE60001, offsetMsgId=AC1B600100002A9F000000000000E3ED, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=16]
2025-03-04 18:22:20.220 [nacos-grpc-client-executor-127.0.0.1-18] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Receive server push request, request = NotifySubscriberRequest, requestId = 473
2025-03-04 18:22:20.221 [nacos-grpc-client-executor-127.0.0.1-18] INFO  com.alibaba.nacos.common.remote.client - [f42dddb4-872d-4c41-94f5-fa97c995bcc9] Ack server push request, request = NotifySubscriberRequest, requestId = 473
2025-03-04 18:22:20.890 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:22:20.891 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895791464059764794,\"commentId\":40048,\"level\":2,\"parentId\":40044}]"]
2025-03-04 18:22:20.896 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:20.897 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40044(Long)
2025-03-04 18:22:20.899 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:20.900 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:22:20.901 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40044(Long)
2025-03-04 18:22:20.902 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:22:20.904 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:22:20.905 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40048(Long), 40044(Long)
2025-03-04 18:22:20.913 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:22:21.947 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:21.949 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:21.961 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:21.961 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40044(Long)
2025-03-04 18:22:21.963 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:21.963 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:22:21.964 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40048(Long)
2025-03-04 18:22:21.966 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:22:21.966 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:21.971 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:22:21.971 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40044]"]
2025-03-04 18:22:21.976 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40044]
2025-03-04 18:22:21.976 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:21.978 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40044(Long)
2025-03-04 18:22:21.979 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:21.980 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:21.982 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:22:21.983 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40044(Long), 0.3(Double), 40044(Long)
2025-03-04 18:22:21.989 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 41ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40048,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"好美呀","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.0}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:21.990 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:21.993 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:22:25.145 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:25.146 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:25.155 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:22:25.156 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40048(Long)
2025-03-04 18:22:25.158 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:22:25.158 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40048,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"好美呀","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.0},{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:25.159 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:26.603 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:26.604 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:26.616 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40048,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"好美呀","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.0},{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"41 分钟前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:26.617 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:29.492 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:29.494 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:29.496 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:22:29.496 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793960295596052(Long)
2025-03-04 18:22:29.499 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 18:22:29.502 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 18:22:29.502 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 18:22:29.503 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895793960295596052(Long)
2025-03-04 18:22:29.503 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895793960295596052(Long), 0(Long), 7(Long)
2025-03-04 18:22:29.509 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 18:22:29.510 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 18:22:29.510 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:29.530 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:29.542 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 48ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:29.543 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:34.587 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:34.588 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"怎么了","imageUrl":"","replyCommentId":40029}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:22:34.588 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:34.591 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40049,"content":"怎么了","imageUrl":"","replyCommentId":40029,"createTime":"2025-03-04 18:22:34","creatorId":2100}
2025-03-04 18:22:34.591 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:22:34.592 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:34.592 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B1364845F0002, offsetMsgId=AC1B600100002A9F000000000000E66C, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=12]
2025-03-04 18:22:34.594 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:22:34.594 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40049,"content":"怎么了","imageUrl":"","replyCommentId":40029,"createTime":"2025-03-04 18:22:34","creatorId":2100}
2025-03-04 18:22:34.595 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:34.595 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40029(Long)
2025-03-04 18:22:34.597 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:34.598 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40049,"noteId":1895793960295596052,"userId":2100,"contentUuid":"4ec82506-7449-46d5-b962-31109ad52509","content":"怎么了","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40029,"replyCommentId":40029,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:22:34","updateTime":"2025-03-04 18:22:34"}]
2025-03-04 18:22:34.599 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:22:34.600 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40049(Long), 1895793960295596052(Long), 2100(Long), 4ec82506-7449-46d5-b962-31109ad52509(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40029(Long), 40029(Long), 2100(Long), false(Boolean), 2025-03-04T18:22:34(LocalDateTime), 2025-03-04T18:22:34(LocalDateTime)
2025-03-04 18:22:34.602 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:22:34.633 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136484880003, offsetMsgId=AC1B600100002A9F000000000000E81E, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=17]
2025-03-04 18:22:35.053 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:22:35.053 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40049,\"level\":2,\"parentId\":40029}]"]
2025-03-04 18:22:35.055 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:35.056 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40029(Long)
2025-03-04 18:22:35.059 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:35.059 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:22:35.060 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40029(Long)
2025-03-04 18:22:35.062 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:22:35.062 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:22:35.062 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40049(Long), 40029(Long)
2025-03-04 18:22:35.070 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:22:36.062 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:22:36.062 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40029]"]
2025-03-04 18:22:36.062 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40029]
2025-03-04 18:22:36.062 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:36.063 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40029(Long)
2025-03-04 18:22:36.065 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:36.066 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:22:36.066 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40029(Long), 0.3(Double), 40029(Long)
2025-03-04 18:22:36.151 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:22:36.769 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:36.770 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:36.781 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:22:36.782 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40025(Long)
2025-03-04 18:22:36.783 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:22:36.784 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:22:36.785 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40029(Long)
2025-03-04 18:22:36.786 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:22:36.787 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:22:36.787 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40049(Long)
2025-03-04 18:22:36.789 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:22:36.790 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:36.812 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:22:36.824 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 54ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:36.825 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:39.192 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:39.194 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:39.210 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 18:22:39.210 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40029(Long), 40049(Long)
2025-03-04 18:22:39.212 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 18:22:39.212 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 18ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:39.213 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:40.622 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:40.623 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:40.633 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:22:40.634 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:44.034 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:44.035 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:44.037 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:22:44.038 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:47.234 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:47.235 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794954152706064,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:47.236 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:22:47.236 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:49.655 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:49.656 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794954152706064,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:49.658 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:22:49.659 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:22:58.441 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:22:58.443 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:22:58.445 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:22:58.446 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:23:00.438 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:23:00.439 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:23:00.446 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:23:00.447 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:23:05.362 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:23:05.362 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"丫丫","imageUrl":"","replyCommentId":40049}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:23:05.363 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:23:05.366 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40050,"content":"丫丫","imageUrl":"","replyCommentId":40049,"createTime":"2025-03-04 18:23:05","creatorId":2100}
2025-03-04 18:23:05.367 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:23:05.367 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:23:05.368 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B1364FC970004, offsetMsgId=AC1B600100002A9F000000000000EA9D, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=11]
2025-03-04 18:23:05.369 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:23:05.369 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40050,"content":"丫丫","imageUrl":"","replyCommentId":40049,"createTime":"2025-03-04 18:23:05","creatorId":2100}
2025-03-04 18:23:05.369 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:23:05.370 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40049(Long)
2025-03-04 18:23:05.372 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:23:05.373 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40050,"noteId":1895793960295596052,"userId":2100,"contentUuid":"5c16c2de-5614-4a99-963e-106bda9cc8e7","content":"丫丫","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40029,"replyCommentId":40049,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:23:05","updateTime":"2025-03-04 18:23:05"}]
2025-03-04 18:23:05.374 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:23:05.375 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40050(Long), 1895793960295596052(Long), 2100(Long), 5c16c2de-5614-4a99-963e-106bda9cc8e7(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40029(Long), 40049(Long), 2100(Long), false(Boolean), 2025-03-04T18:23:05(LocalDateTime), 2025-03-04T18:23:05(LocalDateTime)
2025-03-04 18:23:05.377 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:23:05.400 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B1364FCB70005, offsetMsgId=AC1B600100002A9F000000000000EC4C, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=18]
2025-03-04 18:23:06.272 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:23:06.272 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40029]"]
2025-03-04 18:23:06.272 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40029]
2025-03-04 18:23:06.272 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:23:06.273 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40029(Long)
2025-03-04 18:23:06.275 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:23:06.275 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:23:06.276 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40029(Long), 0.6(Double), 40029(Long)
2025-03-04 18:23:06.282 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:23:06.349 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:23:06.349 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40050,\"level\":2,\"parentId\":40029}]"]
2025-03-04 18:23:09.202 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:23:09.203 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:23:09.204 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:23:09.205 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:23:10.955 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:23:10.957 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:23:10.965 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:23:10.966 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:26.279 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:26.281 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:32:26.283 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:32:26.284 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:29.783 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:29.785 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895755651829727273,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:32:29.786 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:32:29.787 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895755651829727273(Long)
2025-03-04 18:32:29.789 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 18:32:29.789 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:32:29.791 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:32.851 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:32.852 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895756189493362701,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:32:32.853 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:32:32.854 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:34.914 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:34.915 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:32:34.923 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:32:34.924 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:46.304 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:46.305 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"法第三方士大夫","imageUrl":"","replyCommentId":40025}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:32:46.305 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:32:46.310 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40051,"content":"法第三方士大夫","imageUrl":"","replyCommentId":40025,"createTime":"2025-03-04 18:32:46","creatorId":2100}
2025-03-04 18:32:46.310 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:32:46.311 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:46.311 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136DD9E60006, offsetMsgId=AC1B600100002A9F000000000000EECB, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=12]
2025-03-04 18:32:46.312 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:32:46.312 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40051,"content":"法第三方士大夫","imageUrl":"","replyCommentId":40025,"createTime":"2025-03-04 18:32:46","creatorId":2100}
2025-03-04 18:32:46.312 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:32:46.313 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40025(Long)
2025-03-04 18:32:46.315 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:32:46.315 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40051,"noteId":1895793960295596052,"userId":2100,"contentUuid":"2d1a1ca7-5e83-46bb-9ed6-44c55436f51d","content":"法第三方士大夫","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40025,"replyCommentId":40025,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:32:46","updateTime":"2025-03-04 18:32:46"}]
2025-03-04 18:32:46.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:32:46.317 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40051(Long), 1895793960295596052(Long), 2100(Long), 2d1a1ca7-5e83-46bb-9ed6-44c55436f51d(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40025(Long), 40025(Long), 2100(Long), false(Boolean), 2025-03-04T18:32:46(LocalDateTime), 2025-03-04T18:32:46(LocalDateTime)
2025-03-04 18:32:46.318 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:32:46.344 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136DDA070007, offsetMsgId=AC1B600100002A9F000000000000F089, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=12]
2025-03-04 18:32:46.575 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:32:46.575 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40051,\"level\":2,\"parentId\":40025}]"]
2025-03-04 18:32:46.577 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:32:46.577 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40025(Long)
2025-03-04 18:32:46.579 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:32:46.580 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:32:46.580 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40025(Long)
2025-03-04 18:32:46.581 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:32:46.581 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:32:46.582 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40051(Long), 40025(Long)
2025-03-04 18:32:46.588 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:32:48.352 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:32:48.352 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40025]"]
2025-03-04 18:32:48.352 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40025]
2025-03-04 18:32:48.352 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:32:48.353 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40025(Long)
2025-03-04 18:32:48.355 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:32:48.356 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:32:48.356 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40025(Long), 0.3(Double), 40025(Long)
2025-03-04 18:32:48.364 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:32:49.507 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:32:49.508 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"发送到发顺丰","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:32:49.508 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:32:49.510 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40052,"content":"发送到发顺丰","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:32:49","creatorId":2100}
2025-03-04 18:32:49.510 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:32:49.511 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:32:49.511 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136DE6670008, offsetMsgId=AC1B600100002A9F000000000000F308, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=16]
2025-03-04 18:32:49.522 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:32:49.522 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40052,"content":"发送到发顺丰","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:32:49","creatorId":2100}
2025-03-04 18:32:49.522 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40052,"noteId":1895793960295596052,"userId":2100,"contentUuid":"41dad185-3aa8-43ec-bf5d-f42743666a93","content":"发送到发顺丰","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 18:32:49","updateTime":"2025-03-04 18:32:49"}]
2025-03-04 18:32:49.524 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:32:49.525 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40052(Long), 1895793960295596052(Long), 2100(Long), 41dad185-3aa8-43ec-bf5d-f42743666a93(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T18:32:49(LocalDateTime), 2025-03-04T18:32:49(LocalDateTime)
2025-03-04 18:32:49.526 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:32:49.549 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136DE68C0009, offsetMsgId=AC1B600100002A9F000000000000F4C2, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=13]
2025-03-04 18:32:49.613 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:32:49.613 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40052,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 18:33:08.292 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:08.293 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"范德萨范德萨","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:33:08.293 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:33:08.296 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40053,"content":"范德萨范德萨","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:33:08","creatorId":2100}
2025-03-04 18:33:08.297 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:33:08.297 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:08.298 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136E2FC9000A, offsetMsgId=AC1B600100002A9F000000000000F632, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=9]
2025-03-04 18:33:08.299 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:33:08.299 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40053,"content":"范德萨范德萨","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:33:08","creatorId":2100}
2025-03-04 18:33:08.299 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40053,"noteId":1895793960295596052,"userId":2100,"contentUuid":"5daae1ed-5ec0-4809-bea6-42b616a4a7e7","content":"范德萨范德萨","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 18:33:08","updateTime":"2025-03-04 18:33:08"}]
2025-03-04 18:33:08.301 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:33:08.302 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40053(Long), 1895793960295596052(Long), 2100(Long), 5daae1ed-5ec0-4809-bea6-42b616a4a7e7(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T18:33:08(LocalDateTime), 2025-03-04T18:33:08(LocalDateTime)
2025-03-04 18:33:08.305 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:33:08.336 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136E2FF0000B, offsetMsgId=AC1B600100002A9F000000000000F7EC, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=19]
2025-03-04 18:33:08.803 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:33:08.803 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40053,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 18:33:11.298 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:11.299 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:33:11.301 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:33:11.301 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:12.812 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:12.813 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:33:12.822 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? )
2025-03-04 18:33:12.822 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40025(Long), 40053(Long), 40052(Long)
2025-03-04 18:33:12.825 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 3
2025-03-04 18:33:12.825 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:33:12.826 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40051(Long)
2025-03-04 18:33:12.827 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:33:12.828 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:33:12.851 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:33:12.856 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 42ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:33:12.856 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:50.056 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:50.057 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:33:50.065 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 18:33:50.065 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40051(Long), 40053(Long), 40052(Long)
2025-03-04 18:33:50.066 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 18:33:50.067 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:33:50.067 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:50.102 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:50.103 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:33:50.110 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:33:50.110 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40030(Long)
2025-03-04 18:33:50.111 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:33:50.111 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"55 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:33:50.112 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:57.762 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:33:57.763 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40053}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:33:57.763 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:33:57.766 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40054,"content":"111","imageUrl":"","replyCommentId":40053,"createTime":"2025-03-04 18:33:57","creatorId":2100}
2025-03-04 18:33:57.766 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:33:57.767 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:33:57.767 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136EF107000C, offsetMsgId=AC1B600100002A9F000000000000F95C, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=13]
2025-03-04 18:33:57.768 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:33:57.769 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40054,"content":"111","imageUrl":"","replyCommentId":40053,"createTime":"2025-03-04 18:33:57","creatorId":2100}
2025-03-04 18:33:57.769 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:33:57.769 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40053(Long)
2025-03-04 18:33:57.771 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:33:57.771 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40054,"noteId":1895793960295596052,"userId":2100,"contentUuid":"44cec402-6213-45a5-9d8c-ac108017dd5d","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40053,"replyCommentId":40053,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:33:57","updateTime":"2025-03-04 18:33:57"}]
2025-03-04 18:33:57.772 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:33:57.773 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40054(Long), 1895793960295596052(Long), 2100(Long), 44cec402-6213-45a5-9d8c-ac108017dd5d(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40053(Long), 40053(Long), 2100(Long), false(Boolean), 2025-03-04T18:33:57(LocalDateTime), 2025-03-04T18:33:57(LocalDateTime)
2025-03-04 18:33:57.775 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:33:57.795 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136EF123000D, offsetMsgId=AC1B600100002A9F000000000000FB08, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=11]
2025-03-04 18:33:58.294 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:33:58.294 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40054,\"level\":2,\"parentId\":40053}]"]
2025-03-04 18:33:58.296 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:33:58.296 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40053(Long)
2025-03-04 18:33:58.298 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:33:58.298 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:33:58.298 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40053(Long)
2025-03-04 18:33:58.300 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:33:58.300 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:33:58.300 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40054(Long), 40053(Long)
2025-03-04 18:33:58.308 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:33:58.637 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:33:58.637 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40053]"]
2025-03-04 18:33:58.637 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40053]
2025-03-04 18:33:58.638 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:33:58.638 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40053(Long)
2025-03-04 18:33:58.640 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:33:58.641 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:33:58.642 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40053(Long), 0.3(Double), 40053(Long)
2025-03-04 18:33:58.651 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:34:00.747 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:00.747 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:34:00.748 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:00.750 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40055,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:34:00","creatorId":2100}
2025-03-04 18:34:00.750 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:34:00.751 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:00.752 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136EFCAE000E, offsetMsgId=AC1B600100002A9F000000000000FD87, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=10]
2025-03-04 18:34:00.753 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:34:00.753 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40055,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:34:00","creatorId":2100}
2025-03-04 18:34:00.754 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40055,"noteId":1895793960295596052,"userId":2100,"contentUuid":"b9a8df23-9d91-43ab-a403-6320a31afba8","content":"111","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 18:34:00","updateTime":"2025-03-04 18:34:00"}]
2025-03-04 18:34:00.755 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:34:00.757 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40055(Long), 1895793960295596052(Long), 2100(Long), b9a8df23-9d91-43ab-a403-6320a31afba8(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T18:34(LocalDateTime), 2025-03-04T18:34(LocalDateTime)
2025-03-04 18:34:00.760 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:34:00.780 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136EFCCB000F, offsetMsgId=AC1B600100002A9F000000000000FF32, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=14]
2025-03-04 18:34:01.338 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:34:01.338 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40055,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 18:34:06.080 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:06.081 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:06.089 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 18:34:06.089 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40053(Long), 40055(Long)
2025-03-04 18:34:06.091 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 18:34:06.091 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:34:06.092 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40054(Long)
2025-03-04 18:34:06.093 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:34:06.093 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:06.113 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:06.124 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 43ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":8,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:06.125 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:08.861 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:08.862 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:08.865 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":8,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:08.866 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:13.099 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:13.101 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"2222","imageUrl":"","replyCommentId":40052}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:34:13.101 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:13.103 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40056,"content":"2222","imageUrl":"","replyCommentId":40052,"createTime":"2025-03-04 18:34:13","creatorId":2100}
2025-03-04 18:34:13.103 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:34:13.104 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:13.104 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F2CEF0010, offsetMsgId=AC1B600100002A9F00000000000100A2, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=11]
2025-03-04 18:34:13.114 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:34:13.114 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40056,"content":"2222","imageUrl":"","replyCommentId":40052,"createTime":"2025-03-04 18:34:13","creatorId":2100}
2025-03-04 18:34:13.115 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:34:13.115 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40052(Long)
2025-03-04 18:34:13.117 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:34:13.117 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40056,"noteId":1895793960295596052,"userId":2100,"contentUuid":"e0683c52-ca33-40af-ba50-721335b23aeb","content":"2222","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40052,"replyCommentId":40052,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:34:13","updateTime":"2025-03-04 18:34:13"}]
2025-03-04 18:34:13.118 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:34:13.119 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40056(Long), 1895793960295596052(Long), 2100(Long), e0683c52-ca33-40af-ba50-721335b23aeb(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40052(Long), 40052(Long), 2100(Long), false(Boolean), 2025-03-04T18:34:13(LocalDateTime), 2025-03-04T18:34:13(LocalDateTime)
2025-03-04 18:34:13.120 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:34:13.139 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F2D130011, offsetMsgId=AC1B600100002A9F000000000001024F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=12]
2025-03-04 18:34:13.449 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:34:13.449 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40056,\"level\":2,\"parentId\":40052}]"]
2025-03-04 18:34:13.456 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:34:13.456 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40052(Long)
2025-03-04 18:34:13.458 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:34:13.458 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:34:13.458 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40052(Long)
2025-03-04 18:34:13.460 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:34:13.461 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:34:13.461 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40056(Long), 40052(Long)
2025-03-04 18:34:13.481 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:34:14.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:34:14.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40052]"]
2025-03-04 18:34:14.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40052]
2025-03-04 18:34:14.692 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:34:14.692 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40052(Long)
2025-03-04 18:34:14.696 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:34:14.696 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:34:14.697 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40052(Long), 0.3(Double), 40052(Long)
2025-03-04 18:34:14.706 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:34:16.443 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:16.444 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"2222","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:34:16.444 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:16.446 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40057,"content":"2222","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:34:16","creatorId":2100}
2025-03-04 18:34:16.446 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:34:16.447 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:16.447 [NettyClientPublicExecutor_19] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F39FE0012, offsetMsgId=AC1B600100002A9F00000000000104CE, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=14]
2025-03-04 18:34:16.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:34:16.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40057,"content":"2222","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 18:34:16","creatorId":2100}
2025-03-04 18:34:16.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40057,"noteId":1895793960295596052,"userId":2100,"contentUuid":"e67ee86c-e260-481b-9555-3be3f9774b0f","content":"2222","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 18:34:16","updateTime":"2025-03-04 18:34:16"}]
2025-03-04 18:34:16.459 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:34:16.460 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40057(Long), 1895793960295596052(Long), 2100(Long), e67ee86c-e260-481b-9555-3be3f9774b0f(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T18:34:16(LocalDateTime), 2025-03-04T18:34:16(LocalDateTime)
2025-03-04 18:34:16.462 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:34:16.479 [NettyClientPublicExecutor_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F3A1F0013, offsetMsgId=AC1B600100002A9F000000000001067A, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=13]
2025-03-04 18:34:16.512 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:34:16.512 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40057,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 18:34:21.532 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:21.533 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:21.541 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 18:34:21.542 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40054(Long), 40055(Long)
2025-03-04 18:34:21.543 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 18:34:21.544 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 18:34:21.544 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40052(Long), 40057(Long)
2025-03-04 18:34:21.546 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 18:34:21.546 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:34:21.547 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40056(Long)
2025-03-04 18:34:21.548 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:34:21.548 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:21.565 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:21.576 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 43ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":10,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:21.577 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:23.650 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:23.651 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:23.654 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":10,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:23.655 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:32.251 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:32.252 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"3333","imageUrl":"","replyCommentId":40056}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:34:32.252 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:32.255 [http-nio-8093-exec-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40058,"content":"3333","imageUrl":"","replyCommentId":40056,"createTime":"2025-03-04 18:34:32","creatorId":2100}
2025-03-04 18:34:32.255 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:34:32.256 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:32.256 [NettyClientPublicExecutor_21] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F77BF0014, offsetMsgId=AC1B600100002A9F00000000000107EA, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=17]
2025-03-04 18:34:32.257 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:34:32.258 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40058,"content":"3333","imageUrl":"","replyCommentId":40056,"createTime":"2025-03-04 18:34:32","creatorId":2100}
2025-03-04 18:34:32.258 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:34:32.258 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40056(Long)
2025-03-04 18:34:32.260 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:34:32.261 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40058,"noteId":1895793960295596052,"userId":2100,"contentUuid":"9971c101-88a0-45db-b527-6d4e0042712c","content":"3333","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40052,"replyCommentId":40056,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:34:32","updateTime":"2025-03-04 18:34:32"}]
2025-03-04 18:34:32.262 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:34:32.262 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40058(Long), 1895793960295596052(Long), 2100(Long), 9971c101-88a0-45db-b527-6d4e0042712c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40052(Long), 40056(Long), 2100(Long), false(Boolean), 2025-03-04T18:34:32(LocalDateTime), 2025-03-04T18:34:32(LocalDateTime)
2025-03-04 18:34:32.264 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:34:32.295 [NettyClientPublicExecutor_22] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D9B863947C6B136F77E60015, offsetMsgId=AC1B600100002A9F0000000000010997, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=8]
2025-03-04 18:34:32.665 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:34:32.665 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40058,\"level\":2,\"parentId\":40052}]"]
2025-03-04 18:34:42.256 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:42.258 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:42.267 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 18:34:42.268 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40056(Long), 40057(Long)
2025-03-04 18:34:42.269 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 18:34:42.270 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:42.271 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:45.326 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:45.326 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:34:45.329 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:34:45.330 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:57.985 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:34:57.986 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"啦啦啦","imageUrl":"","replyCommentId":40055}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:34:57.986 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:34:57.988 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40059,"content":"啦啦啦","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:34:57","creatorId":2100}
2025-03-04 18:34:57.988 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:34:57.989 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:34:57.998 [NettyClientPublicExecutor_23] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送异常: 
org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.access$000(MQClientAPIImpl.java:175)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl$1.operationComplete(MQClientAPIImpl.java:564)
	at org.apache.rocketmq.remoting.netty.ResponseFuture.executeInvokeCallback(ResponseFuture.java:54)
	at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract$2.run(NettyRemotingAbstract.java:321)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-03-04 18:34:58.001 [NoteExecutor-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 1, 时间: 2025-03-04T18:34:58.001974700
2025-03-04 18:34:58.005 [NoteExecutor-10] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40059,"content":"啦啦啦","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:34:57","creatorId":2100}, headers={id=779c73cf-597d-1528-1554-c36c960bb35a, timestamp=1741084497988}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:00.006 [NoteExecutor-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 2, 时间: 2025-03-04T18:35:00.006840600
2025-03-04 18:35:00.010 [NoteExecutor-10] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40059,"content":"啦啦啦","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:34:57","creatorId":2100}, headers={id=779c73cf-597d-1528-1554-c36c960bb35a, timestamp=1741084497988}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [4]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:04.021 [NoteExecutor-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 3, 时间: 2025-03-04T18:35:04.021347700
2025-03-04 18:35:04.024 [NoteExecutor-10] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40059,"content":"啦啦啦","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:34:57","creatorId":2100}, headers={id=779c73cf-597d-1528-1554-c36c960bb35a, timestamp=1741084497988}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:04.024 [NoteExecutor-10] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 多次发送失败, 进入兜底方案, Topic: PublishCommentTopic, bodyJson: {"noteId":1895793960295596052,"commentId":40059,"content":"啦啦啦","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:34:57","creatorId":2100}
2025-03-04 18:35:08.296 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:08.296 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:08.297 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 18:35:08.298 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:09.974 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:09.975 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:09.982 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:09.983 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:11.129 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:11.130 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:11.134 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:11.134 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:19.014 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:19.015 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:19.021 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:19.021 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:21.972 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:21.973 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:21.978 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:21.979 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:46.067 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:46.067 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:35:46.068 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:35:46.070 [http-nio-8093-exec-9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40060,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 18:35:46","creatorId":2100}
2025-03-04 18:35:46.071 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:35:46.071 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:46.076 [NettyClientPublicExecutor_24] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送异常: 
org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.access$000(MQClientAPIImpl.java:175)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl$1.operationComplete(MQClientAPIImpl.java:564)
	at org.apache.rocketmq.remoting.netty.ResponseFuture.executeInvokeCallback(ResponseFuture.java:54)
	at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract$2.run(NettyRemotingAbstract.java:321)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-03-04 18:35:46.076 [NoteExecutor-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 1, 时间: 2025-03-04T18:35:46.076790800
2025-03-04 18:35:46.082 [NoteExecutor-3] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40060,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 18:35:46","creatorId":2100}, headers={id=6a08d0c4-e641-35d3-a855-88e26aa46a80, timestamp=1741084546070}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [5]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:48.092 [NoteExecutor-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 2, 时间: 2025-03-04T18:35:48.092574400
2025-03-04 18:35:48.095 [NoteExecutor-3] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40060,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 18:35:46","creatorId":2100}, headers={id=6a08d0c4-e641-35d3-a855-88e26aa46a80, timestamp=1741084546070}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:52.105 [NoteExecutor-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 3, 时间: 2025-03-04T18:35:52.105840300
2025-03-04 18:35:52.109 [NoteExecutor-3] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40060,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 18:35:46","creatorId":2100}, headers={id=6a08d0c4-e641-35d3-a855-88e26aa46a80, timestamp=1741084546070}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [4]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:35:52.109 [NoteExecutor-3] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 多次发送失败, 进入兜底方案, Topic: PublishCommentTopic, bodyJson: {"noteId":1895793960295596052,"commentId":40060,"content":"电风扇的范德萨","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 18:35:46","creatorId":2100}
2025-03-04 18:35:54.431 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:54.431 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:54.437 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:54.438 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:35:56.209 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:35:56.209 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:35:56.213 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 18:35:56.213 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:37:41.148 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:37:41.149 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:37:41.149 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:37:41.153 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40061,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:37:41","creatorId":2100}
2025-03-04 18:37:41.153 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:37:41.153 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:37:41.156 [NettyClientPublicExecutor_25] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送异常: 
org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.access$000(MQClientAPIImpl.java:175)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl$1.operationComplete(MQClientAPIImpl.java:564)
	at org.apache.rocketmq.remoting.netty.ResponseFuture.executeInvokeCallback(ResponseFuture.java:54)
	at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract$2.run(NettyRemotingAbstract.java:321)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-03-04 18:37:41.156 [NoteExecutor-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 1, 时间: 2025-03-04T18:37:41.156706400
2025-03-04 18:37:41.160 [NoteExecutor-6] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40061,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:37:41","creatorId":2100}, headers={id=540b65e4-51f9-2cd6-2e56-8a5ca29e4116, timestamp=1741084661153}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [2]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:37:43.168 [NoteExecutor-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 2, 时间: 2025-03-04T18:37:43.168140200
2025-03-04 18:37:43.171 [NoteExecutor-6] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40061,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:37:41","creatorId":2100}, headers={id=540b65e4-51f9-2cd6-2e56-8a5ca29e4116, timestamp=1741084661153}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:37:47.181 [NoteExecutor-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 3, 时间: 2025-03-04T18:37:47.181399100
2025-03-04 18:37:47.184 [NoteExecutor-6] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40061,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:37:41","creatorId":2100}, headers={id=540b65e4-51f9-2cd6-2e56-8a5ca29e4116, timestamp=1741084661153}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 14 common frames omitted
2025-03-04 18:37:47.186 [NoteExecutor-6] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 多次发送失败, 进入兜底方案, Topic: PublishCommentTopic, bodyJson: {"noteId":1895793960295596052,"commentId":40061,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 18:37:41","creatorId":2100}
2025-03-04 18:57:54.411 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 18:57:54.411 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 18:57:54.411 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 18:57:54.412 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 18:57:54.422 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.422 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.425 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.425 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.428 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.428 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.431 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.431 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.468 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 18:57:54.468 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@795249b5[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 18:57:54.473 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741083717939_172.17.0.1_58772
2025-03-04 18:57:54.475 [nacos-grpc-client-executor-127.0.0.1-462] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741083717939_172.17.0.1_58772]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 18:57:54.476 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@54b994c4[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 463]
2025-03-04 18:57:54.476 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@5b861bef[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 717]
2025-03-04 18:57:54.477 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 18:57:54.477 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 18:57:54.477 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 18:57:54.481 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.481 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.483 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.483 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.483 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:54.483 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:54.484 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:54.484 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:54.605 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 18:57:54.605 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 18:57:54.608 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 18:57:54.608 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 18:57:56.468 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:57:56.516 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:57:56.891 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:57:56.899 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:57:56.899 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 18:57:56.910 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 18:57:57.247 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 18:57:57.248 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 18:57:57.264 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 18:57:57.410 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 18:57:57.441 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.442 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.442 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.595 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.636 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.638 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.640 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.641 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$724/0x0000024bba5273c8] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.642 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.648 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.648 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 18:57:57.784 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 18:57:57.789 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 18:57:57.789 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 18:57:57.849 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 18:57:57.850 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 937 ms
2025-03-04 18:57:57.914 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 18:57:58.117 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 18:57:58.288 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:57:58.327 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 18:57:58.625 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:58.625 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 18:57:58.651 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:58.651 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 18:57:58.691 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:57:58.706 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 18:57:58.739 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:58.739 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 18:57:58.766 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 18:57:58.766 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 18:57:59.304 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 18:57:59.308 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 18:57:59.308 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 18:57:59.308 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 18:57:59.308 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 18:57:59.322 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 18:57:59.322 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 18:57:59.322 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 18:57:59.325 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 18:57:59.325 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 18:57:59.327 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 18:57:59.332 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8
2025-03-04 18:57:59.343 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 18:57:59.343 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 18:57:59.343 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 18:57:59.345 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 18:57:59.359 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 18:57:59.971 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741085879832_172.17.0.1_55494
2025-03-04 18:57:59.971 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Notify connected event to listeners.
2025-03-04 18:57:59.971 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 18:57:59.971 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 18:57:59.972 [main] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x0000024bba9b3e98
2025-03-04 18:57:59.972 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 18:57:59.982 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 18:58:00.065 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 4.01 seconds (process running for 4.314)
2025-03-04 18:58:34.896 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 18:58:34.896 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 18:58:34.897 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-03-04 18:58:34.905 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:58:34.994 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:58:35.274 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 18:58:35.434 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 18:58:35.453 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 18:58:35.509 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 516ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"55 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:58:35.522 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:58:38.207 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:58:38.212 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"111","imageUrl":"","replyCommentId":40030}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:58:38.213 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:58:38.268 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:58:38.319 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:38.330 [http-nio-8093-exec-2] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:38.365 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40062,"content":"111","imageUrl":"","replyCommentId":40030,"createTime":"2025-03-04 18:58:38","creatorId":2100}
2025-03-04 18:58:38.371 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 159ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:58:38.373 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:58:38.389 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B138588B10000, offsetMsgId=AC1B600100002A9F0000000000010AF9, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=13]
2025-03-04 18:58:38.392 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:58:38.393 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40062,"content":"111","imageUrl":"","replyCommentId":40030,"createTime":"2025-03-04 18:58:38","creatorId":2100}
2025-03-04 18:58:38.410 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:38.412 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40030(Long)
2025-03-04 18:58:38.418 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:38.420 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40062,"noteId":1895794402190688291,"userId":2100,"contentUuid":"9e10bffd-9014-4ba6-8c0b-26518870aaca","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40030,"replyCommentId":40030,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:58:38","updateTime":"2025-03-04 18:58:38"}]
2025-03-04 18:58:38.426 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:58:38.541 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40062(Long), 1895794402190688291(Long), 2100(Long), 9e10bffd-9014-4ba6-8c0b-26518870aaca(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40030(Long), 40030(Long), 2100(Long), false(Boolean), 2025-03-04T18:58:38(LocalDateTime), 2025-03-04T18:58:38(LocalDateTime)
2025-03-04 18:58:38.547 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:58:38.565 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:58:38.569 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:38.570 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:38.589 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B1385897D0001, offsetMsgId=AC1B600100002A9F0000000000010CA5, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=15]
2025-03-04 18:58:38.845 [nacos-grpc-client-executor-127.0.0.1-23] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Receive server push request, request = NotifySubscriberRequest, requestId = 476
2025-03-04 18:58:38.846 [nacos-grpc-client-executor-127.0.0.1-23] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Ack server push request, request = NotifySubscriberRequest, requestId = 476
2025-03-04 18:58:39.133 [nacos-grpc-client-executor-127.0.0.1-24] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Receive server push request, request = NotifySubscriberRequest, requestId = 477
2025-03-04 18:58:39.134 [nacos-grpc-client-executor-127.0.0.1-24] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Ack server push request, request = NotifySubscriberRequest, requestId = 477
2025-03-04 18:58:39.603 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:58:39.603 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40062,\"level\":2,\"parentId\":40030}]"]
2025-03-04 18:58:39.608 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:39.608 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40030(Long)
2025-03-04 18:58:39.611 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:39.612 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 18:58:39.615 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40030(Long)
2025-03-04 18:58:39.617 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 18:58:39.618 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 18:58:39.619 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40062(Long), 40030(Long)
2025-03-04 18:58:39.628 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 18:58:41.161 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:58:41.161 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40030]"]
2025-03-04 18:58:41.165 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40030]
2025-03-04 18:58:41.165 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:41.166 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40030(Long)
2025-03-04 18:58:41.169 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:41.170 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:58:41.177 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40030(Long), 0.3(Double), 40030(Long)
2025-03-04 18:58:41.184 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:58:45.524 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:58:45.526 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:58:45.536 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:45.537 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40030(Long)
2025-03-04 18:58:45.538 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:45.539 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 18:58:45.539 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40062(Long)
2025-03-04 18:58:45.541 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 18:58:45.545 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:58:45.576 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:58:45.588 [http-nio-8093-exec-6] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 18:58:45.594 [http-nio-8093-exec-6] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:45.594 [http-nio-8093-exec-6] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 18:58:45.605 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 78ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":1,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":3,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:58:45.607 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:58:46.157 [nacos-grpc-client-executor-127.0.0.1-27] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Receive server push request, request = NotifySubscriberRequest, requestId = 478
2025-03-04 18:58:46.157 [nacos-grpc-client-executor-127.0.0.1-27] INFO  com.alibaba.nacos.common.remote.client - [dfde76ef-0ea8-46a8-a502-2d5eb5d9fdf8] Ack server push request, request = NotifySubscriberRequest, requestId = 478
2025-03-04 18:58:56.307 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:58:56.309 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"乌拉乌拉","imageUrl":"","replyCommentId":40026}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:58:56.309 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:58:56.312 [http-nio-8093-exec-5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40063,"content":"乌拉乌拉","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 18:58:56","creatorId":2100}
2025-03-04 18:58:56.312 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:58:56.313 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:58:56.315 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B1385CEB90002, offsetMsgId=AC1B600100002A9F0000000000010F24, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=12]
2025-03-04 18:58:56.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:58:56.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40063,"content":"乌拉乌拉","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 18:58:56","creatorId":2100}
2025-03-04 18:58:56.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:56.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 18:58:56.320 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:56.320 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40063,"noteId":1895794402190688291,"userId":2100,"contentUuid":"5328706c-129c-4781-a275-50934987c24a","content":"乌拉乌拉","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40026,"replyCommentId":40026,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:58:56","updateTime":"2025-03-04 18:58:56"}]
2025-03-04 18:58:56.322 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:58:56.323 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40063(Long), 1895794402190688291(Long), 2100(Long), 5328706c-129c-4781-a275-50934987c24a(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40026(Long), 40026(Long), 2100(Long), false(Boolean), 2025-03-04T18:58:56(LocalDateTime), 2025-03-04T18:58:56(LocalDateTime)
2025-03-04 18:58:56.325 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:58:56.346 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B1385CED90003, offsetMsgId=AC1B600100002A9F00000000000110D9, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=20]
2025-03-04 18:58:56.784 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:58:56.784 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40063,\"level\":2,\"parentId\":40026}]"]
2025-03-04 18:58:59.251 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:58:59.251 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40026]"]
2025-03-04 18:58:59.251 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40026]
2025-03-04 18:58:59.251 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:58:59.252 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 18:58:59.254 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:58:59.254 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:58:59.255 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40026(Long), 0.6(Double), 40026(Long)
2025-03-04 18:58:59.262 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:59:06.133 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:59:06.134 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:59:06.143 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 18:59:06.143 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40062(Long)
2025-03-04 18:59:06.145 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 18:59:06.146 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:59:06.147 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:59:36.158 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:59:36.159 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:59:36.167 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":2,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:59:36.167 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:59:43.299 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:59:43.300 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"111","imageUrl":"","replyCommentId":40026}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 18:59:43.300 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 18:59:43.302 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40064,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 18:59:43","creatorId":2100}
2025-03-04 18:59:43.303 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 18:59:43.303 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 18:59:43.304 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B138686470004, offsetMsgId=AC1B600100002A9F0000000000011358, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=18]
2025-03-04 18:59:43.313 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 18:59:43.314 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40064,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 18:59:43","creatorId":2100}
2025-03-04 18:59:43.315 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:59:43.316 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 18:59:43.318 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:59:43.318 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40064,"noteId":1895794402190688291,"userId":2100,"contentUuid":"9f3f116e-459e-4666-9891-6c12a49ea7aa","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40026,"replyCommentId":40026,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 18:59:43","updateTime":"2025-03-04 18:59:43"}]
2025-03-04 18:59:43.319 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 18:59:43.321 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40064(Long), 1895794402190688291(Long), 2100(Long), 9f3f116e-459e-4666-9891-6c12a49ea7aa(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40026(Long), 40026(Long), 2100(Long), false(Boolean), 2025-03-04T18:59:43(LocalDateTime), 2025-03-04T18:59:43(LocalDateTime)
2025-03-04 18:59:43.323 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 18:59:43.346 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001D54C63947C6B138686710005, offsetMsgId=AC1B600100002A9F0000000000011504, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=9]
2025-03-04 18:59:43.948 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 18:59:43.948 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40064,\"level\":2,\"parentId\":40026}]"]
2025-03-04 18:59:45.341 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 18:59:45.341 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40026]"]
2025-03-04 18:59:45.341 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40026]
2025-03-04 18:59:45.341 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 18:59:45.342 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 18:59:45.345 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 18:59:45.345 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 18:59:45.345 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40026(Long), 0.9(Double), 40026(Long)
2025-03-04 18:59:45.362 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 18:59:46.478 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 18:59:46.479 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 18:59:46.488 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":3,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":5,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 18:59:46.489 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:01:14.046 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 19:01:14.046 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 19:01:14.046 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 19:01:14.046 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 19:01:14.049 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.050 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.051 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.051 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.053 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.054 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.055 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.055 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.076 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 19:01:14.076 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 19:01:14.079 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@4ec88559[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 19:01:14.080 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741085879832_172.17.0.1_55494
2025-03-04 19:01:14.081 [nacos-grpc-client-executor-127.0.0.1-61] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741085879832_172.17.0.1_55494]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 19:01:14.082 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@2fa737f7[Running, pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 62]
2025-03-04 19:01:14.082 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@2e0bc55c[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 64]
2025-03-04 19:01:14.082 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 19:01:14.082 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 19:01:14.082 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 19:01:14.086 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.086 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.087 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.087 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.087 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:14.087 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:14.088 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:14.088 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:14.199 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:01:14.199 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:01:14.201 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 19:01:14.207 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 19:01:16.659 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:01:16.697 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:01:16.963 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:01:16.972 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:01:16.973 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 19:01:16.984 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 19:01:17.363 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 19:01:17.366 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 19:01:17.380 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 0 Redis repository interfaces.
2025-03-04 19:01:17.523 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 19:01:17.554 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.555 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.556 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.728 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.760 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.763 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.764 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.765 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$723/0x000002003f552610] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.766 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.770 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.770 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:01:17.915 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 19:01:17.922 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 19:01:17.922 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 19:01:17.982 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 19:01:17.982 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 996 ms
2025-03-04 19:01:18.050 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 19:01:18.255 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 19:01:18.470 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:01:18.516 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 19:01:18.846 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:18.847 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 19:01:18.872 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:18.872 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 19:01:19.321 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:01:19.340 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:01:19.377 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:19.377 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 19:01:19.406 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:01:19.406 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 19:01:20.165 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 19:01:20.174 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:01:20.174 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 19:01:20.175 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 19:01:20.176 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 19:01:20.209 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 19:01:20.209 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 19:01:20.210 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 19:01:20.215 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 19:01:20.216 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 19:01:20.220 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 19:01:20.230 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 5ff28ebd-c373-4f52-987c-f1ed670294dc
2025-03-04 19:01:20.259 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 19:01:20.259 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 19:01:20.259 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 19:01:20.262 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 19:01:20.304 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 19:01:21.197 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741086080984_172.17.0.1_44042
2025-03-04 19:01:21.198 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Notify connected event to listeners.
2025-03-04 19:01:21.198 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 19:01:21.198 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 19:01:21.199 [main] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000002003f9f6e60
2025-03-04 19:01:21.200 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 19:01:21.214 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 19:01:21.307 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 5.068 seconds (process running for 5.94)
2025-03-04 19:01:30.907 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 19:01:30.907 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 19:01:30.908 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-03-04 19:01:30.919 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 19:01:31.039 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895794402190688291,"content":"111","imageUrl":"","replyCommentId":40026}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 19:01:31.042 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 19:01:31.124 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 19:01:31.140 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 19:01:31.151 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 19:01:31.212 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895794402190688291,"commentId":40065,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 19:01:31","creatorId":2100}
2025-03-04 19:01:31.220 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 182ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 19:01:31.233 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001E0BC63947C6B13882BDC0000, offsetMsgId=AC1B600100002A9F0000000000011783, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=19]
2025-03-04 19:01:31.235 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:01:31.238 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 19:01:31.241 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895794402190688291,"commentId":40065,"content":"111","imageUrl":"","replyCommentId":40026,"createTime":"2025-03-04 19:01:31","creatorId":2100}
2025-03-04 19:01:31.299 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 19:01:31.423 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 19:01:31.441 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 19:01:31.449 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40065,"noteId":1895794402190688291,"userId":2100,"contentUuid":"7e4868e1-053a-4186-9171-38783f5fb170","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40026,"replyCommentId":40026,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 19:01:31","updateTime":"2025-03-04 19:01:31"}]
2025-03-04 19:01:31.460 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 19:01:31.520 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40065(Long), 1895794402190688291(Long), 2100(Long), 7e4868e1-053a-4186-9171-38783f5fb170(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40026(Long), 40026(Long), 2100(Long), false(Boolean), 2025-03-04T19:01:31(LocalDateTime), 2025-03-04T19:01:31(LocalDateTime)
2025-03-04 19:01:31.526 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 19:01:31.542 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 19:01:31.545 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 19:01:31.546 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatTimeOut":15000,"instanceHeartBeatInterval":5000}]
2025-03-04 19:01:31.568 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F000001E0BC63947C6B13882D2F0001, offsetMsgId=AC1B600100002A9F000000000001192F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=21]
2025-03-04 19:01:31.662 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Receive server push request, request = NotifySubscriberRequest, requestId = 481
2025-03-04 19:01:31.662 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Ack server push request, request = NotifySubscriberRequest, requestId = 481
2025-03-04 19:01:32.047 [nacos-grpc-client-executor-127.0.0.1-15] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Receive server push request, request = NotifySubscriberRequest, requestId = 482
2025-03-04 19:01:32.048 [nacos-grpc-client-executor-127.0.0.1-15] INFO  com.alibaba.nacos.common.remote.client - [5ff28ebd-c373-4f52-987c-f1ed670294dc] Ack server push request, request = NotifySubscriberRequest, requestId = 482
2025-03-04 19:02:29.626 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 19:02:29.626 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40026]"]
2025-03-04 19:02:29.628 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 19:02:29.629 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895794402190688291,\"commentId\":40065,\"level\":2,\"parentId\":40026}]"]
2025-03-04 19:02:29.636 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40026]
2025-03-04 19:02:29.636 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 19:02:29.637 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 19:02:58.262 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 19:02:59.431 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 19:03:01.653 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40026(Long), 1.2(Double), 40026(Long)
2025-03-04 19:03:01.907 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 19:07:16.314 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.314 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.315 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.316 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.317 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.317 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.317 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:16.318 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:16.318 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:07:19.310 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:07:20.509 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 19:07:20.515 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 19:07:20.547 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 31ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":4,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 19:07:20.548 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:07:25.159 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 19:07:25.161 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 19:07:25.175 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 14ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":4,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 19:07:25.176 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:09:03.177 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 19:09:03.179 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 19:09:03.197 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 17ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"19 小时前","likeTotal":0,"childCommentTotal":4,"childComments":null,"heat":0.0},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 19:09:03.198 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:09:30.054 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Start destroying common HttpClient
2025-03-04 19:09:30.054 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Start destroying Publisher
2025-03-04 19:09:30.054 [Thread-16] WARN  com.alibaba.nacos.common.notify.NotifyCenter - [NotifyCenter] Destruction of the end
2025-03-04 19:09:30.055 [Thread-19] WARN  c.alibaba.nacos.common.http.HttpClientBeanHolder - [HttpClientBeanHolder] Destruction of the end
2025-03-04 19:09:30.060 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.060 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.062 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.062 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.066 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.066 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.068 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.068 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.101 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registering from Nacos Server now...
2025-03-04 19:09:30.101 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - [DEREGISTER-SERVICE] xiaohashu deregistering service xiaohashu-comment with instance: Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={}}
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - De-registration finished.
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.backups.FailoverReactor do shutdown stop
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.cache.ServiceInfoHolder do shutdown stop
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServiceInfoUpdateService do shutdown stop
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.core.ServerListManager do shutdown stop
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown begin
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Start destroying NacosRestTemplate
2025-03-04 19:09:30.105 [SpringApplicationShutdownHook] WARN  com.alibaba.nacos.client.naming - [NamingHttpClientManager] Destruction of the end
2025-03-04 19:09:30.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.http.NamingHttpClientProxy do shutdown stop
2025-03-04 19:09:30.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown rpc client, set status to shutdown
2025-03-04 19:09:30.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Shutdown client event executor java.util.concurrent.ScheduledThreadPoolExecutor@7dc493bb[Running, pool size = 2, active threads = 2, queued tasks = 0, completed tasks = 0]
2025-03-04 19:09:30.106 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.common.remote.client - Close current connection 1741086080984_172.17.0.1_44042
2025-03-04 19:09:30.107 [nacos-grpc-client-executor-127.0.0.1-51] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - [1741086080984_172.17.0.1_44042]Ignore complete event,isRunning:false,isAbandon=false
2025-03-04 19:09:30.109 [SpringApplicationShutdownHook] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - Shutdown grpc executor java.util.concurrent.ThreadPoolExecutor@4382b022[Running, pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 52]
2025-03-04 19:09:30.109 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - Shutdown grpc redo service executor java.util.concurrent.ScheduledThreadPoolExecutor@72dc03a0[Running, pool size = 1, active threads = 0, queued tasks = 1, completed tasks = 54]
2025-03-04 19:09:30.109 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - [null] CredentialWatcher is stopped
2025-03-04 19:09:30.109 [SpringApplicationShutdownHook] INFO  c.a.n.client.auth.ram.identify.CredentialService - [null] CredentialService is freed
2025-03-04 19:09:30.110 [SpringApplicationShutdownHook] INFO  com.alibaba.nacos.client.naming - com.alibaba.nacos.client.naming.remote.NamingClientProxyDelegate do shutdown stop
2025-03-04 19:09:30.113 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.113 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.115 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.115 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.115 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:30.115 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:30.115 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:30.116 [SpringApplicationShutdownHook] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:30.242 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[127.0.0.1:9876] result: true
2025-03-04 19:09:30.242 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[172.27.96.1:10911] result: true
2025-03-04 19:09:30.244 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-03-04 19:09:30.252 [SpringApplicationShutdownHook] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-03-04 19:09:32.666 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:09:32.700 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:09:32.957 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:09:32.966 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:09:32.967 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - The following 1 profile is active: "dev"
2025-03-04 19:09:32.978 [main] WARN  o.s.core.annotation.AnnotationTypeMapping - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.springframework.retry.annotation.EnableRetry with appropriate @AliasFor declarations: [proxyTargetClass]
2025-03-04 19:09:33.378 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-04 19:09:33.380 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-04 19:09:33.395 [main] INFO  o.s.d.r.config.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-04 19:09:33.547 [main] INFO  o.springframework.cloud.context.scope.GenericScope - BeanFactory id=a3a9456d-7e34-33a4-8ba6-904f48303cd4
2025-03-04 19:09:33.580 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.kv.api.KeyValueFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.581 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.user.api.UserFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.582 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'com.quanxiaoha.xiaohashu.distributed.id.generator.api.DistributedIdGeneratorFeignApi' of type [org.springframework.cloud.openfeign.FeignClientFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.748 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.783 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.784 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.787 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.787 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda$723/0x000001a73a5523d0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.788 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.792 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.793 [main] INFO  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2025-03-04 19:09:33.937 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8093 (http)
2025-03-04 19:09:33.943 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-03-04 19:09:33.943 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.5]
2025-03-04 19:09:33.998 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-03-04 19:09:33.998 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1018 ms
2025-03-04 19:09:34.058 [main] INFO  c.a.d.s.b.a.DruidDataSourceAutoConfigure - Init DruidDataSource
2025-03-04 19:09:34.266 [main] INFO  com.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-03-04 19:09:34.489 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-kv' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:09:34.533 [main] INFO  o.a.r.s.autoconfigure.RocketMQAutoConfiguration - a producer (xiaohashu_group) init on namesrv 127.0.0.1:9876
2025-03-04 19:09:34.873 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_CommentHeatUpdateTopic', namespace='', nameServer='127.0.0.1:9876', topic='CommentHeatUpdateTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:34.873 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:commentHeatUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-03-04 19:09:34.900 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:34.900 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_2
2025-03-04 19:09:34.946 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-distributed-id-generator' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:09:34.958 [main] INFO  o.s.cloud.openfeign.FeignClientFactoryBean - For 'xiaohashu-user' URL not provided. Will try picking an instance via load-balancing.
2025-03-04 19:09:34.988 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_DeleteCommentDetailLocalCacheTopic', namespace='', nameServer='127.0.0.1:9876', topic='DeleteCommentDetailLocalCacheTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=BROADCASTING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:34.989 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:deleteCommentLocalCacheConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_3
2025-03-04 19:09:35.011 [main] INFO  o.a.r.s.support.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='xiaohashu_group_first_reply_comment_idCountNoteCommentTopic', namespace='', nameServer='127.0.0.1:9876', topic='CountNoteCommentTopic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='*', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-03-04 19:09:35.011 [main] INFO  o.a.r.s.a.ListenerContainerConfiguration - Register the listener to container, listenerBeanName:oneLevelCommentFirstReplyCommentIdUpdateConsumer, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_4
2025-03-04 19:09:35.572 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8093 (http) with context path ''
2025-03-04 19:09:35.577 [main] WARN  com.alibaba.nacos.client.logging.NacosLogging - Load Logback Configuration of Nacos fail, message: Could not initialize Logback Nacos logging from classpath:nacos-logback.xml
2025-03-04 19:09:35.577 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ans.namespace attribute : null
2025-03-04 19:09:35.577 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from ALIBABA_ALIWARE_NAMESPACE attribute :null
2025-03-04 19:09:35.578 [main] INFO  com.alibaba.nacos.client.naming - initializer namespace from namespace attribute :null
2025-03-04 19:09:35.593 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [req-serv] nacos-server port:8848
2025-03-04 19:09:35.593 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - [settings] [http-client] connect timeout:1000
2025-03-04 19:09:35.595 [main] INFO  com.alibaba.nacos.client.utils.ParamUtil - PER_TASK_CONFIG_SIZE: 3000.0
2025-03-04 19:09:35.597 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.impl.NacosClientAuthServiceImpl success.
2025-03-04 19:09:35.597 [main] INFO  c.a.n.p.auth.spi.client.ClientAuthPluginManager - [ClientAuthPluginManager] Load ClientAuthService com.alibaba.nacos.client.auth.ram.RamClientAuthServiceImpl success.
2025-03-04 19:09:35.599 [main] INFO  c.a.n.client.auth.ram.identify.CredentialWatcher - null No credential found
2025-03-04 19:09:35.605 [main] INFO  com.alibaba.nacos.common.remote.client - [RpcClientFactory] create a new rpc client of 0a165abe-ffaf-4519-9cc3-30371deb8126
2025-03-04 19:09:35.617 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] RpcClient init, ServerListFactory = com.alibaba.nacos.client.naming.core.ServerListManager
2025-03-04 19:09:35.617 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Registry connection listener to current client:com.alibaba.nacos.client.naming.remote.gprc.redo.NamingGrpcRedoService
2025-03-04 19:09:35.617 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Register server push request handler:com.alibaba.nacos.client.naming.remote.gprc.NamingPushRequestHandler
2025-03-04 19:09:35.619 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Try to connect to server on start up, server: {serverIp = '127.0.0.1', server main port = 8848}
2025-03-04 19:09:35.638 [main] INFO  c.a.nacos.common.remote.client.grpc.GrpcClient - grpc client connection server:127.0.0.1 ip,serverPort:9848,grpcTslConfig:{"sslProvider":"OPENSSL","enableTls":false,"mutualAuthEnable":false,"trustAll":false}
2025-03-04 19:09:36.222 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Success to connect to server [127.0.0.1:8848] on start up, connectionId = 1741086576061_172.17.0.1_34574
2025-03-04 19:09:36.223 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Notify connected event to listeners.
2025-03-04 19:09:36.223 [com.alibaba.nacos.client.remote.worker] INFO  com.alibaba.nacos.client.naming - Grpc connection connect
2025-03-04 19:09:36.223 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$ConnectResetRequestHandler
2025-03-04 19:09:36.223 [main] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Register server push request handler:com.alibaba.nacos.common.remote.client.RpcClient$$Lambda$1289/0x000001a73a9f4810
2025-03-04 19:09:36.224 [main] INFO  com.alibaba.nacos.client.naming - [REGISTER-SERVICE] xiaohashu registering service xiaohashu-comment with instance Instance{instanceId='null', ip='192.168.1.3', port=8093, weight=1.0, healthy=true, enabled=true, ephemeral=true, clusterName='DEFAULT', serviceName='null', metadata={IPv6=[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b], preserved.register.source=SPRING_CLOUD}}
2025-03-04 19:09:36.232 [main] INFO  c.a.cloud.nacos.registry.NacosServiceRegistry - nacos registry, DEFAULT_GROUP xiaohashu-comment 192.168.1.3:8093 register finished
2025-03-04 19:09:36.315 [main] INFO  c.q.x.comment.biz.XiaohashuCommentBizApplication - Started XiaohashuCommentBizApplication in 4.075 seconds (process running for 4.623)
2025-03-04 19:09:44.200 [http-nio-8093-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-03-04 19:09:44.200 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-03-04 19:09:44.201 [http-nio-8093-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-03-04 19:09:44.209 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 19:09:44.280 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 19:09:44.577 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 19:09:44.670 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long)
2025-03-04 19:09:44.682 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 19:09:44.684 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 19:09:44.685 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40045(Long)
2025-03-04 19:09:44.686 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 19:09:44.694 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 19:09:44.730 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-kv, group:DEFAULT_GROUP, clusters: 
2025-03-04 19:09:44.738 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 19:09:44.746 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-kv -> [{"ip":"192.168.1.3","port":8084,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-kv","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 19:09:44.781 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 19:09:44.791 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-user, group:DEFAULT_GROUP, clusters: 
2025-03-04 19:09:44.795 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 19:09:44.795 [http-nio-8093-exec-1] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-user -> [{"ip":"192.168.1.3","port":8082,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-user","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 19:09:44.806 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 524ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 19:09:44.816 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 19:09:45.330 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Receive server push request, request = NotifySubscriberRequest, requestId = 485
2025-03-04 19:09:45.331 [nacos-grpc-client-executor-127.0.0.1-13] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Ack server push request, request = NotifySubscriberRequest, requestId = 485
2025-03-04 19:09:45.332 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Receive server push request, request = NotifySubscriberRequest, requestId = 486
2025-03-04 19:09:45.333 [nacos-grpc-client-executor-127.0.0.1-14] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Ack server push request, request = NotifySubscriberRequest, requestId = 486
2025-03-04 20:49:31.231 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:49:31.260 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:49:31.302 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 20:49:31.310 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 20:49:31.336 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895795185766367284(Long)
2025-03-04 20:49:31.336 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895795185766367284(Long), 0(Long), 7(Long)
2025-03-04 20:49:31.346 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 19
2025-03-04 20:49:31.347 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 20:49:31.349 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 20:49:31.349 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40023(Long), 40034(Long), 40037(Long), 40038(Long), 40033(Long), 40035(Long), 40039(Long)
2025-03-04 20:49:31.355 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 7
2025-03-04 20:49:31.362 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:31.500 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:31.509 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 251ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:49:31.516 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:49:36.151 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:49:36.152 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:49:36.165 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 20:49:36.166 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40039(Long), 40020(Long), 40014(Long)
2025-03-04 20:49:36.168 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 20:49:36.171 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? )
2025-03-04 20:49:36.172 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40041(Long), 40016(Long), 40011(Long)
2025-03-04 20:49:36.175 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 3
2025-03-04 20:49:36.177 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:36.204 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:36.216 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 64ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"昨天 20:23","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40041,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"是大佛看电视就废了","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:49:36.217 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:49:37.955 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:49:37.956 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:49:37.972 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? , ? )
2025-03-04 20:49:37.973 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40023(Long), 40017(Long), 40037(Long), 40021(Long), 40038(Long), 40019(Long), 40013(Long), 40035(Long)
2025-03-04 20:49:37.975 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 8
2025-03-04 20:49:37.977 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:49:37.977 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40015(Long)
2025-03-04 20:49:37.980 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:49:37.981 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 20:49:37.982 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40042(Long)
2025-03-04 20:49:37.984 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 20:49:37.984 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:38.009 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:49:38.021 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 65ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:49:38.022 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:14.487 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:14.489 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:50:14.500 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? )
2025-03-04 20:50:14.500 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40054(Long), 40051(Long), 40057(Long), 40055(Long)
2025-03-04 20:50:14.502 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 4
2025-03-04 20:50:14.503 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 14ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:50:14.504 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:16.489 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:16.490 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:50:16.493 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:50:16.494 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:20.372 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:20.384 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40055}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 20:50:20.385 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:50:20.418 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - [SUBSCRIBE-SERVICE] service:xiaohashu-distributed-id-generator, group:DEFAULT_GROUP, clusters: 
2025-03-04 20:50:20.423 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - init new ips(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 20:50:20.424 [http-nio-8093-exec-8] INFO  com.alibaba.nacos.client.naming - current ips:(1) service: DEFAULT_GROUP@@xiaohashu-distributed-id-generator -> [{"ip":"192.168.1.3","port":8085,"weight":1.0,"healthy":true,"enabled":true,"ephemeral":true,"clusterName":"DEFAULT","serviceName":"DEFAULT_GROUP@@xiaohashu-distributed-id-generator","metadata":{"preserved.register.source":"SPRING_CLOUD","IPv6":"[240e:b67:57b:ab00:fbf2:c156:c48c:ed8b]"},"ipDeleteTimeout":30000,"instanceHeartBeatInterval":5000,"instanceHeartBeatTimeOut":15000}]
2025-03-04 20:50:20.456 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40066,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:50:20","creatorId":2100}
2025-03-04 20:50:20.470 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 85ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 20:50:20.471 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:20.501 [NettyClientPublicExecutor_1] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送异常: 
org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.access$000(MQClientAPIImpl.java:175)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl$1.operationComplete(MQClientAPIImpl.java:564)
	at org.apache.rocketmq.remoting.netty.ResponseFuture.executeInvokeCallback(ResponseFuture.java:54)
	at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract$2.run(NettyRemotingAbstract.java:321)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-03-04 20:50:20.508 [NoteExecutor-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 1, 时间: 2025-03-04T20:50:20.508718600
2025-03-04 20:50:20.512 [NoteExecutor-4] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40066,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:50:20","creatorId":2100}, headers={id=e64e71f8-7678-7f20-4306-640b44c6b6eb, timestamp=1741092620463}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:50:21.030 [nacos-grpc-client-executor-127.0.0.1-1227] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Receive server push request, request = NotifySubscriberRequest, requestId = 487
2025-03-04 20:50:21.030 [nacos-grpc-client-executor-127.0.0.1-1227] INFO  com.alibaba.nacos.common.remote.client - [0a165abe-ffaf-4519-9cc3-30371deb8126] Ack server push request, request = NotifySubscriberRequest, requestId = 487
2025-03-04 20:50:22.516 [NoteExecutor-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 2, 时间: 2025-03-04T20:50:22.516895700
2025-03-04 20:50:22.522 [NoteExecutor-4] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40066,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:50:20","creatorId":2100}, headers={id=e64e71f8-7678-7f20-4306-640b44c6b6eb, timestamp=1741092620463}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:50:26.534 [NoteExecutor-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 3, 时间: 2025-03-04T20:50:26.534084300
2025-03-04 20:50:26.539 [NoteExecutor-4] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40066,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:50:20","creatorId":2100}, headers={id=e64e71f8-7678-7f20-4306-640b44c6b6eb, timestamp=1741092620463}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [5]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:50:26.539 [NoteExecutor-4] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 多次发送失败, 进入兜底方案, Topic: PublishCommentTopic, bodyJson: {"noteId":1895793960295596052,"commentId":40066,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:50:20","creatorId":2100}
2025-03-04 20:50:32.719 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:32.721 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:50:32.731 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:50:32.732 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:34.131 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:34.133 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:50:34.138 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:50:34.141 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:50:56.981 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:50:56.982 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795420446064640,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:50:56.983 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 20:50:56.984 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895795420446064640(Long)
2025-03-04 20:50:56.986 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 20:50:56.988 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 20:50:56.989 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:00.451 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:00.452 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:00.469 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 20:51:00.469 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40015(Long), 40042(Long)
2025-03-04 20:51:00.471 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 20:51:00.472 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 20ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:51:00.473 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:01.999 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:02.000 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:02.009 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 20:51:02.010 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40041(Long), 40016(Long), 40011(Long)
2025-03-04 20:51:02.012 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 20:51:02.012 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40041,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"是大佛看电视就废了","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"昨天 20:23","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:51:02.013 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:03.705 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:03.707 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:03.718 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 20:51:03.719 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40007(Long), 40006(Long)
2025-03-04 20:51:03.720 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 20:51:03.721 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? )
2025-03-04 20:51:03.722 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40010(Long), 40009(Long), 40008(Long)
2025-03-04 20:51:03.726 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 3
2025-03-04 20:51:03.728 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:51:03.736 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:51:03.740 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 33ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 18:06","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":3,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:51:03.741 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:04.957 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:04.957 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:04.961 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:51:04.961 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:04.981 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:04.982 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":5}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:04.985 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":5,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 20:51:04.986 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:15.040 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:15.042 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:15.042 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 20:51:15.043 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793656292442205(Long)
2025-03-04 20:51:15.044 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 20:51:15.044 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 20:51:15.045 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:17.906 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:17.908 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:17.910 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 20:51:17.910 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895753768780169280(Long)
2025-03-04 20:51:17.911 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 20:51:17.912 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 20:51:17.913 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:21.562 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:21.563 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895756189493362701,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:21.564 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 20:51:21.564 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895756189493362701(Long)
2025-03-04 20:51:21.566 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 20:51:21.566 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 20:51:21.567 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:24.758 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:24.759 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:24.770 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 20:51:24.770 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40029(Long)
2025-03-04 20:51:24.771 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 20:51:24.772 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 13ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:51:24.773 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:51:25.943 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:51:25.944 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:51:25.948 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:51:25.950 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:52:04.470 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:52:04.471 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40055}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 20:52:04.471 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:52:04.474 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40067,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:52:04","creatorId":2100}
2025-03-04 20:52:04.474 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 20:52:04.474 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:52:04.479 [NettyClientPublicExecutor_2] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送异常: 
org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.access$000(MQClientAPIImpl.java:175)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl$1.operationComplete(MQClientAPIImpl.java:564)
	at org.apache.rocketmq.remoting.netty.ResponseFuture.executeInvokeCallback(ResponseFuture.java:54)
	at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract$2.run(NettyRemotingAbstract.java:321)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-03-04 20:52:04.479 [NoteExecutor-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 1, 时间: 2025-03-04T20:52:04.479598400
2025-03-04 20:52:04.482 [NoteExecutor-2] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40067,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:52:04","creatorId":2100}, headers={id=0c1fb753-c8d4-1f76-6a9b-67a421adafc8, timestamp=1741092724474}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [2]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:52:06.482 [NoteExecutor-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 2, 时间: 2025-03-04T20:52:06.482631200
2025-03-04 20:52:06.485 [NoteExecutor-2] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40067,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:52:04","creatorId":2100}, headers={id=0c1fb753-c8d4-1f76-6a9b-67a421adafc8, timestamp=1741092724474}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:52:10.494 [NoteExecutor-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始重试 MQ 发送, 当前重试次数: 3, 时间: 2025-03-04T20:52:10.494503700
2025-03-04 20:52:10.497 [NoteExecutor-2] ERROR org.apache.rocketmq.spring.core.RocketMQTemplate - syncSend failed. destination:PublishCommentTopic, message:GenericMessage [payload={"noteId":1895793960295596052,"commentId":40067,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:52:04","creatorId":2100}, headers={id=0c1fb753-c8d4-1f76-6a9b-67a421adafc8, timestamp=1741092724474}], detail exception info: 
org.apache.rocketmq.client.exception.MQClientException: Send [1] times, still failed, cost [3]ms, Topic: PublishCommentTopic, BrokersSent: [SK-20231010EQPS]
See http://rocketmq.apache.org/docs/faq/ for further details.
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:647)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:1363)
	at org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:352)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:688)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:488)
	at org.apache.rocketmq.spring.core.RocketMQTemplate.syncSend(RocketMQTemplate.java:476)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$0(SendMqRetryHelper.java:73)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at com.quanxiaoha.xiaohashu.comment.biz.retry.SendMqRetryHelper.lambda$handleRetry$1(SendMqRetryHelper.java:70)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
	at java.base/java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:264)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14  DESC: service not available now. It may be caused by one of the following reasons: the broker's disk is full [CL:  1.00 CQ:  1.00 INDEX:  1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 172.27.96.1:10911
For more information, please visit the url, http://rocketmq.apache.org/docs/faq/
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:675)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:523)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:505)
	at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendKernelImpl(DefaultMQProducerImpl.java:837)
	at org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:575)
	... 15 common frames omitted
2025-03-04 20:52:10.498 [NoteExecutor-2] ERROR c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 多次发送失败, 进入兜底方案, Topic: PublishCommentTopic, bodyJson: {"noteId":1895793960295596052,"commentId":40067,"content":"111","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:52:04","creatorId":2100}
2025-03-04 20:57:46.252 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:57:46.254 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:57:46.265 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:57:46.267 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:57:47.047 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:57:47.048 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:57:47.051 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":11,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:57:47.052 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:58:12.359 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:58:12.360 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"负的萨芬撒","imageUrl":"","replyCommentId":40055}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 20:58:12.360 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:58:12.364 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40068,"content":"负的萨芬撒","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:58:12","creatorId":2100}
2025-03-04 20:58:12.364 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 20:58:12.364 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:58:12.368 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F3000C0008, offsetMsgId=AC1B600100002A9F0000000000011BAE, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=15]
2025-03-04 20:58:12.381 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 20:58:12.383 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40068,"content":"负的萨芬撒","imageUrl":"","replyCommentId":40055,"createTime":"2025-03-04 20:58:12","creatorId":2100}
2025-03-04 20:58:12.387 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:12.387 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:58:12.390 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:12.391 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40068,"noteId":1895793960295596052,"userId":2100,"contentUuid":"1e864128-e97e-4f40-a191-9f6b66b8913e","content":"负的萨芬撒","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40055,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 20:58:12","updateTime":"2025-03-04 20:58:12"}]
2025-03-04 20:58:12.400 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 20:58:12.465 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40068(Long), 1895793960295596052(Long), 2100(Long), 1e864128-e97e-4f40-a191-9f6b66b8913e(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40055(Long), 2100(Long), false(Boolean), 2025-03-04T20:58:12(LocalDateTime), 2025-03-04T20:58:12(LocalDateTime)
2025-03-04 20:58:12.473 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 20:58:12.508 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F3009B0009, offsetMsgId=AC1B600100002A9F0000000000011D66, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=22]
2025-03-04 20:58:13.526 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 20:58:13.526 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40068,\"level\":2,\"parentId\":40055}]"]
2025-03-04 20:58:13.532 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:13.532 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:58:13.534 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:13.535 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 20:58:13.536 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40055(Long)
2025-03-04 20:58:13.537 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 20:58:13.538 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 20:58:13.539 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40068(Long), 40055(Long)
2025-03-04 20:58:13.548 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 20:58:15.192 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 20:58:15.192 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 20:58:15.199 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 20:58:15.200 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:15.202 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:58:15.204 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:15.208 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 20:58:15.210 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 0.3(Double), 40055(Long)
2025-03-04 20:58:15.221 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 20:58:40.096 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:58:40.097 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:58:40.114 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:40.115 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:58:40.116 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:40.116 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 20:58:40.117 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40068(Long)
2025-03-04 20:58:40.118 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 20:58:40.118 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:58:40.131 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:58:40.137 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 40ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":12,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:58:40.137 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:58:40.982 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:58:40.982 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:58:40.984 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":12,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:58:40.985 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:58:57.921 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:58:57.922 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"都是范德萨范德萨","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 20:58:57.922 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:58:57.924 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40069,"content":"都是范德萨范德萨","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 20:58:57","creatorId":2100}
2025-03-04 20:58:57.924 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 20:58:57.925 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:58:57.926 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F3B205000A, offsetMsgId=AC1B600100002A9F0000000000011FE5, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=13]
2025-03-04 20:58:57.933 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 20:58:57.933 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40069,"content":"都是范德萨范德萨","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 20:58:57","creatorId":2100}
2025-03-04 20:58:57.934 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:57.934 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 20:58:57.936 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:57.936 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40069,"noteId":1895793960295596052,"userId":2100,"contentUuid":"5b90f1d7-6bdf-4646-8f2a-fed3c366ed99","content":"都是范德萨范德萨","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 20:58:57","updateTime":"2025-03-04 20:58:57"}]
2025-03-04 20:58:57.937 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 20:58:57.938 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40069(Long), 1895793960295596052(Long), 2100(Long), 5b90f1d7-6bdf-4646-8f2a-fed3c366ed99(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T20:58:57(LocalDateTime), 2025-03-04T20:58:57(LocalDateTime)
2025-03-04 20:58:57.939 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 20:58:57.967 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F3B22F000B, offsetMsgId=AC1B600100002A9F00000000000121A6, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=16]
2025-03-04 20:58:58.651 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 20:58:58.651 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40069,\"level\":2,\"parentId\":40055}]"]
2025-03-04 20:58:59.276 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 20:58:59.276 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 20:58:59.276 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 20:58:59.276 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:58:59.276 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:58:59.278 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:58:59.279 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 20:58:59.279 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 0.6(Double), 40055(Long)
2025-03-04 20:58:59.286 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 20:59:03.419 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:59:03.420 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:59:03.426 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 20:59:03.426 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40068(Long)
2025-03-04 20:59:03.427 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 20:59:03.427 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":13,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:59:03.428 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:59:04.841 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:59:04.841 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 20:59:04.843 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":13,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 20:59:04.844 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:59:49.446 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 20:59:49.446 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"第三方的","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 20:59:49.446 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 20:59:49.449 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40070,"content":"第三方的","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 20:59:49","creatorId":2100}
2025-03-04 20:59:49.449 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 20:59:49.450 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 20:59:49.451 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F47B49000C, offsetMsgId=AC1B600100002A9F0000000000012425, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=14]
2025-03-04 20:59:49.453 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 20:59:49.453 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40070,"content":"第三方的","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 20:59:49","creatorId":2100}
2025-03-04 20:59:49.453 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:59:49.453 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 20:59:49.455 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:59:49.455 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40070,"noteId":1895793960295596052,"userId":2100,"contentUuid":"a56d326a-71de-4bf0-a9ff-c856d94dcb89","content":"第三方的","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 20:59:49","updateTime":"2025-03-04 20:59:49"}]
2025-03-04 20:59:49.456 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 20:59:49.456 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40070(Long), 1895793960295596052(Long), 2100(Long), a56d326a-71de-4bf0-a9ff-c856d94dcb89(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T20:59:49(LocalDateTime), 2025-03-04T20:59:49(LocalDateTime)
2025-03-04 20:59:49.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 20:59:49.478 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F47B66000D, offsetMsgId=AC1B600100002A9F00000000000125DA, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=17]
2025-03-04 20:59:49.698 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 20:59:49.698 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40070,\"level\":2,\"parentId\":40055}]"]
2025-03-04 20:59:51.311 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 20:59:51.311 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 20:59:51.311 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 20:59:51.311 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 20:59:51.311 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 20:59:51.313 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 20:59:51.313 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 20:59:51.313 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 0.9(Double), 40055(Long)
2025-03-04 20:59:51.322 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:00:00.598 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:00:00.599 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:00:00.606 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":14,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 21:00:00.607 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:16.796 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:16.797 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:02:16.804 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":14,"pageSize":7,"totalPage":2} =================================== 
2025-03-04 21:02:16.805 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:16.852 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:16.852 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:02:16.856 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 21:02:16.857 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40026(Long), 40030(Long)
2025-03-04 21:02:16.858 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 21:02:16.858 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? )
2025-03-04 21:02:16.859 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40045(Long), 40062(Long)
2025-03-04 21:02:16.860 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 2
2025-03-04 21:02:16.860 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:02:16.865 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:16.865 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:02:16.868 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:02:16.869 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:16.874 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:02:16.878 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 26ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:02:16.878 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:22.854 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:22.854 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"防守打法","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:02:22.854 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:02:22.857 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40071,"content":"防守打法","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:02:22","creatorId":2100}
2025-03-04 21:02:22.857 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:02:22.857 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:22.858 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F6D289000E, offsetMsgId=AC1B600100002A9F0000000000012859, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=15]
2025-03-04 21:02:22.867 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:02:22.867 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40071,"content":"防守打法","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:02:22","creatorId":2100}
2025-03-04 21:02:22.867 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:02:22.867 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 21:02:22.869 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:02:22.869 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40071,"noteId":1895793960295596052,"userId":2100,"contentUuid":"6d30ce58-0339-4ead-ad47-577f62a45f31","content":"防守打法","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:02:22","updateTime":"2025-03-04 21:02:22"}]
2025-03-04 21:02:22.870 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:02:22.870 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40071(Long), 1895793960295596052(Long), 2100(Long), 6d30ce58-0339-4ead-ad47-577f62a45f31(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T21:02:22(LocalDateTime), 2025-03-04T21:02:22(LocalDateTime)
2025-03-04 21:02:22.872 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:02:22.888 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F6D2A7000F, offsetMsgId=AC1B600100002A9F0000000000012A0E, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=18]
2025-03-04 21:02:23.856 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:02:23.856 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40071,\"level\":2,\"parentId\":40055}]"]
2025-03-04 21:02:25.411 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:02:25.411 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 21:02:25.411 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 21:02:25.411 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:02:25.411 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 21:02:25.415 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:02:25.416 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:02:25.416 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 1.2(Double), 40055(Long)
2025-03-04 21:02:25.480 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:02:46.005 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:46.006 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:02:46.013 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":15,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:02:46.013 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:54.413 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:54.413 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:02:54.419 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":15,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:02:54.419 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:58.798 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:02:58.798 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:02:58.799 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:02:58.801 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40072,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:02:58","creatorId":2100}
2025-03-04 21:02:58.801 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:02:58.802 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:02:58.803 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F75EF20010, offsetMsgId=AC1B600100002A9F0000000000012C8D, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=16]
2025-03-04 21:02:58.812 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:02:58.812 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40072,"content":"范德萨范德萨","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:02:58","creatorId":2100}
2025-03-04 21:02:58.813 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:02:58.813 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 21:02:58.814 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:02:58.815 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40072,"noteId":1895793960295596052,"userId":2100,"contentUuid":"d64601e6-ff3b-4f0d-9055-12fa100a3e4b","content":"范德萨范德萨","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:02:58","updateTime":"2025-03-04 21:02:58"}]
2025-03-04 21:02:58.815 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:02:58.816 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40072(Long), 1895793960295596052(Long), 2100(Long), d64601e6-ff3b-4f0d-9055-12fa100a3e4b(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T21:02:58(LocalDateTime), 2025-03-04T21:02:58(LocalDateTime)
2025-03-04 21:02:58.817 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:02:58.833 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B13F75F100011, offsetMsgId=AC1B600100002A9F0000000000012E48, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=19]
2025-03-04 21:02:58.892 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:02:58.892 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40072,\"level\":2,\"parentId\":40055}]"]
2025-03-04 21:03:01.502 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:03:01.502 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 21:03:01.502 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 21:03:01.502 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:03:01.502 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 21:03:01.504 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:03:01.504 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:03:01.504 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 1.5(Double), 40055(Long)
2025-03-04 21:03:01.511 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:18:30.134 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:30.135 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:18:30.143 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:30.144 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 21:18:30.144 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:18:30.144 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40026(Long), 40045(Long), 40030(Long)
2025-03-04 21:18:30.146 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 21:18:30.147 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:18:30.148 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:30.150 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:18:30.151 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:30.152 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:30.153 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:18:30.163 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 21:18:30.164 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40055(Long), 40068(Long)
2025-03-04 21:18:30.166 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 21:18:30.166 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 13ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":5,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":16,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:18:30.166 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:40.145 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:40.145 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:18:40.146 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:18:40.149 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40073,"content":"111","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:18:40","creatorId":2100}
2025-03-04 21:18:40.149 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:18:40.150 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:40.150 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1405BC150012, offsetMsgId=AC1B600100002A9F00000000000130C7, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=20]
2025-03-04 21:18:40.165 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:18:40.165 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40073,"content":"111","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:18:40","creatorId":2100}
2025-03-04 21:18:40.166 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:18:40.166 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 21:18:40.167 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:18:40.168 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40073,"noteId":1895793960295596052,"userId":2100,"contentUuid":"45e4dc82-ef27-448d-ab65-3a4405956e64","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:18:40","updateTime":"2025-03-04 21:18:40"}]
2025-03-04 21:18:40.169 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:18:40.169 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40073(Long), 1895793960295596052(Long), 2100(Long), 45e4dc82-ef27-448d-ab65-3a4405956e64(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T21:18:40(LocalDateTime), 2025-03-04T21:18:40(LocalDateTime)
2025-03-04 21:18:40.171 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:18:40.188 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1405BC3A0013, offsetMsgId=AC1B600100002A9F0000000000013273, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=14]
2025-03-04 21:18:40.725 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:18:40.725 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40073,\"level\":2,\"parentId\":40055}]"]
2025-03-04 21:18:41.960 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:18:41.960 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 21:18:41.960 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 21:18:41.960 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:18:41.961 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 21:18:41.962 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:18:41.962 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:18:41.963 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 1.8(Double), 40055(Long)
2025-03-04 21:18:41.969 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:18:47.264 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:47.265 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:18:47.277 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 12ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":6,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":17,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:18:47.278 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:50.611 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:18:50.612 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"1111","imageUrl":"","replyCommentId":40068}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:18:50.612 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:18:50.614 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40074,"content":"1111","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:18:50","creatorId":2100}
2025-03-04 21:18:50.614 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:18:50.615 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:18:50.616 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1405E4F70014, offsetMsgId=AC1B600100002A9F00000000000134F2, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=17]
2025-03-04 21:18:50.621 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:18:50.621 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40074,"content":"1111","imageUrl":"","replyCommentId":40068,"createTime":"2025-03-04 21:18:50","creatorId":2100}
2025-03-04 21:18:50.621 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:18:50.622 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40068(Long)
2025-03-04 21:18:50.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:18:50.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40074,"noteId":1895793960295596052,"userId":2100,"contentUuid":"abf61b26-81f6-48fe-83f3-fc3d67951787","content":"1111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40055,"replyCommentId":40068,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:18:50","updateTime":"2025-03-04 21:18:50"}]
2025-03-04 21:18:50.624 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:18:50.624 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40074(Long), 1895793960295596052(Long), 2100(Long), abf61b26-81f6-48fe-83f3-fc3d67951787(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40055(Long), 40068(Long), 2100(Long), false(Boolean), 2025-03-04T21:18:50(LocalDateTime), 2025-03-04T21:18:50(LocalDateTime)
2025-03-04 21:18:50.626 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:18:50.641 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1405E5100015, offsetMsgId=AC1B600100002A9F000000000001369F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=15]
2025-03-04 21:18:50.744 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:18:50.744 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40074,\"level\":2,\"parentId\":40055}]"]
2025-03-04 21:18:51.975 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:18:51.975 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40055]"]
2025-03-04 21:18:51.975 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40055]
2025-03-04 21:18:51.976 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:18:51.976 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40055(Long)
2025-03-04 21:18:51.977 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:18:51.978 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:18:51.978 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40055(Long), 2.1(Double), 40055(Long)
2025-03-04 21:18:51.985 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:19:41.783 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:19:41.784 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:19:41.786 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":18,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:19:41.786 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:19:41.798 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:19:41.798 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:19:41.802 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":18,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:19:41.802 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:19:44.933 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:19:44.934 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40057}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:19:44.934 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:19:44.936 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40075,"content":"111","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 21:19:44","creatorId":2100}
2025-03-04 21:19:44.936 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:19:44.936 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:19:44.937 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1406B9280016, offsetMsgId=AC1B600100002A9F000000000001391E, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=21]
2025-03-04 21:19:44.938 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:19:44.938 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40075,"content":"111","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 21:19:44","creatorId":2100}
2025-03-04 21:19:44.938 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:19:44.938 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long)
2025-03-04 21:19:44.940 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:19:44.940 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40075,"noteId":1895793960295596052,"userId":2100,"contentUuid":"cde36e1f-a72a-43d4-8cc5-4c2b9bb1ac2c","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40057,"replyCommentId":40057,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:19:44","updateTime":"2025-03-04 21:19:44"}]
2025-03-04 21:19:44.941 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:19:44.943 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40075(Long), 1895793960295596052(Long), 2100(Long), cde36e1f-a72a-43d4-8cc5-4c2b9bb1ac2c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40057(Long), 40057(Long), 2100(Long), false(Boolean), 2025-03-04T21:19:44(LocalDateTime), 2025-03-04T21:19:44(LocalDateTime)
2025-03-04 21:19:44.944 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:19:44.963 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1406B9420017, offsetMsgId=AC1B600100002A9F0000000000013ACA, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=23]
2025-03-04 21:19:45.811 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:19:45.811 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40075,\"level\":2,\"parentId\":40057}]"]
2025-03-04 21:19:45.812 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:19:45.812 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long)
2025-03-04 21:19:45.813 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:19:45.813 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 21:19:45.813 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40057(Long)
2025-03-04 21:19:45.814 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 21:19:45.814 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 21:19:45.814 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40075(Long), 40057(Long)
2025-03-04 21:19:45.822 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 21:19:46.010 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:19:46.010 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40057]"]
2025-03-04 21:19:46.010 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40057]
2025-03-04 21:19:46.010 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:19:46.010 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long)
2025-03-04 21:19:46.011 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:19:46.012 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:19:46.012 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40057(Long), 0.3(Double), 40057(Long)
2025-03-04 21:19:46.020 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:19:56.186 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:19:56.186 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"111","imageUrl":"","replyCommentId":40057}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:19:56.186 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:19:56.188 [http-nio-8093-exec-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40076,"content":"111","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 21:19:56","creatorId":2100}
2025-03-04 21:19:56.188 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:19:56.189 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:19:56.190 [NettyClientPublicExecutor_19] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1406E51C0018, offsetMsgId=AC1B600100002A9F0000000000013D49, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=16]
2025-03-04 21:19:56.210 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:19:56.210 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40076,"content":"111","imageUrl":"","replyCommentId":40057,"createTime":"2025-03-04 21:19:56","creatorId":2100}
2025-03-04 21:19:56.210 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:19:56.211 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long)
2025-03-04 21:19:56.212 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:19:56.212 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40076,"noteId":1895793960295596052,"userId":2100,"contentUuid":"68c70a21-ba7b-419f-9fd1-fcb9082bc73a","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40057,"replyCommentId":40057,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:19:56","updateTime":"2025-03-04 21:19:56"}]
2025-03-04 21:19:56.213 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:19:56.214 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40076(Long), 1895793960295596052(Long), 2100(Long), 68c70a21-ba7b-419f-9fd1-fcb9082bc73a(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40057(Long), 40057(Long), 2100(Long), false(Boolean), 2025-03-04T21:19:56(LocalDateTime), 2025-03-04T21:19:56(LocalDateTime)
2025-03-04 21:19:56.216 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:19:56.230 [NettyClientPublicExecutor_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1406E5450019, offsetMsgId=AC1B600100002A9F0000000000013EF5, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=16]
2025-03-04 21:19:56.831 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:19:56.832 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40076,\"level\":2,\"parentId\":40057}]"]
2025-03-04 21:19:58.026 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:19:58.026 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40057]"]
2025-03-04 21:19:58.026 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40057]
2025-03-04 21:19:58.026 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:19:58.026 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long)
2025-03-04 21:19:58.027 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:19:58.028 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:19:58.028 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40057(Long), 0.6(Double), 40057(Long)
2025-03-04 21:19:58.045 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:20:13.392 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:20:13.393 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"电风扇反倒是第三方第三方第三方","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:20:13.393 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:20:13.395 [http-nio-8093-exec-9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40077,"content":"电风扇反倒是第三方第三方第三方","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:20:13","creatorId":2100}
2025-03-04 21:20:13.395 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:20:13.396 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:20:13.397 [NettyClientPublicExecutor_21] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14072854001A, offsetMsgId=AC1B600100002A9F0000000000014174, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=22]
2025-03-04 21:20:13.406 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:20:13.406 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40077,"content":"电风扇反倒是第三方第三方第三方","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:20:13","creatorId":2100}
2025-03-04 21:20:13.407 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40077,"noteId":1895793960295596052,"userId":2100,"contentUuid":"41957a17-7b4c-4d1d-849a-270ace6293fb","content":"电风扇反倒是第三方第三方第三方","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895793960295596052,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 21:20:13","updateTime":"2025-03-04 21:20:13"}]
2025-03-04 21:20:13.408 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:20:13.408 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40077(Long), 1895793960295596052(Long), 2100(Long), 41957a17-7b4c-4d1d-849a-270ace6293fb(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895793960295596052(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T21:20:13(LocalDateTime), 2025-03-04T21:20:13(LocalDateTime)
2025-03-04 21:20:13.410 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:20:13.434 [NettyClientPublicExecutor_22] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14072879001B, offsetMsgId=AC1B600100002A9F0000000000014349, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=20]
2025-03-04 21:20:13.848 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:20:13.848 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40077,\"level\":1,\"parentId\":1895793960295596052}]"]
2025-03-04 21:20:20.796 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:20:20.797 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:20:20.803 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 21:20:20.803 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40057(Long), 40077(Long)
2025-03-04 21:20:20.805 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 21:20:20.805 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 21:20:20.805 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40075(Long)
2025-03-04 21:20:20.806 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 21:20:20.807 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:20:20.816 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:20:20.821 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 24ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:20:20.822 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:20:25.346 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:20:25.347 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:20:25.349 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:20:25.349 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:20:25.364 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:20:25.365 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:20:25.367 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:20:25.367 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:32.949 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:32.950 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:21:32.957 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:21:32.958 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:32.959 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:32.960 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:21:32.969 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 21:21:32.969 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40075(Long), 40077(Long)
2025-03-04 21:21:32.971 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 21:21:32.971 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:21:32.972 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:33.015 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:33.016 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:21:33.022 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:21:33.022 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:38.852 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:38.853 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:21:38.855 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:21:38.856 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:38.868 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:38.868 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:21:38.872 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":21,"pageSize":7,"totalPage":3} =================================== 
2025-03-04 21:21:38.872 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:44.288 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:21:44.288 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"反倒是","imageUrl":"","replyCommentId":40077}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:21:44.288 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:21:44.290 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40078,"content":"反倒是","imageUrl":"","replyCommentId":40077,"createTime":"2025-03-04 21:21:44","creatorId":2100}
2025-03-04 21:21:44.291 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:21:44.291 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:21:44.291 [NettyClientPublicExecutor_23] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14088B63001C, offsetMsgId=AC1B600100002A9F00000000000144B9, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=23]
2025-03-04 21:21:44.300 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:21:44.300 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40078,"content":"反倒是","imageUrl":"","replyCommentId":40077,"createTime":"2025-03-04 21:21:44","creatorId":2100}
2025-03-04 21:21:44.301 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:21:44.301 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40077(Long)
2025-03-04 21:21:44.303 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:21:44.303 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40078,"noteId":1895793960295596052,"userId":2100,"contentUuid":"e39cef53-e2f2-41c1-8fc1-6467cbe16335","content":"反倒是","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40077,"replyCommentId":40077,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:21:44","updateTime":"2025-03-04 21:21:44"}]
2025-03-04 21:21:44.304 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:21:44.304 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40078(Long), 1895793960295596052(Long), 2100(Long), e39cef53-e2f2-41c1-8fc1-6467cbe16335(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40077(Long), 40077(Long), 2100(Long), false(Boolean), 2025-03-04T21:21:44(LocalDateTime), 2025-03-04T21:21:44(LocalDateTime)
2025-03-04 21:21:44.306 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:21:44.320 [NettyClientPublicExecutor_24] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14088B7F001D, offsetMsgId=AC1B600100002A9F000000000001466B, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=10]
2025-03-04 21:21:44.951 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:21:44.951 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40078,\"level\":2,\"parentId\":40077}]"]
2025-03-04 21:21:44.952 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:21:44.952 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40077(Long)
2025-03-04 21:21:44.953 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:21:44.954 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 21:21:44.954 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40077(Long)
2025-03-04 21:21:44.955 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 21:21:44.955 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 21:21:44.955 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40078(Long), 40077(Long)
2025-03-04 21:21:44.961 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 21:21:46.089 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:21:46.089 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40077]"]
2025-03-04 21:21:46.089 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40077]
2025-03-04 21:21:46.089 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:21:46.090 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40077(Long)
2025-03-04 21:21:46.091 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:21:46.092 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:21:46.092 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40077(Long), 0.3(Double), 40077(Long)
2025-03-04 21:21:46.099 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:23:03.699 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:23:03.699 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:23:03.700 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:23:03.702 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:23:03.706 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:23:03.706 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:23:03.706 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:23:03.707 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:23:03.707 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:23:03.707 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:23:03.716 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 21:23:03.716 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40025(Long)
2025-03-04 21:23:03.717 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 21:23:03.718 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:23:03.718 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40077(Long)
2025-03-04 21:23:03.720 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:23:03.720 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 21:23:03.720 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40078(Long)
2025-03-04 21:23:03.721 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 21:23:03.722 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:23:03.729 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:23:03.733 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 26ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:23:03.734 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:33.434 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:33.435 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:33.437 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:33.437 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:33.438 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 21:27:33.438 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895794402190688291(Long), 0(Long), 7(Long)
2025-03-04 21:27:33.440 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 21:27:33.440 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 21:27:33.441 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895794402190688291(Long)
2025-03-04 21:27:33.443 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 21:27:33.443 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:33.443 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 21:27:33.444 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895794402190688291(Long)
2025-03-04 21:27:33.444 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:33.445 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 21:27:33.446 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 21:27:33.446 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895794402190688291(Long), 0(Long), 7(Long)
2025-03-04 21:27:33.447 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? )
2025-03-04 21:27:33.447 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40045(Long), 40062(Long)
2025-03-04 21:27:33.448 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 21:27:33.448 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? )
2025-03-04 21:27:33.448 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40045(Long), 40062(Long)
2025-03-04 21:27:33.449 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 2
2025-03-04 21:27:33.449 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 2
2025-03-04 21:27:33.450 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:27:33.450 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:27:33.451 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 21:27:33.451 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40078(Long), 40053(Long)
2025-03-04 21:27:33.453 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 21:27:33.453 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:27:33.454 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:33.459 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:27:33.459 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:27:33.463 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 26ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:27:33.463 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 28ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:27:33.464 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:33.465 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:41.155 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:41.155 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:41.157 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:27:41.158 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:41.169 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:41.169 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:41.171 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:27:41.172 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:41.220 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:41.220 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:27:41.222 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":22,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:27:41.222 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:45.830 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:27:45.830 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895793960295596052,"content":"佛挡杀佛","imageUrl":"","replyCommentId":40051}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:27:45.831 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:27:45.833 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895793960295596052,"commentId":40079,"content":"佛挡杀佛","imageUrl":"","replyCommentId":40051,"createTime":"2025-03-04 21:27:45","creatorId":2100}
2025-03-04 21:27:45.833 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:27:45.833 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:27:45.834 [NettyClientPublicExecutor_25] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140E0FA9001E, offsetMsgId=AC1B600100002A9F00000000000148EA, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=14]
2025-03-04 21:27:45.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:27:45.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895793960295596052,"commentId":40079,"content":"佛挡杀佛","imageUrl":"","replyCommentId":40051,"createTime":"2025-03-04 21:27:45","creatorId":2100}
2025-03-04 21:27:45.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:27:45.838 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40051(Long)
2025-03-04 21:27:45.840 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:27:45.840 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40079,"noteId":1895793960295596052,"userId":2100,"contentUuid":"bc0b7a10-74aa-45d2-b630-d0cf365138c5","content":"佛挡杀佛","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40025,"replyCommentId":40051,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:27:45","updateTime":"2025-03-04 21:27:45"}]
2025-03-04 21:27:45.841 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:27:45.842 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40079(Long), 1895793960295596052(Long), 2100(Long), bc0b7a10-74aa-45d2-b630-d0cf365138c5(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40025(Long), 40051(Long), 2100(Long), false(Boolean), 2025-03-04T21:27:45(LocalDateTime), 2025-03-04T21:27:45(LocalDateTime)
2025-03-04 21:27:45.843 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:27:45.860 [NettyClientPublicExecutor_26] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140E0FC3001F, offsetMsgId=AC1B600100002A9F0000000000014A9F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=24]
2025-03-04 21:27:46.284 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:27:46.284 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895793960295596052,\"commentId\":40079,\"level\":2,\"parentId\":40025}]"]
2025-03-04 21:27:48.270 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:27:48.270 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40025]"]
2025-03-04 21:27:48.270 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40025]
2025-03-04 21:27:48.270 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:27:48.270 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40025(Long)
2025-03-04 21:27:48.272 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:27:48.272 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:27:48.272 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40025(Long), 0.6(Double), 40025(Long)
2025-03-04 21:27:48.279 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:28:00.484 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:00.485 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:00.494 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:28:00.495 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:02.153 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:02.153 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:02.156 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:28:02.156 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:02.168 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:02.169 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:02.170 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:28:02.171 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:02.179 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:02.179 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:02.181 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 21:28:02.182 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:06.000 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:06.002 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895753768780169280,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:06.002 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 21:28:06.003 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:07.917 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:07.918 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895755651829727273,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:07.919 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:28:07.920 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895755651829727273(Long)
2025-03-04 21:28:07.921 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 21:28:07.921 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 21:28:07.922 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:09.603 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:09.605 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895756189493362701,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:09.606 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 21:28:09.606 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:11.473 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:11.473 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895780661764030465,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:11.474 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 21:28:11.475 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:15.170 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:15.171 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:15.173 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 21:28:15.173 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 21:28:15.173 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895792506252034080(Long)
2025-03-04 21:28:15.173 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895792506252034080(Long), 0(Long), 7(Long)
2025-03-04 21:28:15.175 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 21:28:15.175 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? )
2025-03-04 21:28:15.175 [NoteExecutor-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 21:28:15.175 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40047(Long)
2025-03-04 21:28:15.176 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 1
2025-03-04 21:28:15.177 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:28:15.184 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:28:15.189 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 18ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":2,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:28:15.189 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:19.489 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:19.490 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"111","imageUrl":"","replyCommentId":40047}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:28:19.490 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:28:19.491 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40080,"content":"111","imageUrl":"","replyCommentId":40047,"createTime":"2025-03-04 21:28:19","creatorId":2100}
2025-03-04 21:28:19.491 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:28:19.492 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:19.492 [NettyClientPublicExecutor_27] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140E93230020, offsetMsgId=AC1B600100002A9F0000000000014D1E, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=18]
2025-03-04 21:28:19.508 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:28:19.509 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40080,"content":"111","imageUrl":"","replyCommentId":40047,"createTime":"2025-03-04 21:28:19","creatorId":2100}
2025-03-04 21:28:19.509 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:28:19.509 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40047(Long)
2025-03-04 21:28:19.510 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:28:19.511 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40080,"noteId":1895792506252034080,"userId":2100,"contentUuid":"a52c22cc-072d-4b99-9fcf-8850ff05fdb9","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40046,"replyCommentId":40047,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:28:19","updateTime":"2025-03-04 21:28:19"}]
2025-03-04 21:28:19.511 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:28:19.512 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40080(Long), 1895792506252034080(Long), 2100(Long), a52c22cc-072d-4b99-9fcf-8850ff05fdb9(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40046(Long), 40047(Long), 2100(Long), false(Boolean), 2025-03-04T21:28:19(LocalDateTime), 2025-03-04T21:28:19(LocalDateTime)
2025-03-04 21:28:19.513 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:28:19.528 [NettyClientPublicExecutor_28] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140E93470021, offsetMsgId=AC1B600100002A9F0000000000014ECA, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=25]
2025-03-04 21:28:20.316 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:28:20.316 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40046]"]
2025-03-04 21:28:20.316 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40046]
2025-03-04 21:28:20.316 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:28:20.316 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:28:20.318 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:28:20.318 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:28:20.318 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40046(Long), 0.6(Double), 40046(Long)
2025-03-04 21:28:20.326 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:28:20.326 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40080,\"level\":2,\"parentId\":40046}]"]
2025-03-04 21:28:20.327 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:28:20.328 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:28:20.329 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:28:20.330 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:28:30.769 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:30.770 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"发送到发送到","imageUrl":"","replyCommentId":40046}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:28:30.770 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:28:30.772 [http-nio-8093-exec-5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40081,"content":"发送到发送到","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 21:28:30","creatorId":2100}
2025-03-04 21:28:30.772 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:28:30.772 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:28:30.773 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140EBF340022, offsetMsgId=AC1B600100002A9F0000000000015149, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=19]
2025-03-04 21:28:30.790 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:28:30.791 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40081,"content":"发送到发送到","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 21:28:30","creatorId":2100}
2025-03-04 21:28:30.791 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:28:30.791 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:28:30.792 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:28:30.792 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40081,"noteId":1895792506252034080,"userId":2100,"contentUuid":"8c226a85-300b-4691-9d6a-b972e387f4e3","content":"发送到发送到","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40046,"replyCommentId":40046,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:28:30","updateTime":"2025-03-04 21:28:30"}]
2025-03-04 21:28:30.793 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:28:30.793 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40081(Long), 1895792506252034080(Long), 2100(Long), 8c226a85-300b-4691-9d6a-b972e387f4e3(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40046(Long), 40046(Long), 2100(Long), false(Boolean), 2025-03-04T21:28:30(LocalDateTime), 2025-03-04T21:28:30(LocalDateTime)
2025-03-04 21:28:30.795 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:28:30.809 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B140EBF580023, offsetMsgId=AC1B600100002A9F0000000000015304, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=21]
2025-03-04 21:28:31.339 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:28:31.339 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40081,\"level\":2,\"parentId\":40046}]"]
2025-03-04 21:28:32.338 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:28:32.338 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40046]"]
2025-03-04 21:28:32.338 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40046]
2025-03-04 21:28:32.338 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:28:32.338 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:28:32.340 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:28:32.340 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:28:32.340 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40046(Long), 0.9(Double), 40046(Long)
2025-03-04 21:28:32.351 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:28:35.943 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:28:35.944 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:28:35.949 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 21:28:35.949 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40046(Long), 40047(Long)
2025-03-04 21:28:35.950 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 21:28:35.950 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:28:35.951 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:16.436 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:16.437 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:31:16.439 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:16.439 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:16.439 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:31:16.439 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:31:16.443 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:31:16.443 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:31:16.443 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:31:16.443 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:16.444 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:16.444 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:21.623 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:21.624 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:31:21.629 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:31:21.630 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:25.707 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:25.708 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"111","imageUrl":"","replyCommentId":40047}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:31:25.708 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:31:25.710 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40082,"content":"111","imageUrl":"","replyCommentId":40047,"createTime":"2025-03-04 21:31:25","creatorId":2100}
2025-03-04 21:31:25.711 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:31:25.711 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:31:25.711 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14116A8F0024, offsetMsgId=AC1B600100002A9F0000000000015583, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=24]
2025-03-04 21:31:25.718 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:31:25.718 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40082,"content":"111","imageUrl":"","replyCommentId":40047,"createTime":"2025-03-04 21:31:25","creatorId":2100}
2025-03-04 21:31:25.719 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:31:25.720 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40047(Long)
2025-03-04 21:31:25.721 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:31:25.721 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40082,"noteId":1895792506252034080,"userId":2100,"contentUuid":"ffd8dcb2-913d-445f-9bb3-1da046e48b19","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40046,"replyCommentId":40047,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:31:25","updateTime":"2025-03-04 21:31:25"}]
2025-03-04 21:31:25.722 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:31:25.722 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40082(Long), 1895792506252034080(Long), 2100(Long), ffd8dcb2-913d-445f-9bb3-1da046e48b19(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40046(Long), 40047(Long), 2100(Long), false(Boolean), 2025-03-04T21:31:25(LocalDateTime), 2025-03-04T21:31:25(LocalDateTime)
2025-03-04 21:31:25.723 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:31:25.737 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14116AA80025, offsetMsgId=AC1B600100002A9F000000000001572F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=22]
2025-03-04 21:31:26.424 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:31:26.424 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40046]"]
2025-03-04 21:31:26.424 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40046]
2025-03-04 21:31:26.424 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:31:26.425 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:31:26.426 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:31:26.427 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:31:26.427 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40046(Long), 1.2(Double), 40046(Long)
2025-03-04 21:31:26.441 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:31:26.518 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:31:26.518 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40082,\"level\":2,\"parentId\":40046}]"]
2025-03-04 21:31:34.131 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:31:34.132 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:31:34.138 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":5,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:31:34.139 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:32:01.461 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:32:01.461 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:32:01.466 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":5,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:32:01.467 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:32:07.541 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:32:07.541 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791181581779002,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:32:07.542 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:32:07.543 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895791181581779002(Long)
2025-03-04 21:32:07.549 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 21:32:07.550 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 21:32:07.550 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791181581779002(Long), 0(Long), 7(Long)
2025-03-04 21:32:07.551 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 21:32:07.551 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791181581779002(Long)
2025-03-04 21:32:07.551 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 1
2025-03-04 21:32:07.552 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:32:07.553 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 1
2025-03-04 21:32:07.560 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:32:07.563 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 22ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40031,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这是在干啥子呢？","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":1,"totalCount":1,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:32:07.563 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:32:12.486 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:32:12.486 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794954152706064,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:32:12.487 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:32:12.488 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794954152706064(Long)
2025-03-04 21:32:12.489 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 0
2025-03-04 21:32:12.489 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 21:32:12.489 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:32:19.215 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:32:19.216 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:32:19.221 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":5,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:32:19.222 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:32:23.061 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:32:23.062 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895792506252034080,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:32:23.067 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40046,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"马爸爸👻","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40047,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这个时候的马云，浑身都散发着迷人的魅力😂","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":5,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:32:23.067 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:33:01.834 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:33:01.835 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895792506252034080,"content":"1231","imageUrl":"","replyCommentId":40046}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:33:01.835 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:33:01.837 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895792506252034080,"commentId":40083,"content":"1231","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 21:33:01","creatorId":2100}
2025-03-04 21:33:01.837 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:33:01.837 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:33:01.838 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1412E20D0026, offsetMsgId=AC1B600100002A9F00000000000159AE, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=20]
2025-03-04 21:33:01.852 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:33:01.852 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895792506252034080,"commentId":40083,"content":"1231","imageUrl":"","replyCommentId":40046,"createTime":"2025-03-04 21:33:01","creatorId":2100}
2025-03-04 21:33:01.853 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:33:01.853 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:33:01.856 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:33:01.856 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40083,"noteId":1895792506252034080,"userId":2100,"contentUuid":"9aa1a3a7-3dce-48ea-a91a-a48eb49cabab","content":"1231","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40046,"replyCommentId":40046,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:33:01","updateTime":"2025-03-04 21:33:01"}]
2025-03-04 21:33:01.857 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:33:01.858 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40083(Long), 1895792506252034080(Long), 2100(Long), 9aa1a3a7-3dce-48ea-a91a-a48eb49cabab(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40046(Long), 40046(Long), 2100(Long), false(Boolean), 2025-03-04T21:33:01(LocalDateTime), 2025-03-04T21:33:01(LocalDateTime)
2025-03-04 21:33:01.860 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:33:01.878 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1412E2360027, offsetMsgId=AC1B600100002A9F0000000000015B5B, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=17]
2025-03-04 21:33:02.486 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:33:02.486 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40046]"]
2025-03-04 21:33:02.486 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40046]
2025-03-04 21:33:02.486 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:33:02.486 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40046(Long)
2025-03-04 21:33:02.488 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:33:02.489 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:33:02.489 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40046(Long), 1.5(Double), 40046(Long)
2025-03-04 21:33:02.497 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:33:02.591 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:33:02.591 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895792506252034080,\"commentId\":40083,\"level\":2,\"parentId\":40046}]"]
2025-03-04 21:33:26.615 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:33:26.615 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:33:26.617 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:33:26.617 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895795185766367284(Long)
2025-03-04 21:33:26.618 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 21:33:26.623 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? )
2025-03-04 21:33:26.623 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40022(Long), 40005(Long), 40034(Long), 40038(Long)
2025-03-04 21:33:26.625 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 4
2025-03-04 21:33:26.625 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 10ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":31,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 21:33:26.625 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:33:31.330 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:33:31.331 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40022}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:33:31.331 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:33:31.332 [http-nio-8093-exec-5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40084,"content":"111","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:33:31","creatorId":2100}
2025-03-04 21:33:31.332 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:33:31.333 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:33:31.334 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141355440028, offsetMsgId=AC1B600100002A9F0000000000015DDA, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=21]
2025-03-04 21:33:31.349 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:33:31.349 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40084,"content":"111","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:33:31","creatorId":2100}
2025-03-04 21:33:31.349 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:33:31.350 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:33:31.351 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:33:31.351 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40084,"noteId":1895795185766367284,"userId":2100,"contentUuid":"a719ae7e-f753-420f-aefd-59fd35b6de48","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40022,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:33:31","updateTime":"2025-03-04 21:33:31"}]
2025-03-04 21:33:31.352 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:33:31.352 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40084(Long), 1895795185766367284(Long), 2100(Long), a719ae7e-f753-420f-aefd-59fd35b6de48(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40022(Long), 2100(Long), false(Boolean), 2025-03-04T21:33:31(LocalDateTime), 2025-03-04T21:33:31(LocalDateTime)
2025-03-04 21:33:31.353 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:33:31.369 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141355680029, offsetMsgId=AC1B600100002A9F0000000000015F86, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=18]
2025-03-04 21:33:31.631 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:33:31.631 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40084,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:33:31.632 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:33:31.632 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:33:31.633 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:33:32.514 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:33:32.514 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:33:32.514 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:33:32.514 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:33:32.514 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:33:32.516 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:33:32.517 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:33:32.517 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 1.2(Double), 40022(Long)
2025-03-04 21:33:32.524 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:34:16.750 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:34:16.750 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"电风扇反倒是","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:34:16.751 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:34:16.752 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40085,"content":"电风扇反倒是","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:34:16","creatorId":2100}
2025-03-04 21:34:16.752 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:34:16.753 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:34:16.753 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141406B0002A, offsetMsgId=AC1B600100002A9F0000000000016205, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=22]
2025-03-04 21:34:16.766 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:34:16.766 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40085,"content":"电风扇反倒是","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:34:16","creatorId":2100}
2025-03-04 21:34:16.767 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40085,"noteId":1895795185766367284,"userId":2100,"contentUuid":"bd747cea-2b83-4daf-b91b-73ea6ba3ee4a","content":"电风扇反倒是","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 21:34:16","updateTime":"2025-03-04 21:34:16"}]
2025-03-04 21:34:16.768 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:34:16.768 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40085(Long), 1895795185766367284(Long), 2100(Long), bd747cea-2b83-4daf-b91b-73ea6ba3ee4a(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T21:34:16(LocalDateTime), 2025-03-04T21:34:16(LocalDateTime)
2025-03-04 21:34:16.770 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:34:16.784 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141406CF002B, offsetMsgId=AC1B600100002A9F00000000000163BF, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=19]
2025-03-04 21:34:17.696 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:34:17.696 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40085,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 21:34:23.897 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:34:23.898 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"的冯绍峰","imageUrl":"","replyCommentId":40022}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:34:23.898 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:34:23.899 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40086,"content":"的冯绍峰","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:34:23","creatorId":2100}
2025-03-04 21:34:23.899 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:34:23.899 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:34:23.900 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414229B002C, offsetMsgId=AC1B600100002A9F000000000001652F, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=25]
2025-03-04 21:34:23.924 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:34:23.924 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40086,"content":"的冯绍峰","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:34:23","creatorId":2100}
2025-03-04 21:34:23.926 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:34:23.926 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:34:23.927 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:34:23.928 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40086,"noteId":1895795185766367284,"userId":2100,"contentUuid":"0c7e9307-b530-4c50-93c7-6cf0894fc2d3","content":"的冯绍峰","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40022,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:34:23","updateTime":"2025-03-04 21:34:23"}]
2025-03-04 21:34:23.928 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:34:23.929 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40086(Long), 1895795185766367284(Long), 2100(Long), 0c7e9307-b530-4c50-93c7-6cf0894fc2d3(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40022(Long), 2100(Long), false(Boolean), 2025-03-04T21:34:23(LocalDateTime), 2025-03-04T21:34:23(LocalDateTime)
2025-03-04 21:34:23.930 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:34:23.945 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141422C8002D, offsetMsgId=AC1B600100002A9F00000000000166E4, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=20]
2025-03-04 21:34:24.567 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:34:24.567 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:34:24.567 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:34:24.567 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:34:24.567 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:34:24.570 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:34:24.570 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:34:24.570 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 1.5(Double), 40022(Long)
2025-03-04 21:34:24.585 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:34:24.702 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:34:24.702 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40086,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:34:53.901 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:34:53.902 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"222","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:34:53.902 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:34:53.903 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40087,"content":"222","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:34:53","creatorId":2100}
2025-03-04 21:34:53.903 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:34:53.904 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:34:53.904 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141497CF002E, offsetMsgId=AC1B600100002A9F0000000000016963, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=15]
2025-03-04 21:34:53.924 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:34:53.924 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40087,"content":"222","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:34:53","creatorId":2100}
2025-03-04 21:34:53.924 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40087,"noteId":1895795185766367284,"userId":2100,"contentUuid":"48024874-1df5-4b96-8de7-8cffb2da1350","content":"222","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 21:34:53","updateTime":"2025-03-04 21:34:53"}]
2025-03-04 21:34:53.925 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:34:53.926 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40087(Long), 1895795185766367284(Long), 2100(Long), 48024874-1df5-4b96-8de7-8cffb2da1350(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T21:34:53(LocalDateTime), 2025-03-04T21:34:53(LocalDateTime)
2025-03-04 21:34:53.927 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:34:53.942 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141497F5002F, offsetMsgId=AC1B600100002A9F0000000000016B0E, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=11]
2025-03-04 21:34:54.733 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:34:54.733 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40087,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 21:35:06.807 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:06.808 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:35:06.815 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":5,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":35,"pageSize":7,"totalPage":5} =================================== 
2025-03-04 21:35:06.815 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:10.474 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:10.474 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"1231","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:35:10.474 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:35:10.476 [http-nio-8093-exec-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40088,"content":"1231","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:10","creatorId":2100}
2025-03-04 21:35:10.476 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:35:10.476 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:10.477 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414D88C0030, offsetMsgId=AC1B600100002A9F0000000000016C7E, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=26]
2025-03-04 21:35:10.487 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:35:10.487 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40088,"content":"1231","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:10","creatorId":2100}
2025-03-04 21:35:10.487 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:10.488 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:35:10.489 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:10.489 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40088,"noteId":1895795185766367284,"userId":2100,"contentUuid":"a08bacd8-6422-4fde-b97f-898a4998ea32","content":"1231","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:35:10","updateTime":"2025-03-04 21:35:10"}]
2025-03-04 21:35:10.490 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:35:10.490 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40088(Long), 1895795185766367284(Long), 2100(Long), a08bacd8-6422-4fde-b97f-898a4998ea32(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:35:10(LocalDateTime), 2025-03-04T21:35:10(LocalDateTime)
2025-03-04 21:35:10.491 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:35:10.506 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414D8A90031, offsetMsgId=AC1B600100002A9F0000000000016E2B, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=12]
2025-03-04 21:35:10.747 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:35:10.747 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40088,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:35:12.607 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:35:12.607 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:35:12.607 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:35:12.607 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:12.608 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:35:12.609 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:12.610 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:35:12.610 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 1.8(Double), 40022(Long)
2025-03-04 21:35:12.625 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:35:13.421 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:13.421 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"1231","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:35:13.421 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:35:13.423 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40089,"content":"1231","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:13","creatorId":2100}
2025-03-04 21:35:13.423 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:35:13.423 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:13.424 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414E40F0032, offsetMsgId=AC1B600100002A9F00000000000170AA, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=16]
2025-03-04 21:35:13.432 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:35:13.432 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40089,"content":"1231","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:13","creatorId":2100}
2025-03-04 21:35:13.433 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:13.433 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:35:13.434 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:13.435 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40089,"noteId":1895795185766367284,"userId":2100,"contentUuid":"35502cf9-7f23-445f-9325-88d23a14e76e","content":"1231","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:35:13","updateTime":"2025-03-04 21:35:13"}]
2025-03-04 21:35:13.435 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:35:13.436 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40089(Long), 1895795185766367284(Long), 2100(Long), 35502cf9-7f23-445f-9325-88d23a14e76e(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:35:13(LocalDateTime), 2025-03-04T21:35:13(LocalDateTime)
2025-03-04 21:35:13.437 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:35:13.452 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414E42B0033, offsetMsgId=AC1B600100002A9F0000000000017257, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=23]
2025-03-04 21:35:13.750 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:35:13.750 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40089,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:35:14.628 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:35:14.628 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:35:14.628 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:35:14.628 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:14.628 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:35:14.629 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:14.630 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:35:14.630 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 2.1(Double), 40022(Long)
2025-03-04 21:35:14.636 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:35:16.534 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:16.535 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:35:16.535 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:35:16.537 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40090,"content":"111","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:16","creatorId":2100}
2025-03-04 21:35:16.537 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:35:16.537 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:16.537 [NettyClientPublicExecutor_19] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414F0390034, offsetMsgId=AC1B600100002A9F00000000000174D6, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=23]
2025-03-04 21:35:16.541 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:35:16.541 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40090,"content":"111","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:35:16","creatorId":2100}
2025-03-04 21:35:16.541 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:16.541 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:35:16.543 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:16.543 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40090,"noteId":1895795185766367284,"userId":2100,"contentUuid":"514394be-cfeb-41fd-b12e-5334f6e7c8e7","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:35:16","updateTime":"2025-03-04 21:35:16"}]
2025-03-04 21:35:16.543 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:35:16.544 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40090(Long), 1895795185766367284(Long), 2100(Long), 514394be-cfeb-41fd-b12e-5334f6e7c8e7(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:35:16(LocalDateTime), 2025-03-04T21:35:16(LocalDateTime)
2025-03-04 21:35:16.545 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:35:16.559 [NettyClientPublicExecutor_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1414F04E0035, offsetMsgId=AC1B600100002A9F0000000000017682, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=13]
2025-03-04 21:35:16.754 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:35:16.754 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40090,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:35:18.640 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:35:18.640 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:35:18.640 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:35:18.640 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:35:18.640 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:35:18.642 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:35:18.642 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:35:18.643 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 2.4(Double), 40022(Long)
2025-03-04 21:35:18.650 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:35:43.017 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:43.017 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:35:43.017 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:35:43.019 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40091,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:35:43","creatorId":2100}
2025-03-04 21:35:43.020 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:35:43.020 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:43.021 [NettyClientPublicExecutor_21] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141557AC0036, offsetMsgId=AC1B600100002A9F0000000000017901, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=17]
2025-03-04 21:35:43.040 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:35:43.040 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40091,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:35:43","creatorId":2100}
2025-03-04 21:35:43.040 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40091,"noteId":1895795185766367284,"userId":2100,"contentUuid":"dba9f00b-6df1-4864-8e21-2432eb550d2e","content":"111","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 21:35:43","updateTime":"2025-03-04 21:35:43"}]
2025-03-04 21:35:43.041 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:35:43.042 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40091(Long), 1895795185766367284(Long), 2100(Long), dba9f00b-6df1-4864-8e21-2432eb550d2e(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T21:35:43(LocalDateTime), 2025-03-04T21:35:43(LocalDateTime)
2025-03-04 21:35:43.043 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_4] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:35:43.059 [NettyClientPublicExecutor_22] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141557D20037, offsetMsgId=AC1B600100002A9F0000000000017AAC, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=21]
2025-03-04 21:35:43.805 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:35:43.805 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40091,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 21:35:53.476 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:35:53.476 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"水电费","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:35:53.476 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:35:53.477 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40092,"content":"水电费","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:35:53","creatorId":2100}
2025-03-04 21:35:53.478 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:35:53.478 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:35:53.479 [NettyClientPublicExecutor_23] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141580860038, offsetMsgId=AC1B600100002A9F0000000000017C1C, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=18]
2025-03-04 21:35:53.501 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:35:53.501 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40092,"content":"水电费","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 21:35:53","creatorId":2100}
2025-03-04 21:35:53.501 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40092,"noteId":1895795185766367284,"userId":2100,"contentUuid":"32d20036-56c4-4aa4-8bda-4ae1ebe94427","content":"水电费","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 21:35:53","updateTime":"2025-03-04 21:35:53"}]
2025-03-04 21:35:53.502 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:35:53.503 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40092(Long), 1895795185766367284(Long), 2100(Long), 32d20036-56c4-4aa4-8bda-4ae1ebe94427(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T21:35:53(LocalDateTime), 2025-03-04T21:35:53(LocalDateTime)
2025-03-04 21:35:53.504 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_5] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:35:53.520 [NettyClientPublicExecutor_24] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141580AF0039, offsetMsgId=AC1B600100002A9F0000000000017DCD, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=26]
2025-03-04 21:35:53.813 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:35:53.813 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40092,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 21:36:11.625 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:36:11.626 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:36:11.632 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":8,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":40,"pageSize":7,"totalPage":6} =================================== 
2025-03-04 21:36:11.632 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:36:19.440 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:36:19.440 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"我热","imageUrl":"","replyCommentId":40021}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:36:19.440 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:36:19.442 [http-nio-8093-exec-1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40093,"content":"我热","imageUrl":"","replyCommentId":40021,"createTime":"2025-03-04 21:36:19","creatorId":2100}
2025-03-04 21:36:19.442 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:36:19.442 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:36:19.443 [NettyClientPublicExecutor_25] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1415E5F2003A, offsetMsgId=AC1B600100002A9F0000000000017F3D, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=17]
2025-03-04 21:36:19.457 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:36:19.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40093,"content":"我热","imageUrl":"","replyCommentId":40021,"createTime":"2025-03-04 21:36:19","creatorId":2100}
2025-03-04 21:36:19.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:36:19.458 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 21:36:19.460 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:36:19.460 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40093,"noteId":1895795185766367284,"userId":2100,"contentUuid":"52aba144-2775-482d-80e8-a7558d15b51c","content":"我热","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40021,"replyCommentId":40021,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:36:19","updateTime":"2025-03-04 21:36:19"}]
2025-03-04 21:36:19.461 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:36:19.461 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40093(Long), 1895795185766367284(Long), 2100(Long), 52aba144-2775-482d-80e8-a7558d15b51c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40021(Long), 40021(Long), 2100(Long), false(Boolean), 2025-03-04T21:36:19(LocalDateTime), 2025-03-04T21:36:19(LocalDateTime)
2025-03-04 21:36:19.462 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_6] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:36:19.477 [NettyClientPublicExecutor_26] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1415E614003B, offsetMsgId=AC1B600100002A9F00000000000180EC, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=24]
2025-03-04 21:36:19.870 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:36:19.870 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40093,\"level\":2,\"parentId\":40021}]"]
2025-03-04 21:36:19.871 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:36:19.872 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 21:36:19.873 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:36:20.683 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:36:20.683 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40021]"]
2025-03-04 21:36:20.683 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40021]
2025-03-04 21:36:20.683 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:36:20.684 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 21:36:20.685 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:36:20.685 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:36:20.685 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40021(Long), 0.6(Double), 40021(Long)
2025-03-04 21:36:20.702 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:37:48.376 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:37:48.376 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:37:48.377 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:37:48.378 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:37:48.378 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:37:48.378 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 21:37:48.379 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 21:37:48.380 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 21:37:48.380 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895794402190688291(Long)
2025-03-04 21:37:48.381 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 21:37:48.384 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:37:48.384 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:37:48.385 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 21:37:48.385 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:37:48.397 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:37:48.397 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 21:37:48.403 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":8,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.9},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"23 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":41,"pageSize":7,"totalPage":6} =================================== 
2025-03-04 21:37:48.404 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:37:52.730 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:37:52.731 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40022}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:37:52.731 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:37:52.733 [http-nio-8093-exec-6] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40094,"content":"111","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:37:52","creatorId":2100}
2025-03-04 21:37:52.733 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:37:52.734 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:37:52.734 [NettyClientPublicExecutor_27] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1417525D003C, offsetMsgId=AC1B600100002A9F000000000001836B, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=27]
2025-03-04 21:37:52.735 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:37:52.735 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40094,"content":"111","imageUrl":"","replyCommentId":40022,"createTime":"2025-03-04 21:37:52","creatorId":2100}
2025-03-04 21:37:52.736 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:37:52.736 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:37:52.737 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:37:52.737 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40094,"noteId":1895795185766367284,"userId":2100,"contentUuid":"63166833-2f32-4832-abad-91de31b9ceb9","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40022,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:37:52","updateTime":"2025-03-04 21:37:52"}]
2025-03-04 21:37:52.738 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:37:52.738 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40094(Long), 1895795185766367284(Long), 2100(Long), 63166833-2f32-4832-abad-91de31b9ceb9(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40022(Long), 2100(Long), false(Boolean), 2025-03-04T21:37:52(LocalDateTime), 2025-03-04T21:37:52(LocalDateTime)
2025-03-04 21:37:52.740 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:37:52.758 [NettyClientPublicExecutor_28] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14175276003D, offsetMsgId=AC1B600100002A9F0000000000018517, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=25]
2025-03-04 21:37:52.961 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:37:52.961 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40094,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:37:54.738 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:37:54.738 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:37:54.738 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:37:54.738 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:37:54.738 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:37:54.740 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:37:54.740 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:37:54.740 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 2.7(Double), 40022(Long)
2025-03-04 21:37:54.756 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:37:56.597 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:37:56.597 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"222","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:37:56.597 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:37:56.599 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40095,"content":"222","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:37:56","creatorId":2100}
2025-03-04 21:37:56.599 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:37:56.599 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:37:56.600 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14176177003E, offsetMsgId=AC1B600100002A9F0000000000018796, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=28]
2025-03-04 21:37:56.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:37:56.623 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40095,"content":"222","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:37:56","creatorId":2100}
2025-03-04 21:37:56.624 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:37:56.624 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:37:56.625 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:37:56.625 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40095,"noteId":1895795185766367284,"userId":2100,"contentUuid":"109d3c02-1d2b-4a09-8607-cb26f2791b7b","content":"222","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:37:56","updateTime":"2025-03-04 21:37:56"}]
2025-03-04 21:37:56.626 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:37:56.626 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40095(Long), 1895795185766367284(Long), 2100(Long), 109d3c02-1d2b-4a09-8607-cb26f2791b7b(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:37:56(LocalDateTime), 2025-03-04T21:37:56(LocalDateTime)
2025-03-04 21:37:56.628 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_8] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:37:56.640 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B141761A0003F, offsetMsgId=AC1B600100002A9F0000000000018942, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=22]
2025-03-04 21:37:56.966 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:37:56.966 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40095,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:37:58.761 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:37:58.761 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:37:58.761 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:37:58.761 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:37:58.761 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:37:58.762 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:37:58.763 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:37:58.763 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 3.0(Double), 40022(Long)
2025-03-04 21:37:58.769 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:38:02.904 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:38:02.905 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"发送到发大水","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:38:02.905 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:38:02.907 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40096,"content":"发送到发大水","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:38:02","creatorId":2100}
2025-03-04 21:38:02.907 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:38:02.907 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:38:02.908 [NettyClientPublicExecutor_3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14177A1B0040, offsetMsgId=AC1B600100002A9F0000000000018BC1, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=19]
2025-03-04 21:38:02.911 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:38:02.911 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40096,"content":"发送到发大水","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:38:02","creatorId":2100}
2025-03-04 21:38:02.912 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:38:02.912 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:38:02.914 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:38:02.914 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40096,"noteId":1895795185766367284,"userId":2100,"contentUuid":"5029824c-d0f0-42e7-bdcf-24db5fb3bbe3","content":"发送到发大水","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:38:02","updateTime":"2025-03-04 21:38:02"}]
2025-03-04 21:38:02.915 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:38:02.916 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40096(Long), 1895795185766367284(Long), 2100(Long), 5029824c-d0f0-42e7-bdcf-24db5fb3bbe3(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:38:02(LocalDateTime), 2025-03-04T21:38:02(LocalDateTime)
2025-03-04 21:38:02.918 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_9] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:38:02.934 [NettyClientPublicExecutor_4] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14177A350041, offsetMsgId=AC1B600100002A9F0000000000018D7C, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=23]
2025-03-04 21:38:02.972 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:38:02.972 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40096,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:38:04.776 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:38:04.776 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:38:04.776 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:38:04.776 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:38:04.776 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:38:04.778 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:38:04.778 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:38:04.779 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 3.3(Double), 40022(Long)
2025-03-04 21:38:04.787 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 21:38:15.670 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 21:38:15.671 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 21:38:15.671 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 21:38:15.673 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40097,"content":"111","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:38:15","creatorId":2100}
2025-03-04 21:38:15.673 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 21:38:15.673 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 21:38:15.674 [NettyClientPublicExecutor_5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1417ABF90042, offsetMsgId=AC1B600100002A9F0000000000018FFB, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=29]
2025-03-04 21:38:15.689 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 21:38:15.689 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40097,"content":"111","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 21:38:15","creatorId":2100}
2025-03-04 21:38:15.690 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:38:15.690 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 21:38:15.691 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:38:15.691 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40097,"noteId":1895795185766367284,"userId":2100,"contentUuid":"05b98af0-b381-417f-9a2d-f2b81e99635b","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 21:38:15","updateTime":"2025-03-04 21:38:15"}]
2025-03-04 21:38:15.692 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 21:38:15.692 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40097(Long), 1895795185766367284(Long), 2100(Long), 05b98af0-b381-417f-9a2d-f2b81e99635b(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T21:38:15(LocalDateTime), 2025-03-04T21:38:15(LocalDateTime)
2025-03-04 21:38:15.693 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 21:38:15.707 [NettyClientPublicExecutor_6] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1417AC1B0043, offsetMsgId=AC1B600100002A9F00000000000191A7, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=14]
2025-03-04 21:38:15.998 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 21:38:15.998 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40097,\"level\":2,\"parentId\":40022}]"]
2025-03-04 21:38:16.793 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 21:38:16.793 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 21:38:16.793 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 21:38:16.793 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 21:38:16.793 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 21:38:16.794 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 21:38:16.795 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 21:38:16.795 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 3.6(Double), 40022(Long)
2025-03-04 21:38:16.805 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:02:58.877 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:02:58.878 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"12312","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:02:58.878 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:02:58.881 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40098,"content":"12312","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:02:58","creatorId":2100}
2025-03-04 22:02:58.881 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:02:58.882 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:02:58.883 [NettyClientPublicExecutor_7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B142E4DC10044, offsetMsgId=AC1B600100002A9F0000000000019426, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=30]
2025-03-04 22:02:58.894 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:02:58.894 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40098,"content":"12312","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:02:58","creatorId":2100}
2025-03-04 22:02:58.894 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40098,"noteId":1895795185766367284,"userId":2100,"contentUuid":"8dc4f55b-b8be-4552-b786-45dbe7b24600","content":"12312","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 22:02:58","updateTime":"2025-03-04 22:02:58"}]
2025-03-04 22:02:58.902 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:02:58.903 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40098(Long), 1895795185766367284(Long), 2100(Long), 8dc4f55b-b8be-4552-b786-45dbe7b24600(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T22:02:58(LocalDateTime), 2025-03-04T22:02:58(LocalDateTime)
2025-03-04 22:02:58.904 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_11] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:02:58.919 [NettyClientPublicExecutor_8] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B142E4DE70045, offsetMsgId=AC1B600100002A9F00000000000195D3, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=15]
2025-03-04 22:02:59.406 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:02:59.406 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40098,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 22:03:08.990 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:03:08.990 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"fdsf","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:03:08.991 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:03:08.992 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40099,"content":"fdsf","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:03:08","creatorId":2100}
2025-03-04 22:03:08.992 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:03:08.993 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:03:08.994 [NettyClientPublicExecutor_9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B142E75400046, offsetMsgId=AC1B600100002A9F0000000000019743, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=31]
2025-03-04 22:03:09.006 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:03:09.006 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40099,"content":"fdsf","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:03:08","creatorId":2100}
2025-03-04 22:03:09.006 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40099,"noteId":1895795185766367284,"userId":2100,"contentUuid":"987d7b7b-bd10-4414-9d4e-0a05a92b88cc","content":"fdsf","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 22:03:08","updateTime":"2025-03-04 22:03:08"}]
2025-03-04 22:03:09.008 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:03:09.008 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40099(Long), 1895795185766367284(Long), 2100(Long), 987d7b7b-bd10-4414-9d4e-0a05a92b88cc(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T22:03:08(LocalDateTime), 2025-03-04T22:03:08(LocalDateTime)
2025-03-04 22:03:09.009 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_12] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:03:09.026 [NettyClientPublicExecutor_10] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B142E75610047, offsetMsgId=AC1B600100002A9F00000000000198EF, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=16]
2025-03-04 22:03:09.415 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:03:09.415 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40099,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 22:06:15.858 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:15.859 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:15.862 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 22:06:15.863 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895795185766367284(Long), 0(Long), 7(Long)
2025-03-04 22:06:15.865 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 22:06:15.865 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 22:06:15.866 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895795185766367284(Long)
2025-03-04 22:06:15.867 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 25
2025-03-04 22:06:15.868 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 22:06:15.868 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40023(Long), 40034(Long), 40038(Long), 40037(Long), 40033(Long), 40035(Long), 40039(Long)
2025-03-04 22:06:15.872 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 7
2025-03-04 22:06:15.873 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:15.926 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:15.932 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 73ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":12,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:15.933 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:18.383 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:18.384 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:18.388 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:06:18.388 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40012(Long)
2025-03-04 22:06:18.389 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:06:18.390 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? , ? , ? , ? , ? )
2025-03-04 22:06:18.390 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40099(Long), 40098(Long), 40092(Long), 40091(Long), 40087(Long), 40085(Long)
2025-03-04 22:06:18.391 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 6
2025-03-04 22:06:18.391 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:18.398 [http-nio-8093-exec-6] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:18.403 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 19ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40085,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是","imageUrl":"","createTime":"32 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40087,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"31 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40091,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"30 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40092,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"水电费","imageUrl":"","createTime":"30 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40098,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"12312","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40099,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsf","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:18.403 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:20.505 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:20.505 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:20.515 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 22:06:20.515 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40018(Long), 40010(Long)
2025-03-04 22:06:20.516 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 22:06:20.516 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:20.517 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40020(Long)
2025-03-04 22:06:20.518 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:20.519 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:20.527 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:20.532 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 27ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40041,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"是大佛看电视就废了","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40018,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"20 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40016,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"昨天 20:23","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40014,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"无敌啦~😎😎","imageUrl":"","createTime":"22 小时前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40011,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"333","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40010,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"222","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40020,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"http://127.0.0.1:9000/xiaohashu/b7632eb9a54c403fac3e07241737535e.png","createTime":"昨天 20:48","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":3,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:20.533 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:22.667 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:22.667 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:22.675 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 22:06:22.675 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40009(Long), 40008(Long)
2025-03-04 22:06:22.676 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 22:06:22.676 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:22.677 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40006(Long)
2025-03-04 22:06:22.678 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:22.678 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:22.685 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:22.690 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 23ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40009,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 18:06","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40007,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:57","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":4,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:22.690 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:26.071 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:26.072 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":5}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:26.074 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":5,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:26.074 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:26.088 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:26.088 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":6}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:26.090 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":6,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:26.090 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:26.097 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:26.097 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":7}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:06:26.099 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":7,"totalCount":47,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:06:26.099 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:31.223 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:31.223 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"122","imageUrl":"","replyCommentId":40008}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:06:31.224 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:31.226 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40100,"content":"122","imageUrl":"","replyCommentId":40008,"createTime":"2025-03-04 22:06:31","creatorId":2100}
2025-03-04 22:06:31.226 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:06:31.227 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:31.227 [NettyClientPublicExecutor_11] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14318B3A0048, offsetMsgId=AC1B600100002A9F0000000000019A5F, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=20]
2025-03-04 22:06:31.240 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:06:31.241 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40100,"content":"122","imageUrl":"","replyCommentId":40008,"createTime":"2025-03-04 22:06:31","creatorId":2100}
2025-03-04 22:06:31.241 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:31.241 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40008(Long)
2025-03-04 22:06:31.242 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:31.243 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40100,"noteId":1895795185766367284,"userId":2100,"contentUuid":"93b08f64-4227-4dbd-8136-92b8a4a07272","content":"122","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40008,"replyCommentId":40008,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:06:31","updateTime":"2025-03-04 22:06:31"}]
2025-03-04 22:06:31.243 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:06:31.244 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40100(Long), 1895795185766367284(Long), 2100(Long), 93b08f64-4227-4dbd-8136-92b8a4a07272(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40008(Long), 40008(Long), 2100(Long), false(Boolean), 2025-03-04T22:06:31(LocalDateTime), 2025-03-04T22:06:31(LocalDateTime)
2025-03-04 22:06:31.246 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_13] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:06:31.261 [NettyClientPublicExecutor_12] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B14318B5C0049, offsetMsgId=AC1B600100002A9F0000000000019C0B, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=17]
2025-03-04 22:06:31.593 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:06:31.593 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40100,\"level\":2,\"parentId\":40008}]"]
2025-03-04 22:06:31.594 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:31.594 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40008(Long)
2025-03-04 22:06:31.595 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:31.595 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 22:06:31.596 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40008(Long)
2025-03-04 22:06:31.596 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 22:06:31.597 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 22:06:31.597 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40100(Long), 40008(Long)
2025-03-04 22:06:31.604 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 22:06:33.621 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:06:33.621 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40008]"]
2025-03-04 22:06:33.621 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40008]
2025-03-04 22:06:33.621 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:33.621 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40008(Long)
2025-03-04 22:06:33.622 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:33.623 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:06:33.623 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40008(Long), 0.3(Double), 40008(Long)
2025-03-04 22:06:33.640 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:06:59.460 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:06:59.460 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"fdsf","imageUrl":"","replyCommentId":40006}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:06:59.460 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:06:59.462 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40101,"content":"fdsf","imageUrl":"","replyCommentId":40006,"createTime":"2025-03-04 22:06:59","creatorId":2100}
2025-03-04 22:06:59.462 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:06:59.462 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:06:59.463 [NettyClientPublicExecutor_13] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1431F986004A, offsetMsgId=AC1B600100002A9F0000000000019E8A, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=18]
2025-03-04 22:06:59.477 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:06:59.477 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40101,"content":"fdsf","imageUrl":"","replyCommentId":40006,"createTime":"2025-03-04 22:06:59","creatorId":2100}
2025-03-04 22:06:59.477 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:59.478 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40006(Long)
2025-03-04 22:06:59.479 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:59.480 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40101,"noteId":1895795185766367284,"userId":2100,"contentUuid":"0f4ab6d2-66e7-4acb-8cfd-8ce11fcc1353","content":"fdsf","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40006,"replyCommentId":40006,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:06:59","updateTime":"2025-03-04 22:06:59"}]
2025-03-04 22:06:59.481 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:06:59.481 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40101(Long), 1895795185766367284(Long), 2100(Long), 0f4ab6d2-66e7-4acb-8cfd-8ce11fcc1353(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40006(Long), 40006(Long), 2100(Long), false(Boolean), 2025-03-04T22:06:59(LocalDateTime), 2025-03-04T22:06:59(LocalDateTime)
2025-03-04 22:06:59.482 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_14] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:06:59.497 [NettyClientPublicExecutor_14] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1431F9A8004B, offsetMsgId=AC1B600100002A9F000000000001A037, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=27]
2025-03-04 22:06:59.625 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:06:59.625 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40101,\"level\":2,\"parentId\":40006}]"]
2025-03-04 22:06:59.626 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:06:59.627 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40006(Long)
2025-03-04 22:06:59.629 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:06:59.629 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==>  Preparing: select id from t_comment where parent_id = ? and level = 2 order by create_time asc limit 1
2025-03-04 22:06:59.629 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - ==> Parameters: 40006(Long)
2025-03-04 22:06:59.630 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.selectEarliestByParentId - <==      Total: 1
2025-03-04 22:06:59.630 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==>  Preparing: update t_comment set first_reply_comment_id = ? where id = ?
2025-03-04 22:06:59.630 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - ==> Parameters: 40101(Long), 40006(Long)
2025-03-04 22:06:59.638 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.updateFirstReplyCommentIdByPrimaryKey - <==    Updates: 1
2025-03-04 22:07:01.657 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:07:01.657 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40006]"]
2025-03-04 22:07:01.657 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40006]
2025-03-04 22:07:01.657 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:07:01.657 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40006(Long)
2025-03-04 22:07:01.659 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:07:01.659 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:07:01.659 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40006(Long), 0.3(Double), 40006(Long)
2025-03-04 22:07:01.666 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:07:52.787 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:07:52.787 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:07:52.787 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:07:52.787 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:07:52.794 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:07:52.794 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:07:52.794 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:07:52.795 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:07:52.807 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:07:52.809 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:07:52.815 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 22:07:52.815 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40037(Long), 40033(Long), 40013(Long)
2025-03-04 22:07:52.816 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 22:07:52.817 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":12,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":49,"pageSize":7,"totalPage":7} =================================== 
2025-03-04 22:07:52.817 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:00.876 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:00.877 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"222","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:00.877 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:00.879 [http-nio-8093-exec-7] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40102,"content":"222","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 22:08:00","creatorId":2100}
2025-03-04 22:08:00.879 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:00.879 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:00.879 [NettyClientPublicExecutor_15] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1432E96F004C, offsetMsgId=AC1B600100002A9F000000000001A2B6, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=21]
2025-03-04 22:08:00.902 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:00.902 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40102,"content":"222","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 22:08:00","creatorId":2100}
2025-03-04 22:08:00.902 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:00.902 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 22:08:00.903 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:00.904 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40102,"noteId":1895795185766367284,"userId":2100,"contentUuid":"2207dc81-6ffd-40a6-947b-700b7ba2984c","content":"222","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:00","updateTime":"2025-03-04 22:08:00"}]
2025-03-04 22:08:00.905 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:00.905 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40102(Long), 1895795185766367284(Long), 2100(Long), 2207dc81-6ffd-40a6-947b-700b7ba2984c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T22:08(LocalDateTime), 2025-03-04T22:08(LocalDateTime)
2025-03-04 22:08:00.906 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_15] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:00.918 [NettyClientPublicExecutor_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1432E995004D, offsetMsgId=AC1B600100002A9F000000000001A462, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=28]
2025-03-04 22:08:01.689 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:01.689 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40102,\"level\":2,\"parentId\":40022}]"]
2025-03-04 22:08:01.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:01.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 22:08:01.691 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 22:08:01.691 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:01.691 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 22:08:01.692 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:01.693 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:01.693 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 3.9(Double), 40022(Long)
2025-03-04 22:08:01.700 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:06.583 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:06.584 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"fsfds","imageUrl":"","replyCommentId":40023}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:06.584 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:06.585 [http-nio-8093-exec-2] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40103,"content":"fsfds","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 22:08:06","creatorId":2100}
2025-03-04 22:08:06.585 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:06.586 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:06.586 [NettyClientPublicExecutor_17] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1432FFBA004E, offsetMsgId=AC1B600100002A9F000000000001A6E1, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=19]
2025-03-04 22:08:06.599 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:06.599 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40103,"content":"fsfds","imageUrl":"","replyCommentId":40023,"createTime":"2025-03-04 22:08:06","creatorId":2100}
2025-03-04 22:08:06.599 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:06.599 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40023(Long)
2025-03-04 22:08:06.601 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:06.601 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40103,"noteId":1895795185766367284,"userId":2100,"contentUuid":"c64366d7-129e-42bc-85b5-b512308a7eb6","content":"fsfds","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40022,"replyCommentId":40023,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:06","updateTime":"2025-03-04 22:08:06"}]
2025-03-04 22:08:06.602 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:06.602 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40103(Long), 1895795185766367284(Long), 2100(Long), c64366d7-129e-42bc-85b5-b512308a7eb6(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40022(Long), 40023(Long), 2100(Long), false(Boolean), 2025-03-04T22:08:06(LocalDateTime), 2025-03-04T22:08:06(LocalDateTime)
2025-03-04 22:08:06.603 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_16] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:06.617 [NettyClientPublicExecutor_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1432FFD8004F, offsetMsgId=AC1B600100002A9F000000000001A88F, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=24]
2025-03-04 22:08:06.692 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:06.692 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40103,\"level\":2,\"parentId\":40022}]"]
2025-03-04 22:08:07.703 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:07.703 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40022]"]
2025-03-04 22:08:07.703 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40022]
2025-03-04 22:08:07.703 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:07.703 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40022(Long)
2025-03-04 22:08:07.705 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:07.706 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:07.706 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40022(Long), 4.2(Double), 40022(Long)
2025-03-04 22:08:07.723 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:11.808 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:11.809 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"fdsfds","imageUrl":"","replyCommentId":40038}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:11.809 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:11.810 [http-nio-8093-exec-8] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40104,"content":"fdsfds","imageUrl":"","replyCommentId":40038,"createTime":"2025-03-04 22:08:11","creatorId":2100}
2025-03-04 22:08:11.810 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:11.811 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:11.811 [NettyClientPublicExecutor_19] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143314220050, offsetMsgId=AC1B600100002A9F000000000001AB0E, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=32]
2025-03-04 22:08:11.824 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:11.824 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40104,"content":"fdsfds","imageUrl":"","replyCommentId":40038,"createTime":"2025-03-04 22:08:11","creatorId":2100}
2025-03-04 22:08:11.824 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:11.824 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40038(Long)
2025-03-04 22:08:11.825 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:11.826 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40104,"noteId":1895795185766367284,"userId":2100,"contentUuid":"7de34556-7d8e-44a5-878d-35b063153520","content":"fdsfds","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40021,"replyCommentId":40038,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:11","updateTime":"2025-03-04 22:08:11"}]
2025-03-04 22:08:11.826 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:11.827 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40104(Long), 1895795185766367284(Long), 2100(Long), 7de34556-7d8e-44a5-878d-35b063153520(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40021(Long), 40038(Long), 2100(Long), false(Boolean), 2025-03-04T22:08:11(LocalDateTime), 2025-03-04T22:08:11(LocalDateTime)
2025-03-04 22:08:11.828 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_17] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:11.842 [NettyClientPublicExecutor_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143314420051, offsetMsgId=AC1B600100002A9F000000000001ACBD, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=29]
2025-03-04 22:08:12.697 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:12.697 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40104,\"level\":2,\"parentId\":40021}]"]
2025-03-04 22:08:13.728 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:13.728 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40021]"]
2025-03-04 22:08:13.728 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40021]
2025-03-04 22:08:13.728 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:13.728 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40021(Long)
2025-03-04 22:08:13.729 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:13.730 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:13.730 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40021(Long), 0.9(Double), 40021(Long)
2025-03-04 22:08:13.747 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:19.199 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:19.199 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"dfsfsd","imageUrl":"","replyCommentId":40034}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:19.199 [http-nio-8093-exec-5] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:19.200 [http-nio-8093-exec-5] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40105,"content":"dfsfsd","imageUrl":"","replyCommentId":40034,"createTime":"2025-03-04 22:08:19","creatorId":2100}
2025-03-04 22:08:19.201 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:19.201 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:19.201 [NettyClientPublicExecutor_21] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143331010052, offsetMsgId=AC1B600100002A9F000000000001AF3C, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=20]
2025-03-04 22:08:19.222 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:19.222 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40105,"content":"dfsfsd","imageUrl":"","replyCommentId":40034,"createTime":"2025-03-04 22:08:19","creatorId":2100}
2025-03-04 22:08:19.223 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:19.223 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40034(Long)
2025-03-04 22:08:19.224 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:19.225 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40105,"noteId":1895795185766367284,"userId":2100,"contentUuid":"0b42e97f-1a83-47f1-ba2c-8a1de2fc5a6e","content":"dfsfsd","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40005,"replyCommentId":40034,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:19","updateTime":"2025-03-04 22:08:19"}]
2025-03-04 22:08:19.225 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:19.225 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40105(Long), 1895795185766367284(Long), 2100(Long), 0b42e97f-1a83-47f1-ba2c-8a1de2fc5a6e(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40005(Long), 40034(Long), 2100(Long), false(Boolean), 2025-03-04T22:08:19(LocalDateTime), 2025-03-04T22:08:19(LocalDateTime)
2025-03-04 22:08:19.227 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_18] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:19.241 [NettyClientPublicExecutor_22] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143331280053, offsetMsgId=AC1B600100002A9F000000000001B0EB, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=18]
2025-03-04 22:08:19.703 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:19.703 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40105,\"level\":2,\"parentId\":40005}]"]
2025-03-04 22:08:19.704 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:19.704 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 22:08:19.706 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:21.383 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:21.383 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:08:21.388 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? )
2025-03-04 22:08:21.389 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40099(Long), 40098(Long), 40092(Long), 40091(Long)
2025-03-04 22:08:21.390 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 4
2025-03-04 22:08:21.390 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 22:08:21.390 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40008(Long), 40006(Long)
2025-03-04 22:08:21.392 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 22:08:21.392 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? )
2025-03-04 22:08:21.392 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40101(Long), 40100(Long)
2025-03-04 22:08:21.394 [http-nio-8093-exec-1] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 2
2025-03-04 22:08:21.394 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:21.406 [http-nio-8093-exec-1] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:21.409 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 26ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40101,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsf","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40100,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"122","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40099,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsf","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40098,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"12312","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40092,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"水电费","imageUrl":"","createTime":"30 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40091,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"30 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":53,"pageSize":7,"totalPage":8} =================================== 
2025-03-04 22:08:21.409 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:21.752 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:21.752 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40005]"]
2025-03-04 22:08:21.752 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40005]
2025-03-04 22:08:21.752 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:21.752 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40005(Long)
2025-03-04 22:08:21.754 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:21.754 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:21.755 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40005(Long), 0.9(Double), 40005(Long)
2025-03-04 22:08:21.763 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:25.040 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:25.040 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":40012}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:25.040 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:25.042 [http-nio-8093-exec-4] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40106,"content":"111","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 22:08:25","creatorId":2100}
2025-03-04 22:08:25.042 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:25.042 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:25.043 [NettyClientPublicExecutor_23] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143347D20054, offsetMsgId=AC1B600100002A9F000000000001B36A, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=21]
2025-03-04 22:08:25.050 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:25.050 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40106,"content":"111","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 22:08:25","creatorId":2100}
2025-03-04 22:08:25.050 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:25.050 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 22:08:25.052 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:25.052 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40106,"noteId":1895795185766367284,"userId":2100,"contentUuid":"4e0022de-7780-4a25-bd41-13b3559ae11c","content":"111","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40012,"replyCommentId":40012,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:25","updateTime":"2025-03-04 22:08:25"}]
2025-03-04 22:08:25.053 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:25.053 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40106(Long), 1895795185766367284(Long), 2100(Long), 4e0022de-7780-4a25-bd41-13b3559ae11c(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40012(Long), 40012(Long), 2100(Long), false(Boolean), 2025-03-04T22:08:25(LocalDateTime), 2025-03-04T22:08:25(LocalDateTime)
2025-03-04 22:08:25.057 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_19] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:25.072 [NettyClientPublicExecutor_24] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143347EF0055, offsetMsgId=AC1B600100002A9F000000000001B516, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=2], queueOffset=26]
2025-03-04 22:08:25.709 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:25.709 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40106,\"level\":2,\"parentId\":40012}]"]
2025-03-04 22:08:25.710 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:25.710 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 22:08:25.711 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:25.767 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:25.767 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40012]"]
2025-03-04 22:08:25.767 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40012]
2025-03-04 22:08:25.767 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:25.767 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 22:08:25.768 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:25.769 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:25.769 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40012(Long), 0.6(Double), 40012(Long)
2025-03-04 22:08:25.785 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:29.138 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:29.139 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"222","imageUrl":"","replyCommentId":40012}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:29.139 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:29.140 [http-nio-8093-exec-3] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40107,"content":"222","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 22:08:29","creatorId":2100}
2025-03-04 22:08:29.140 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:29.140 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:29.141 [NettyClientPublicExecutor_25] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143357D40056, offsetMsgId=AC1B600100002A9F000000000001B795, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=1], queueOffset=24]
2025-03-04 22:08:29.142 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:29.142 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40107,"content":"222","imageUrl":"","replyCommentId":40012,"createTime":"2025-03-04 22:08:29","creatorId":2100}
2025-03-04 22:08:29.142 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:29.142 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 22:08:29.144 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:29.144 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40107,"noteId":1895795185766367284,"userId":2100,"contentUuid":"621de4e8-cc32-40aa-ae86-8c9539e08c50","content":"222","isContentEmpty":false,"imageUrl":"","level":2,"replyTotal":0,"likeTotal":0,"parentId":40012,"replyCommentId":40012,"replyUserId":2100,"isTop":false,"createTime":"2025-03-04 22:08:29","updateTime":"2025-03-04 22:08:29"}]
2025-03-04 22:08:29.144 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:29.145 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40107(Long), 1895795185766367284(Long), 2100(Long), 621de4e8-cc32-40aa-ae86-8c9539e08c50(String), false(Boolean), (String), 2(Integer), 0(Long), 0(Long), 40012(Long), 40012(Long), 2100(Long), false(Boolean), 2025-03-04T22:08:29(LocalDateTime), 2025-03-04T22:08:29(LocalDateTime)
2025-03-04 22:08:29.146 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_20] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:29.161 [NettyClientPublicExecutor_26] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143357E80057, offsetMsgId=AC1B600100002A9F000000000001B941, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=25]
2025-03-04 22:08:29.715 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:29.715 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40107,\"level\":2,\"parentId\":40012}]"]
2025-03-04 22:08:31.788 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, size: 1
2025-03-04 22:08:31.788 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 【评论热度值计算】聚合消息, ["[40012]"]
2025-03-04 22:08:31.788 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.biz.consumer.CommentHeatUpdateConsumer - ==> 去重后的评论 ID: [40012]
2025-03-04 22:08:31.788 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? )
2025-03-04 22:08:31.788 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40012(Long)
2025-03-04 22:08:31.790 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 1
2025-03-04 22:08:31.790 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==>  Preparing: UPDATE t_comment SET heat = CASE id WHEN ? THEN ? ELSE heat END WHERE id IN ( ? )
2025-03-04 22:08:31.790 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - ==> Parameters: 40012(Long), 0.9(Double), 40012(Long)
2025-03-04 22:08:31.798 [pool-batch-consume-blocking-queue-thread-0] DEBUG c.q.x.c.b.d.m.C.batchUpdateHeatByCommentIds - <==    Updates: 1
2025-03-04 22:08:37.797 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:08:37.797 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"111","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:08:37.797 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:08:37.799 [http-nio-8093-exec-9] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40108,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:08:37","creatorId":2100}
2025-03-04 22:08:37.799 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 2ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:08:37.799 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:08:37.800 [NettyClientPublicExecutor_27] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143379A70058, offsetMsgId=AC1B600100002A9F000000000001BBC0, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=22]
2025-03-04 22:08:37.805 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:08:37.805 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40108,"content":"111","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:08:37","creatorId":2100}
2025-03-04 22:08:37.805 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40108,"noteId":1895795185766367284,"userId":2100,"contentUuid":"e5fa55d4-7774-4970-a56e-049bda23db1d","content":"111","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 22:08:37","updateTime":"2025-03-04 22:08:37"}]
2025-03-04 22:08:37.807 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:08:37.807 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40108(Long), 1895795185766367284(Long), 2100(Long), e5fa55d4-7774-4970-a56e-049bda23db1d(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T22:08:37(LocalDateTime), 2025-03-04T22:08:37(LocalDateTime)
2025-03-04 22:08:37.809 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_1] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:08:37.826 [NettyClientPublicExecutor_28] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B143379C10059, offsetMsgId=AC1B600100002A9F000000000001BD6B, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=26]
2025-03-04 22:08:38.723 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:08:38.723 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40108,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 22:09:08.471 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:09:08.472 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [发布评论], 入参: {"noteId":1895795185766367284,"content":"2342","imageUrl":"","replyCommentId":null}, 请求类: CommentController, 请求方法: publishComment =================================== 
2025-03-04 22:09:08.472 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:09:08.473 [http-nio-8093-exec-10] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 开始异步发送 MQ, Topic: PublishCommentTopic, Body: {"noteId":1895795185766367284,"commentId":40109,"content":"2342","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:09:08","creatorId":2100}
2025-03-04 22:09:08.473 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [发布评论], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null} =================================== 
2025-03-04 22:09:08.474 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:09:08.475 [NettyClientPublicExecutor_1] INFO  c.q.xiaohashu.comment.biz.retry.SendMqRetryHelper - ==> 【评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1433F179005A, offsetMsgId=AC1B600100002A9F000000000001BEDB, messageQueue=MessageQueue [topic=PublishCommentTopic, brokerName=SK-20231010EQPS, queueId=3], queueOffset=23]
2025-03-04 22:09:08.475 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 本批次消息大小: 1
2025-03-04 22:09:08.475 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> Consumer - Received message: {"noteId":1895795185766367284,"commentId":40109,"content":"2342","imageUrl":"","replyCommentId":null,"createTime":"2025-03-04 22:09:08","creatorId":2100}
2025-03-04 22:09:08.475 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ## 清洗后的 CommentBOS: [{"id":40109,"noteId":1895795185766367284,"userId":2100,"contentUuid":"65e2c406-48a4-4048-a1b7-ffcf541037b1","content":"2342","isContentEmpty":false,"imageUrl":"","level":1,"replyTotal":0,"likeTotal":0,"parentId":1895795185766367284,"replyCommentId":0,"replyUserId":0,"isTop":false,"createTime":"2025-03-04 22:09:08","updateTime":"2025-03-04 22:09:08"}]
2025-03-04 22:09:08.476 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==>  Preparing: insert IGNORE into t_comment (id, note_id, user_id, content_uuid, is_content_empty, image_url, `level`, reply_total, like_total, parent_id, reply_comment_id, reply_user_id, is_top, create_time, update_time ) values (?, ?, ?, ?, ? , ?, ?, ?, ?, ? , ?, ?, ?, ?, ?)
2025-03-04 22:09:08.476 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - ==> Parameters: 40109(Long), 1895795185766367284(Long), 2100(Long), 65e2c406-48a4-4048-a1b7-ffcf541037b1(String), false(Boolean), (String), 1(Integer), 0(Long), 0(Long), 1895795185766367284(Long), 0(Long), 0(Long), false(Boolean), 2025-03-04T22:09:08(LocalDateTime), 2025-03-04T22:09:08(LocalDateTime)
2025-03-04 22:09:08.478 [ConsumeMessageThread_xiaohashu_group_PublishCommentTopic_2] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.batchInsert - <==    Updates: 1
2025-03-04 22:09:08.496 [NettyClientPublicExecutor_2] INFO  c.q.x.comment.biz.consumer.Comment2DBConsumer - ==> 【计数: 评论发布】MQ 发送成功，SendResult: SendResult [sendStatus=SEND_OK, msgId=7F0000013ACC63947C6B1433F18F005B, offsetMsgId=AC1B600100002A9F000000000001C087, messageQueue=MessageQueue [topic=CountNoteCommentTopic, brokerName=SK-20231010EQPS, queueId=0], queueOffset=19]
2025-03-04 22:09:08.744 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, size: 1
2025-03-04 22:09:08.744 [pool-batch-consume-blocking-queue-thread-0] INFO  c.q.x.c.b.c.OneLevelCommentFirstReplyCommentIdUpdateConsumer - ==> 【一级评论 first_reply_comment_id 更新】聚合消息, ["[{\"noteId\":1895795185766367284,\"commentId\":40109,\"level\":1,\"parentId\":1895795185766367284}]"]
2025-03-04 22:09:23.351 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:09:23.351 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:09:23.358 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:09:23.358 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:10:46.880 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:10:46.880 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:10:46.881 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:10:46.881 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:10:46.887 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:10:46.887 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:10:46.888 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:10:46.888 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40023(Long)
2025-03-04 22:10:46.889 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:10:46.889 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:10:46.889 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:10:46.927 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:10:46.928 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:10:46.932 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 4ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:10:46.933 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:11:13.141 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:11:13.141 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:11:13.142 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:11:13.142 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:11:13.147 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:11:13.147 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:11:13.148 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:11:13.148 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:11:13.148 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:11:13.148 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:11:13.154 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:11:13.154 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:16:52.206 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:16:52.206 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:16:52.207 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:16:52.207 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:16:52.214 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:16:52.214 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:16:52.215 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:16:52.215 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:16:52.217 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:16:52.217 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:16:52.223 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:16:52.223 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:19:39.473 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:19:39.492 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":12003,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:19:39.496 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==>  Preparing: select child_comment_total from t_comment where id = ? and level = 1
2025-03-04 22:19:39.496 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==> Parameters: 12003(Long)
2025-03-04 22:19:39.497 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - <==      Total: 0
2025-03-04 22:19:39.513 [http-nio-8093-exec-3] WARN  c.q.x.comment.biz.exception.GlobalExceptionHandler - /comment/child/list request fail, errorCode: COMMENT-20000, errorMessage: 此父评论不存在
2025-03-04 22:19:39.514 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:20:26.840 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:20:26.841 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40023,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:20:26.842 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==>  Preparing: select child_comment_total from t_comment where id = ? and level = 1
2025-03-04 22:20:26.842 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==> Parameters: 40023(Long)
2025-03-04 22:20:26.843 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - <==      Total: 0
2025-03-04 22:20:26.843 [http-nio-8093-exec-9] WARN  c.q.x.comment.biz.exception.GlobalExceptionHandler - /comment/child/list request fail, errorCode: COMMENT-20000, errorMessage: 此父评论不存在
2025-03-04 22:20:26.844 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:20:47.824 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:20:47.825 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40023,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:20:47.826 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==>  Preparing: select child_comment_total from t_comment where id = ? and level = 1
2025-03-04 22:20:47.826 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==> Parameters: 40023(Long)
2025-03-04 22:20:47.827 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - <==      Total: 0
2025-03-04 22:20:47.827 [http-nio-8093-exec-7] WARN  c.q.x.comment.biz.exception.GlobalExceptionHandler - /comment/child/list request fail, errorCode: COMMENT-20000, errorMessage: 此父评论不存在
2025-03-04 22:20:47.827 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:21:01.153 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:21:01.154 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40023,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:21:01.155 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==>  Preparing: select child_comment_total from t_comment where id = ? and level = 1
2025-03-04 22:21:01.155 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - ==> Parameters: 40023(Long)
2025-03-04 22:21:01.156 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentTotalById - <==      Total: 0
2025-03-04 22:21:01.157 [http-nio-8093-exec-10] WARN  c.q.x.comment.biz.exception.GlobalExceptionHandler - /comment/child/list request fail, errorCode: COMMENT-20000, errorMessage: 此父评论不存在
2025-03-04 22:21:01.157 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:22:02.727 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:22:02.729 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:22:02.733 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:22:02.733 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40022(Long), 60(Integer)
2025-03-04 22:22:02.735 [NoteExecutor-8] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 14
2025-03-04 22:22:02.735 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:22:02.735 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40022(Long), 1(Long), 6(Long)
2025-03-04 22:22:02.736 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 6
2025-03-04 22:22:02.737 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:22:02.751 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:22:02.759 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 29ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:22:02.762 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:32:45.393 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:32:45.393 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:32:45.401 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:32:45.402 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40045(Long)
2025-03-04 22:32:45.404 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:32:45.404 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:32:45.405 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:32:45.406 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:32:45.407 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:32:45.412 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:32:45.413 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:32:45.483 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:32:45.484 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:32:45.497 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:32:45.498 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40037(Long)
2025-03-04 22:32:45.499 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:32:45.499 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 15ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:32:45.500 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:33:12.726 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:33:12.727 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:33:12.728 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:33:12.729 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:33:12.733 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:33:12.734 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:33:12.735 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:33:12.735 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:33:12.737 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:33:12.738 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:33:12.744 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:33:12.745 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:43:38.853 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:43:38.854 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:43:38.857 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:43:38.858 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:43:38.862 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:43:38.863 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:43:38.864 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:43:38.865 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:43:38.947 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:43:38.947 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:43:38.954 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:43:38.955 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40033(Long)
2025-03-04 22:43:38.956 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:43:38.956 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:43:38.956 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:47:51.421 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:47:51.424 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:47:51.426 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:47:51.427 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40021(Long), 1(Long), 6(Long)
2025-03-04 22:47:51.428 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 2
2025-03-04 22:47:51.428 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:47:51.428 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40021(Long), 60(Integer)
2025-03-04 22:47:51.428 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:47:51.429 [NoteExecutor-4] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 3
2025-03-04 22:47:51.439 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:47:51.444 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 20ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:47:51.444 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:47:56.392 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:47:56.393 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:47:56.404 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? )
2025-03-04 22:47:56.404 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40093(Long), 40104(Long)
2025-03-04 22:47:56.406 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 2
2025-03-04 22:47:56.406 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 14ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:47:56.407 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:47:57.366 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:47:57.367 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:47:57.373 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:47:57.373 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:47:58.521 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:47:58.522 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:47:58.529 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:47:58.529 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:47:59.496 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:47:59.496 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:47:59.501 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:47:59.502 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:48:07.698 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:48:07.699 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:48:07.705 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:48:07.705 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:50:46.484 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:50:46.484 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:50:46.491 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:50:46.492 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:50:50.796 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:50:50.797 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:50:50.803 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:50:50.803 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:51:55.784 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:51:55.785 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:51:55.790 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:51:55.791 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:51:57.880 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:51:57.881 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:51:57.886 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:51:57.887 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:51:58.559 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:51:58.560 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:51:58.569 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:51:58.569 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:51:58.994 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:51:58.995 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40021,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:51:59.001 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40093,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"我热","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40104,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsfds","imageUrl":"","createTime":"39 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":3,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:51:59.001 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:00.184 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:00.186 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:00.193 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? )
2025-03-04 22:52:00.194 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40024(Long), 40032(Long), 40084(Long), 40086(Long), 40088(Long), 40089(Long)
2025-03-04 22:52:00.196 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 6
2025-03-04 22:52:00.196 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 11ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:00.197 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:03.899 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:03.899 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:03.905 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:03.906 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:06.434 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:06.435 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:06.441 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:06.442 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:07.075 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:07.076 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:07.082 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:07.083 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:07.772 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:07.773 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:07.779 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:07.780 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:11.897 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:11.898 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40022,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:11.904 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40024,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试2","imageUrl":"","createTime":"昨天 22:20","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40032,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"呀呀呀~","imageUrl":"","createTime":"5 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40084,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"48 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40086,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"的冯绍峰","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40088,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40089,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1231","imageUrl":"","createTime":"46 分钟前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":14,"pageSize":6,"totalPage":3} =================================== 
2025-03-04 22:52:11.905 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:23.635 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:23.635 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:52:23.636 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 22:52:23.637 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895793960295596052(Long)
2025-03-04 22:52:23.638 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 22:52:23.640 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 22:52:23.640 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895793960295596052(Long), 0(Long), 7(Long)
2025-03-04 22:52:23.641 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 22:52:23.641 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895793960295596052(Long)
2025-03-04 22:52:23.642 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 7
2025-03-04 22:52:23.642 [NoteExecutor-6] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 7
2025-03-04 22:52:23.643 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? , ? , ? , ? , ? , ? )
2025-03-04 22:52:23.643 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40068(Long), 40051(Long), 40049(Long), 40075(Long), 40056(Long), 40054(Long), 40078(Long)
2025-03-04 22:52:23.645 [http-nio-8093-exec-3] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 7
2025-03-04 22:52:23.645 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:23.656 [http-nio-8093-exec-3] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:23.662 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 27ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":2.1},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"昨天 22:22","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"6 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:52:23.662 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:24.882 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:24.882 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:24.884 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:52:24.884 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:52:24.884 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40055(Long), 1(Long), 6(Long)
2025-03-04 22:52:24.884 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40055(Long), 60(Integer)
2025-03-04 22:52:24.886 [NoteExecutor-2] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 7
2025-03-04 22:52:24.886 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 6
2025-03-04 22:52:24.886 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:24.905 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:24.917 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 35ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:24.917 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:32.691 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:32.691 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:32.698 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? , ? )
2025-03-04 22:52:32.698 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40069(Long), 40070(Long), 40071(Long), 40072(Long), 40073(Long), 40074(Long)
2025-03-04 22:52:32.700 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 6
2025-03-04 22:52:32.700 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:32.701 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:35.570 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:35.571 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:35.576 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:35.576 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:36.104 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:36.106 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:36.111 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:36.111 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:41.132 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:41.133 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:41.138 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:41.138 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:47.809 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:47.810 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:47.816 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:47.817 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:48.656 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:48.656 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:48.663 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:48.663 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:49.135 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:49.135 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:49.142 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:49.142 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:49.387 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:49.388 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:49.397 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:49.397 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:49.597 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:49.598 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:49.604 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 5ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:49.604 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:49.795 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:49.796 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:49.802 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:49.802 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:49.951 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:49.952 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:49.958 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40069,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"都是范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40070,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第三方的","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40071,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"防守打法","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40072,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40073,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100},{"commentId":40074,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:52:49.958 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:51.466 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:51.467 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40025,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:51.469 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:52:51.469 [NoteExecutor-5] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:52:51.469 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40025(Long), 1(Long), 6(Long)
2025-03-04 22:52:51.469 [NoteExecutor-5] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40025(Long), 60(Integer)
2025-03-04 22:52:51.470 [NoteExecutor-5] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 2
2025-03-04 22:52:51.470 [http-nio-8093-exec-10] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 1
2025-03-04 22:52:51.471 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:51.491 [http-nio-8093-exec-10] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:52:51.503 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 36ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40079,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":2,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:52:51.504 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:52:53.298 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:52:53.299 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40025,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:52:53.305 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:52:53.305 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40079(Long)
2025-03-04 22:52:53.306 [http-nio-8093-exec-6] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:52:53.306 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40079,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"佛挡杀佛","imageUrl":"","createTime":"1 小时前","likeTotal":0,"replyUserName":"犬小哈","replyUserId":2100}],"pageNo":1,"totalCount":2,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:52:53.306 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:39.952 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:39.953 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:39.959 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? )
2025-03-04 22:53:39.959 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40062(Long)
2025-03-04 22:53:39.961 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 1
2025-03-04 22:53:39.961 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 9ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:53:39.962 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:39.980 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:39.980 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:39.980 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:39.980 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:39.980 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:39.980 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:39.987 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:53:39.987 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 7ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:53:39.987 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? , ? , ? )
2025-03-04 22:53:39.987 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:39.987 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:39.987 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40068(Long), 40049(Long), 40077(Long), 40052(Long), 40056(Long)
2025-03-04 22:53:39.988 [http-nio-8093-exec-5] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 5
2025-03-04 22:53:39.988 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":2.1},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"6 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"昨天 22:22","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:53:39.990 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:55.568 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:55.569 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795420446064640,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:55.570 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 22:53:55.570 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:53:58.812 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:53:58.812 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794402190688291,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:53:58.818 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40026,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"数据佛的设计费iOS积分","imageUrl":"","createTime":"23 小时前","likeTotal":0,"childCommentTotal":4,"childComments":[{"commentId":40045,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":1.2},{"commentId":40030,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"来咯来咯","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40062,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"2 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":6,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:53:58.819 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:07.471 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:07.472 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40026,"pageNo":1}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:54:07.473 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:54:07.474 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40026(Long), 1(Long), 6(Long)
2025-03-04 22:54:07.474 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:54:07.474 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40026(Long), 60(Integer)
2025-03-04 22:54:07.475 [http-nio-8093-exec-9] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 3
2025-03-04 22:54:07.475 [NoteExecutor-9] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 4
2025-03-04 22:54:07.475 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:54:07.483 [http-nio-8093-exec-9] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:54:07.487 [http-nio-8093-exec-9] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 15ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40063,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"乌拉乌拉","imageUrl":"","createTime":"3 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40064,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null},{"commentId":40065,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"replyUserName":null,"replyUserId":null}],"pageNo":1,"totalCount":4,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:54:07.488 [http-nio-8093-exec-9] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:27.572 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:27.573 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895791464059764794,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:54:27.574 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==>  Preparing: select comment_total from t_note_count where note_id = ?
2025-03-04 22:54:27.575 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - ==> Parameters: 1895791464059764794(Long)
2025-03-04 22:54:27.576 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.N.selectCommentTotalByNoteId - <==      Total: 1
2025-03-04 22:54:27.577 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, heat from t_comment where note_id = ? and level = 1 order by heat desc limit ?, ?
2025-03-04 22:54:27.577 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==>  Preparing: select id, heat from t_comment where note_id = ? and level = 1 order by heat desc limit 500
2025-03-04 22:54:27.578 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - ==> Parameters: 1895791464059764794(Long)
2025-03-04 22:54:27.578 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - ==> Parameters: 1895791464059764794(Long), 0(Long), 7(Long)
2025-03-04 22:54:27.579 [NoteExecutor-3] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectHeatComments - <==      Total: 2
2025-03-04 22:54:27.579 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.mapper.CommentDOMapper.selectPageList - <==      Total: 2
2025-03-04 22:54:27.580 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, create_time, heat from t_comment where id in ( ? , ? )
2025-03-04 22:54:27.580 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - ==> Parameters: 40043(Long), 40048(Long)
2025-03-04 22:54:27.581 [http-nio-8093-exec-7] DEBUG c.q.x.c.b.d.m.C.selectTwoLevelCommentByIds - <==      Total: 2
2025-03-04 22:54:27.581 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:54:27.595 [http-nio-8093-exec-7] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:54:27.607 [http-nio-8093-exec-7] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 34ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40028,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"这次没问题了把~","imageUrl":"","createTime":"6 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40043,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40044,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40048,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"好美呀","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":4,"pageSize":7,"totalPage":1} =================================== 
2025-03-04 22:54:27.608 [http-nio-8093-exec-7] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:31.348 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:31.349 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793656292442205,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:54:31.350 [http-nio-8093-exec-10] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 22:54:31.350 [http-nio-8093-exec-10] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:33.454 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:33.455 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895794954152706064,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:54:33.456 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 1ms, 出参: {"success":true,"message":null,"errorCode":null,"data":null,"pageNo":1,"totalCount":0,"pageSize":10,"totalPage":0} =================================== 
2025-03-04 22:54:33.456 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:39.433 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:39.434 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:54:39.442 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 8ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40055,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":7,"childComments":[{"commentId":40068,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"负的萨芬撒","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":2.1},{"commentId":40057,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40075,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40029,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿~","imageUrl":"","createTime":"6 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40049,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"怎么了","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40025,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"哈哈","imageUrl":"","createTime":"昨天 22:22","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40051,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"法第三方士大夫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40077,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"电风扇反倒是第三方第三方第三方","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40078,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"反倒是","imageUrl":"","createTime":"1 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40053,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"范德萨范德萨","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40054,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40052,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"发送到发顺丰","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40056,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2222","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:54:39.442 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:54:55.837 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:54:55.837 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40055,"pageNo":2}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:54:55.840 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:54:55.841 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40055(Long), 7(Long), 6(Long)
2025-03-04 22:54:55.843 [http-nio-8093-exec-4] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 0
2025-03-04 22:54:55.843 [http-nio-8093-exec-4] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:54:55.861 [http-nio-8093-exec-4] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 24ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":7,"pageSize":6,"totalPage":2} =================================== 
2025-03-04 22:54:55.862 [http-nio-8093-exec-4] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:55:03.701 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:55:03.702 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [二级评论分页查询], 入参: {"parentCommentId":40057,"pageNo":3}, 请求类: CommentController, 请求方法: findChildCommentPageList =================================== 
2025-03-04 22:55:03.703 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==>  Preparing: select id, create_time from t_comment where parent_id = ? and level = 2 order by create_time asc limit ?
2025-03-04 22:55:03.703 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==>  Preparing: select id, user_id, note_id, content_uuid, is_content_empty, image_url, like_total, create_time, reply_user_id, parent_id, reply_comment_id from t_comment where parent_id = ? and level = 2 order by id asc limit ?, ?
2025-03-04 22:55:03.704 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - ==> Parameters: 40057(Long), 13(Long), 6(Long)
2025-03-04 22:55:03.704 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - ==> Parameters: 40057(Long), 60(Integer)
2025-03-04 22:55:03.705 [http-nio-8093-exec-8] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectChildPageList - <==      Total: 0
2025-03-04 22:55:03.705 [NoteExecutor-10] DEBUG c.q.x.c.b.d.m.C.selectChildCommentsByParentIdAndLimit - <==      Total: 2
2025-03-04 22:55:03.706 [http-nio-8093-exec-8] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:55:03.717 [http-nio-8093-exec-8] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [二级评论分页查询], 耗时: 15ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":2,"pageSize":6,"totalPage":1} =================================== 
2025-03-04 22:55:03.717 [http-nio-8093-exec-8] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:55:09.972 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:55:09.973 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:55:09.975 [http-nio-8093-exec-5] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":2,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:55:09.975 [http-nio-8093-exec-5] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:55:09.994 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:55:09.995 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":3}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:55:09.998 [http-nio-8093-exec-1] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":3,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:55:09.998 [http-nio-8093-exec-1] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:55:10.008 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:55:10.009 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895793960295596052,"pageNo":4}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:55:10.012 [http-nio-8093-exec-3] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 3ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[],"pageNo":4,"totalCount":23,"pageSize":7,"totalPage":4} =================================== 
2025-03-04 22:55:10.013 [http-nio-8093-exec-3] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:56:13.135 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:56:13.136 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":1}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:56:13.142 [http-nio-8093-exec-6] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 6ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40022,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/30da9dc65c234162a72c89193a4ea4c7.png","createTime":"昨天 21:28","likeTotal":0,"childCommentTotal":14,"childComments":[{"commentId":40023,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"回复测试","imageUrl":"","createTime":"昨天 21:38","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":3.6},{"commentId":40021,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":null,"imageUrl":"http://127.0.0.1:9000/xiaohashu/a63746f89f6540e7805559408442f624.png","createTime":"昨天 21:21","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40038,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40012,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"4444","imageUrl":"","createTime":"昨天 18:07","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40039,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40005,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:52","likeTotal":0,"childCommentTotal":3,"childComments":[{"commentId":40034,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40017,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"昨天 20:26","likeTotal":0,"childCommentTotal":2,"childComments":[{"commentId":40037,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"丫丫","imageUrl":"","createTime":"4 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.6},{"commentId":40019,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"图片测试","imageUrl":"","createTime":"昨天 20:40","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40033,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"嘿嘿","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40015,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"你好","imageUrl":"","createTime":"昨天 20:12","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40042,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"3 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3}],"pageNo":1,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:56:13.143 [http-nio-8093-exec-6] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
2025-03-04 22:56:19.487 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 设置 userId 到 ThreadLocal 中， 用户 ID: 2100
2025-03-04 22:56:19.488 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求开始: [评论分页查询], 入参: {"noteId":1895795185766367284,"pageNo":2}, 请求类: CommentController, 请求方法: findCommentPageList =================================== 
2025-03-04 22:56:19.495 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==>  Preparing: select id, child_comment_total, like_total, level from t_comment where id in ( ? , ? , ? )
2025-03-04 22:56:19.495 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - ==> Parameters: 40100(Long), 40006(Long), 40101(Long)
2025-03-04 22:56:19.497 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.C.selectCommentCountByIds - <==      Total: 3
2025-03-04 22:56:19.497 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==>  Preparing: select id, user_id, content_uuid, is_content_empty, image_url, like_total, is_top, create_time, first_reply_comment_id, child_comment_total, level, parent_id, heat, note_id, reply_comment_id, reply_user_id from t_comment where id in ( ? , ? )
2025-03-04 22:56:19.497 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - ==> Parameters: 40109(Long), 40108(Long)
2025-03-04 22:56:19.499 [http-nio-8093-exec-2] DEBUG c.q.x.c.b.d.m.CommentDOMapper.selectByCommentIds - <==      Total: 2
2025-03-04 22:56:19.500 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:56:19.508 [http-nio-8093-exec-2] INFO  c.q.f.b.c.interceptor.FeignRequestInterceptor - ########## feign 请求设置请求头 userId: 2100
2025-03-04 22:56:19.512 [http-nio-8093-exec-2] INFO  c.q.f.b.operationlog.aspect.ApiOperationLogAspect - ====== 请求结束: [评论分页查询], 耗时: 24ms, 出参: {"success":true,"message":null,"errorCode":null,"data":[{"commentId":40013,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"6666","imageUrl":"","createTime":"昨天 18:24","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40035,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"1111","imageUrl":"","createTime":"5 小时前","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40008,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 17:02","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40100,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"122","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40006,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"第一条评论😁","imageUrl":"","createTime":"昨天 16:56","likeTotal":0,"childCommentTotal":1,"childComments":[{"commentId":40101,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsf","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":null,"childComments":null,"heat":0.0}],"heat":0.3},{"commentId":40099,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"fdsf","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40098,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"12312","imageUrl":"","createTime":"刚刚","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40108,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"111","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0},{"commentId":40109,"userId":2100,"avatar":"http://127.0.0.1:9000/xiaohashu/827ddaa493c345868bd9b3434d3dbc2d.jpg","nickname":"犬小哈","content":"2342","imageUrl":"","createTime":"47 分钟前","likeTotal":0,"childCommentTotal":0,"childComments":null,"heat":0.0}],"pageNo":2,"totalCount":57,"pageSize":7,"totalPage":9} =================================== 
2025-03-04 22:56:19.513 [http-nio-8093-exec-2] INFO  c.q.f.b.context.filter.HeaderUserId2ContextFilter - ===== 删除 ThreadLocal， userId: 2100
